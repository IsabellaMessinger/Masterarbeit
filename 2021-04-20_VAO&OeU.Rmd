---
title: "Datenauswertung VAO und ÖU 2013/2014"
author: "Isabella Messinger"
date: "20.04.2021"
output:
  html_document: default
  word_document: default
  pdf_document: default
---

# Benötigte Packages öffnen

```{r setup, results='hide',warning=FALSE}
library(tidyverse)
library(ggpubr)
library(reshape2)
library(patchwork)
library(gtools)
library(car)
library(psych)
library(pastecs)
library(rstatix)
library(gridExtra)
library(data.table)
library(kableExtra)
knitr::opts_chunk$set(include = TRUE, echo = FALSE, warning = FALSE) # Generelle Einstellungen für alle Chunks: include = TRUE (Output anzeigenlassen), echo = TRUE (Codes anzeigen lassen)
options(knitr.kable.NA = '') # damit in der Tabelle NAs als leere Felder angezeigt werden
```

# Einlesen des VAO- und Haushaltsdatensatzes von ÖU 2013/2014

```{r}
VAO <- read.csv('VAO_OeU_HH_Haltestellen_Kategorie.csv', header = TRUE, sep = ";",dec = ",", fileEncoding = "UTF-8-BOM")
OeU_HH <- read.csv('OeU2013_2014_Haushaltsdatensatz+OVGuteklassen.csv', header = TRUE, sep = ";", dec = ",", fileEncoding = "UTF-8-BOM")
urb_rur <- read.csv('urban-rural-typologie_statistik_austria.csv', header = TRUE, sep = ";")
GKZ_alt_neu <- read.csv('GKZ_alt-neu.csv', header = TRUE, sep = ";")
```

## Histogramm Zugangszeiten VAO vs. ÖU 2013/2014

Zunächst werden die Variablen "hh_oev_entf_kat" und "hh_oev_entf_kat_neu" mit folgenden Klassen gebildet. 

Klassen: 1...-90, 2...0 min, 3... 1-5 min, 4... 6-15 min, 5... 16-30 min, 6... 31-60 min, 7... 61-120 min, 8... 120-180 min, 9...>180 min)

Zugangszeiten im ÖU 2013/2014-Datensatz mit dem Wert -94, also > 180 min, werden kurzfristig auf 300 gesetzt.

```{r, results='hide'}
VAO <- mutate(VAO, hst_gehdauer_kat = cut(hst_gehdauer, c(-91,-1,0,5,15,30,60,120,180,480),labels = c("1","2","3","4","5","6","7","8","9")))

x=length(which(OeU_HH$hh_oev_entf == -94))
x
OeU_HH <- OeU_HH %>% mutate(hh_oev_entf = replace(hh_oev_entf, hh_oev_entf == -94, 300))
x=length(which(OeU_HH$hh_oev_entf == 300))

OeU_HH <- mutate(OeU_HH, hh_oev_entf_kat_neu = cut(hh_oev_entf, c(-91,-1,0,5,15,30,60,120,180,480),labels = c("1","2","3","4","5","6","7","8","9")))
factor(VAO$hst_gehdauer_kat)
factor(OeU_HH$hh_oev_entf_kat_neu)
```


```{r}
xy <- data.table(table(VAO$hst_gehdauer_kat),table(OeU_HH$hh_oev_entf_kat_neu))
colnames(xy) <- c("Kategorie","VAO", "Kategorie1","OeU")
xy <- select(xy,-"Kategorie1")
xy <- melt(xy, id = "Kategorie")

ggplot(data = xy, aes(x = Kategorie, y=value)) + 
  geom_bar(aes(fill = variable), position = "dodge", stat = "identity")+ 
  scale_fill_manual(values = c("#9ecae1", "#3182bd"))+
  scale_x_discrete(breaks = 1:9, name = "Zugangszeit [min]", labels = c("keine Hst/\nAngabe", "0", "1-5", "6-15", "16-30", "31-60", "61-120", "121-180", ">180")) +
  geom_text(aes(label=paste0(0.01*round(value/(sum(value)/2)*10000),'%'), group=variable), position = position_dodge(.9),size=2.5,vjust=-1)+
  labs(x = "Zugangszeit [min]",
    y = "Anzahl") +
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5, face = "bold"),
        legend.title = element_blank(),legend.position = c(0.8,0.9),legend.direction =  "horizontal",legend.spacing.x = unit(0.1,"cm"),legend.background = element_rect(color = "black",fill = "transparent"))
```

## Histogramm Zugangszeiten VAO vs. ÖU 2013/2014 hochgerechnet
 
Es wird nun das gleiche Histogramm gebildet, allerdings mit den hochgerechneten Werten. 

### Hochrechnen des Datensatzes

Zunächst werden die beiden Datensätze (VAO und ÖU) zusammmengefügt. Anschließend wird die Hochrechnung durchgeführt. Leider funktionierte die Funktion "weights" nicht, weshalb die Hochrechnung über Umwege erfolgte. 

```{r}
hochrechnung <- full_join(VAO, OeU_HH, by = "hh_nr")
names(hochrechnung)

Vergleich_hoch <- mutate(hochrechnung, hh_hochrechnungsfaktor_8 = round(8 * hh_hochrechnungsfaktor))
Vergleich_hoch$hh_hochrechnungsfaktor_8 <- as.integer(Vergleich_hoch$hh_hochrechnungsfaktor_8)

Vergleich_hoch <- setDT(Vergleich_hoch)
Vergleich_hoch <<- Vergleich_hoch[rep(seq(1, nrow(Vergleich_hoch)), Vergleich_hoch$hh_hochrechnungsfaktor)]
```

Nun wird eine Häufigkeitstabelle erzeugt und geplottet. 

```{r}
xy_hoch <- data.table(table(Vergleich_hoch$hst_gehdauer_kat),table(Vergleich_hoch$hh_oev_entf_kat_neu))
colnames(xy_hoch) <- c("Kategorie","VAO", "Kategorie1","OeU")
xy_hoch <- select(xy_hoch,-"Kategorie1")
xy_hoch <- melt(xy_hoch, id = "Kategorie")

ggplot(data = xy_hoch, aes(x = Kategorie, y=value)) + 
  geom_bar(aes(fill = variable), position = "dodge", stat = "identity")+ 
  scale_fill_manual(values = c("#9ecae1", "#3182bd"))+
  scale_x_discrete(breaks = 1:9, name = "Zugangszeit [min]", labels = c("keine Hst/\nAngabe", "0", "1-5", "6-15", "16-30", "31-60", "61-120", "121-180", ">180")) +
  scale_y_continuous(labels = function(l) {paste0(round(l/1e6,1))})+
  geom_text(aes(label=paste0(0.01*round(value/3681347*10000),'%'), group=variable), position = position_dodge(.9),size=2.5,vjust=-1)+
  labs(x = "Zugangszeit [min]",
    y = "Anzahl [Mio]") +
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5, face = "bold"),
        legend.title = element_blank(),legend.position = c(0.8,0.9),legend.direction =  "horizontal",legend.spacing.x = unit(0.1,"cm"),legend.background = element_rect(color = "black",fill = "transparent"))
```

## Datenaufbereitung

Alle Zugangszeiten > 180 min werden zu -94, um dies an ÖU 2013/2014 anzugleichen. Überall, wo die Zugangszeit auf -94 gesetzt wird, wird auch der Zugangsweg auf -94 gesetzt.

Die ÖU 2013/2014-Zugangszeiten, die vorher auf imaginäre 300 Minuten gesetzt wurden, werden wieder auf -94 gesetzt. 

```{r, results='hide'}
x=length(which(VAO$hst_gehdauer > 180))
x
VAO <- VAO %>% mutate(hst_gehdauer = replace(hst_gehdauer, hst_gehdauer > 180, -94))
x=length(which(VAO$hst_gehdauer == -94))

VAO <- VAO %>% mutate(hst_gehlaenge = replace(hst_gehlaenge, hst_gehdauer == -94, -94))

x=length(which(OeU_HH$hh_oev_entf == 300))
x
OeU_HH <- OeU_HH %>% mutate(hh_oev_entf = replace(hh_oev_entf, hh_oev_entf == 300, -94))
x=length(which(OeU_HH$hh_oev_entf == -94))
```

Zwecks Vereinfachung fürs Rechnen werden alle negativen Werte (z.B. nicht anwendbar, keine Haltestelle gefunden, Zugangszeit > 180 min) zu NA umgerechnet, da R fehlende Werte in vielen Fällen automatisch bei Rechnungen ignoriert. 
```{r, results='hide'}
VAO <- VAO %>% dplyr::na_if(-90)
VAO <- VAO %>% dplyr::na_if(-94)
VAO <- VAO %>% dplyr::na_if(-98)
OeU_HH <- OeU_HH %>% dplyr::na_if(-90)
OeU_HH <- OeU_HH %>% dplyr::na_if(-94)
OeU_HH <- OeU_HH %>% dplyr::na_if(-93)
```

Die Variable "hst_bus" wird zur Variable "hst_lokbus" umgenannt. Danach werden die Variablen "hst_lokbus" und "hst_regbus" zur Variable "hst_bus" sowie die Variablen "hst_zug" und "hst_sbahn" zu "hst_bahn" kombiniert, da im ÖU 2013/2014-Datensatz nicht nach den beiden Bus- bzw. Bahnkategorien unterschieden wurde. 

```{r, results='hide'}
VAO <- rename(VAO, hst_lokbus = hst_bus)
VAO <- mutate(VAO, hst_bus = ifelse(VAO$hst_lokbus == 0 & VAO$hst_regbus == 0, 0, 1))
VAO <- mutate(VAO, hst_bahn = ifelse(VAO$hst_zug == 0 & VAO$hst_sbahn == 0, 0, 1))
```

Zugangszeiten von 0 min werden durch 1 min ersetzt: 
1) werden dadurch Divisionen ermöglicht. 
2) entspricht dies dem Durchschnitt der ermittelten Zugangszeit bei den gleichen Distanzen.
```{r, results='hide'}
VAO <- mutate(VAO, hst_gehdauer = replace(hst_gehdauer, hst_gehdauer == 0, 1))
OeU_HH <- mutate(OeU_HH, hh_oev_entf = replace(hh_oev_entf, hh_oev_entf == 0, 1))
```

"Nein"-Antworten, die im ÖU 2013/2014-Datensatz mit 2 codiert wurden, werden zu 0 codiert und so an den VAO-Datensatz angepasst. 

```{r, results='hide'}
OeU_HH <- OeU_HH %>% mutate(
  hh_oev_bus = replace(hh_oev_bus, hh_oev_bus == 2, 0),                    
  hh_oev_strb = replace(hh_oev_strb, hh_oev_strb == 2, 0),
  hh_oev_ubahn = replace(hh_oev_ubahn, hh_oev_ubahn == 2, 0),
  hh_oev_bahn = replace(hh_oev_bahn, hh_oev_bahn == 2, 0),
  hh_carsharing = replace(hh_carsharing, hh_carsharing == 2, 0)
  )
```

# Häufigkeiten der Zugangszeiten

Es werden nun die Zugangszeiten in einem Liniendiagramm dargestellt, um Unterschiede zwischen den ermittelten und angegebenen Zugangszeiten feststellen zu können. 

Häufigkeit der angegebenen/ermittelten Zugangszeiten pro Minute

```{r}
eins_bis_180 <- data.table(1:175)
eins_bis_180$V1 <- as.integer(eins_bis_180$V1)

zuzeiten_VAO <- data.table(table(VAO$hst_gehdauer))
zuzeiten_VAO$V1 <- as.integer(zuzeiten_VAO$V1)
zuzeiten_VAO <- full_join(eins_bis_180, zuzeiten_VAO, by = "V1")
zuzeiten_VAO$Kategorie <- " VAO"

zuzeiten_OeU <- data.table(table(OeU_HH$hh_oev_entf))
zuzeiten_OeU$V1 <- as.integer(zuzeiten_OeU$V1)
zuzeiten_OeU <- full_join(eins_bis_180, zuzeiten_OeU, by = "V1")
zuzeiten_OeU$Kategorie <- "OeU"

zuzeiten_kum <- bind_rows(zuzeiten_VAO, zuzeiten_OeU)
zuzeiten_kum[is.na(zuzeiten_kum)] <- 0

zuzeiten_kum <- zuzeiten_kum %>% arrange(as.numeric(V1)) %>% group_by(Kategorie) %>% mutate(cum_sum = cumsum(N))

ggplot(data = zuzeiten_kum, aes(x = as.numeric(V1), y=as.numeric(N), group = Kategorie, color = Kategorie)) +
  geom_line(aes(color = Kategorie, group = Kategorie), size = 1.2)+
  scale_color_manual(values = c("#9ecae1","#3182bd"))+
  scale_x_continuous(minor_breaks = seq(0, 175, 5),breaks = seq(0, 175, 25)) +
  labs(x = "Zugangszeit [min]",
    y = "Häufigkeit") +
  theme_bw()+
  theme(panel.grid.major = element_line(size = 0.5, linetype = 'solid',color="grey"),plot.title = element_text(hjust = 0.5, face = "bold"), legend.title = element_blank(),legend.position = "bottom",legend.direction =  "horizontal",legend.spacing.x = unit(0.1,"cm"),legend.background = element_rect(color = "black",fill = "transparent"))
```

Und nun mit kumulierten Häufigkeiten

```{r}
ggplot(data = zuzeiten_kum, aes(x = as.numeric(V1), y=as.numeric(cum_sum), group = Kategorie, color = Kategorie)) +
  geom_line(aes(color = Kategorie, group = Kategorie), size = 1.2)+
  scale_color_manual(values = c("#9ecae1","#3182bd"))+
  scale_x_continuous(minor_breaks = seq(0, 175, 5),breaks = seq(0, 175, 25)) +
  labs(x = "Zugangszeit [min]",
    y = "Kumulierte Häufigkeit") +
  theme_bw()+
  theme(panel.grid.major = element_line(size = 0.5, linetype = 'solid',color="grey"),plot.title = element_text(hjust = 0.5, face = "bold"), legend.title = element_blank(),legend.position = "bottom",legend.direction =  "horizontal",legend.spacing.x = unit(0.1,"cm"),legend.background = element_rect(color = "black",fill = "transparent"))
```

### Kombinieren von VAO-, OeU_HH-Datensatz und Urban-Rural-Typologie

Nicht benötigte bzw. doppelte Variablen werden in dem kombinierten Datensatz ("Vergleich") ausgeblendet. 

```{r}
Vergleich <- full_join(VAO, OeU_HH, by = "hh_nr")
names(Vergleich)
Vergleich <- select(Vergleich,-"hst_zug",-"hst_sbahn",-"hst_gehlänge_",-"hst_gehdauer_")

urb_rur <- rename(urb_rur, GKZ_neu = GKZ)
urb_rur <- left_join(urb_rur,GKZ_alt_neu,by = "GKZ_neu")
urb_rur <- mutate(urb_rur, hh_wohngemeinde = ifelse(is.na(GKZ_alt), GKZ_neu, GKZ_alt))
urb_rur <- mutate(urb_rur, gemname_alt = ifelse(is.na(name_alt), GEMNAME, name_alt))
urb_rur <- select(urb_rur,-UZ_NAME,-UZ_NR,-RZ_NAME,-RZ_NR,-AZ_NR,-name_neu,-name_alt,-GKZ_alt,-Tourismus)
urb_rur <- urb_rur %>% distinct(hh_wohngemeinde, .keep_all = TRUE)

Vergleich <- mutate(Vergleich, hh_wohngemeinde = replace(hh_wohngemeinde, hh_wohngemeinde >= 90101, 90001))
Vergleich <- left_join(Vergleich,urb_rur, by = "hh_wohngemeinde")
x=length(which(is.na(Vergleich$UR_TYP)))

summary(Vergleich$UR_TYP)
Vergleich$UR_TYP <- as.ordered(Vergleich$UR_TYP)
```

### Klassifizieren der Daten

Die Klassifizierung ist für die statistische Auswertung erforderlich. 

```{r, results='hide'}
str(Vergleich)
Vergleich$hh_nr <- as.factor(Vergleich$hh_nr)
Vergleich$hst_zug <- as.factor(Vergleich$hst_bahn)
Vergleich$hst_ubahn <- as.factor(Vergleich$hst_ubahn)
Vergleich$hst_tram <- as.factor(Vergleich$hst_tram)
Vergleich$hst_bus <- as.factor(Vergleich$hst_bus)
Vergleich$hst_type <- as.factor(Vergleich$hst_type)
Vergleich$hst_kategorie <- as.ordered(Vergleich$hst_kategorie)

Vergleich$hh_nr <- as.factor(Vergleich$hh_nr)
Vergleich$hh_wohnbdl <- as.factor(Vergleich$hh_wohnbdl)
Vergleich$hh_wohnraumtyp <- as.factor(Vergleich$hh_wohnraumtyp)
Vergleich$hh_wohnbezirk <- as.factor(Vergleich$hh_wohnbezirk)
Vergleich$hh_wohngemeinde <- as.factor(Vergleich$hh_wohnbezirk)
Vergleich$hgr_kat <- as.ordered(Vergleich$hgr_kat)
Vergleich$hh_oev_entf <- as.integer(Vergleich$hh_oev_entf)
Vergleich$hh_oev_entf_kat <- as.ordered(Vergleich$hh_oev_entf_kat)
Vergleich$hh_oev_bus <- as.factor(Vergleich$hh_oev_bus)
Vergleich$hh_oev_strb <- as.factor(Vergleich$hh_oev_strb)
Vergleich$hh_oev_ubahn <- as.factor(Vergleich$hh_oev_ubahn)
Vergleich$hh_oev_bahn <- as.factor(Vergleich$hh_oev_bahn)
Vergleich$hh_carsharing <- as.factor(Vergleich$hh_carsharing)
Vergleich$hh_wirtschsituation <- as.ordered(Vergleich$hh_wirtschsituation)
Vergleich$hh_kobasis <- as.factor(Vergleich$hh_kobasis)
Vergleich$hh_öv_güte <- as.factor(Vergleich$hh_öv_güte)
str(Vergleich)
```

# Übereinstimmung der Zugangszeiten

Um die Übereinstimmung der Zugangszeiten feststellen zu können, wird einerseits ein sogenannter Übereinstimmungsfaktor eingeführt, andererseits werden die Zuganszeiten in einem Punktdiagramm dargestellt.

## Übereinstimmungfaktor

Für Vergleiche zwischen den Zugangszeiten der beiden Datensätze wird ein sogenannter Übereinstimmungsfaktor eingeführt. Dabei wird die ÖU 2013/2014-Zugangszeit durch die VAO-Zugangszeit dividiert. Ein Übereinstimmungsfaktor zwischen 0 und kleiner 1 bedeutet, dass die in ÖU 2013/2014 angegebene Zugangszeit die ermittelte Zugangszeit unterschätzt. Ein Übereinstimmungsfaktor von genau 1 bedeutet, dass die Zugangszeiten ident sind und alle Werte größer 1 bedeuten, dass die in ÖU 2013/2014 angegebene Zugangszeit die ermittelte Zugangszeit überschätzt. Jene Werte können zwischen > 1 und unendlich liegen. Da aufgrund dieser Asymmetrie direkte Vergleiche kaum möglich sind, wird in den Diagrammen eine logarithmische Skala herangezogen. Der Übereinstimmungsfaktor ist folgendermaßen zu interpretieren: 
- Übereinstimmungsfaktor < 1: Zugangszeit ÖU 2013/2014 < VAO (Zugangszeit wird unterschätzt)
- Übereinstimmungsfaktor = 1: Zugangszeiten sind ident
- Übereinstimmungsfaktor > 1: Zugangszeit ÖU 2013/2014 > VAO (Zugangszeit wird überschätzt)

Zusätzlich zu dem Übereinstimmungsfaktor wird der logarithmierte Übereinstimmungsfaktor angegeben (lg10 (Zugangszeit ÖU/Zugangszeit VAO)). Dieser ist folgendermaßen zu interpretieren: 

- Übereinstimmungsfaktor < 0: Zugangszeit ÖU 2013/2014 < VAO (Zugangszeit wird unterschätzt)
- Übereinstimmungsfaktor = 0: Zugangszeiten sind ident
- Übereinstimmungsfaktor > 0: Zugangszeit ÖU 2013/2014 > VAO (Zugangszeit wird überschätzt)

### Tabelle erzeugen (Interpretation des Übereinstimmungsfaktors)

```{r}
Uebereinstimmungsfaktor <- data.frame(c("Übereinstimmungsgrad","< 1 (< 0 bei lg)","= 1 (= 0 bei lg)","> 1 (> 0 bei lg)"),  c("Zugangszeit","ÖU 2013/2014 < VAO","ÖU 2013/2014 = VAO","ÖU 2013/2014 > VAO"),c("Interpretation","Unterschätzen der Zugangszeit","Idente Zugangszeit","Überschätzen der Zugangszeit"))

colnames(Uebereinstimmungsfaktor) <- Uebereinstimmungsfaktor[1,] # 1. Zeile zur Überschrift machen
Uebereinstimmungsfaktor <- Uebereinstimmungsfaktor[-1, ] 

# Tabelle erzeugen
kbl(Uebereinstimmungsfaktor, align = "c") %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),full_width = FALSE)
```

### Berechnen des Übereinstimmungsfaktors

```{r, results='hide'}
Vergleich <- mutate(Vergleich, gleich_entf_fakt = ifelse(VAO$hst_gehdauer != "NA" & OeU_HH$hh_oev_entf != "NA", (OeU_HH$hh_oev_entf/VAO$hst_gehdauer), "NA"))
Vergleich <- Vergleich%>% mutate(gleich_entf_fakt_lg = log10(gleich_entf_fakt))
```

Zusätzlich wird der Übereinstimmungsfaktor in fünf Klassen eingeteilt, die die Kenntnis, also den Grad der Übereinstimmung beschreiben. Dazu wird der nicht logarithmisierte Übereinstimmungfaktor herangezogen. Es ergeben sich folgende Klassen: 

1) sehr gute Kenntnis: 0,90 ≤ gleich_entf_fakt < 1,12
2) gute Kenntnis: 0,70 ≤ gleich_entf_fakt < 0,90 und 1,12 ≤ gleich_entf_fakt < 1,43
3) mäßige Kenntnis: 0,50 ≤ gleich_entf_fakt < 0,70 und 1,43 ≤ gleich_entf_fakt < 2,01
4) schlechte Kenntnis: 0,30 ≤ gleich_entf_fakt < 0,50 und 2,01 ≤ gleich_entf_fakt < 3,31
5) sehr schlechte Kenntnis: gleich_entf_fakt < 0,30 und gleich_entf_fakt ≥ 3,31

```{r, results='hide'}
Vergleich <- mutate(Vergleich,gleich_entf_kat = cut(gleich_entf_fakt,breaks =  c(0,0.3,0.5,0.7,0.9,1.12,1.43,2.01,3.31,105),labels = c("5","4","3","2","1","2","3","4","5")))
```

### Tabelle erzeugen (Interpretation der Farben des Übereinstimmungsfaktors)

```{r}
Uebereinstimmungsfaktor <- data.frame(c("Übereinstimmungsgrad","< 0,3 bzw. &#8805; 3,31","0,30 bis < 0,50 bzw. 2,01 bis < 3,31","0,50 bis < 0,70 bzw. 1,43 bis < 2,01","0,70 bis < 0,90 bzw. 1,12 bis < 1,43","0,90 bis < 1,12"),c("Kenntnis","Sehr schlecht","Schlecht","Mäßig","Gut","Sehr gut"),c("Farbzuordnung","Dunkelrot","Hellrot","Orange","Hellgrün","Dunkelgrün"),c("Farbe","","","","",""))

colnames(Uebereinstimmungsfaktor) <- Uebereinstimmungsfaktor[1,] # 1. Zeile zur Überschrift machen
Uebereinstimmungsfaktor <- Uebereinstimmungsfaktor[-1, ] 

Uebereinstimmungsfaktor %>%
  kable("html", escape = FALSE) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),full_width = F)
```

## Punktdiagramm

Auf der x-Achse befindet sich die ÖU 2013/2014-Zugangszeit, auf der y-Achse die VAO-Zugangszeit. Der Übereinstimmungsgrad (Kenntnis) ist in den zuvor eingeführten Kategorien farblich dargestellt. Zusätzlich wird eine durch den Ursprung gehende Regressionsgerade hinzugefügt und die Formel der Regressionsgerade angeführt. 

```{r}
Vergleich %>% 
  drop_na(gleich_entf_kat, hst_gehdauer, hh_oev_entf) %>%
  ggplot(Vergleich, mapping = aes(x=as.numeric(hh_oev_entf),y=as.numeric(hst_gehdauer))) + 
  geom_jitter(aes(color = factor(gleich_entf_kat)), alpha=0.6, width = 0.2) + 
  geom_smooth(method = "lm", se=FALSE, formula = y ~-1+ x) +
  stat_regline_equation(aes(label =  paste(..eq.label.., ..rr.label.., sep = "~~~~")),formula =  y ~-1+ x,label.x = 90, label.y = 155)+
  scale_color_manual(values=c("red4","red3","orange","green3","green4"),labels=c("sehr schlecht","schlecht","mäßig","gut","sehr gut")) +
  labs(x = "Zugangszeit ÖU 2013/2014 [min]",
       y = "Zugangszeit VAO [min]",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.background = element_rect(color = "black",fill = "transparent"),aspect.ratio=1)
```

### Punktdiagramm: Teilbereich von 15 min

Nun wird der Teilbereich von Zugangszeiten bis 15 min dargestellt. Die Punktansammlungen ergeben sich aufgrund der gewählten Darstellung des Punktdiagramms. Je quadratischer und dünkler ein Bereich, umso mehr Werte befinden sich dort. 

```{r}
Vergleich %>% 
  drop_na(gleich_entf_kat, hst_gehdauer, hh_oev_entf) %>%
  ggplot(Vergleich, mapping = aes(x=as.numeric(hh_oev_entf),y=as.numeric(hst_gehdauer))) +  
  geom_jitter(aes(color = factor(gleich_entf_kat)), alpha=0.6, width = 0.2) + 
  geom_smooth(method = "lm", se=FALSE, formula = y ~-1+ x) +
  stat_regline_equation(aes(label =  paste(..eq.label.., ..rr.label.., sep = "~~~~")),formula =  y ~-1+ x,label.x = 9.25, label.y = 0)+
  scale_color_manual(values=c("red4","red3","orange","green3","green4"),labels=c("sehr schlecht","schlecht","mäßig","gut","sehr gut")) +
  xlim(0,15.5)+
  ylim(0,15.5)+
  labs(x = "Zugangszeit ÖU 2013/2014 [min]",
       y = "Zugangszeit VAO [min]",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.background = element_rect(color = "black",fill = "transparent"),aspect.ratio=1)
```

### Punktdiagramm: Teilbereich von 5 min

Nun wird der Teilbereich von Zugangszeiten bis 15 min dargestellt. Die Punktansammlungen ergeben sich aufgrund der gewählten Darstellung des Punktdiagramms. Je quadratischer und dünkler ein Bereich, umso mehr Werte befinden sich dort. 

```{r}
Vergleich %>% 
  drop_na(gleich_entf_kat, hst_gehdauer, hh_oev_entf) %>%
  ggplot(Vergleich, mapping = aes(x=as.numeric(hh_oev_entf),y=as.numeric(hst_gehdauer))) +  
  geom_jitter(aes(color = factor(gleich_entf_kat)), alpha=0.6, width = 0.2) + 
  geom_smooth(method = "lm", se=FALSE, formula = y ~-1+ x) +
  stat_regline_equation(aes(label =  paste(..eq.label.., ..rr.label.., sep = "~~~~")),formula =  y ~-1+ x,label.x = 3.25, label.y = 0)+
  scale_color_manual(values=c("red4","red3","orange","green3","green4"),labels=c("sehr schlecht","schlecht","mäßig","gut","sehr gut")) +
  xlim(0,5.5)+
  ylim(0,5.5)+
  labs(x = "Zugangszeit ÖU 2013/2014 [min]",
       y = "Zugangszeit VAO [min]",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.background = element_rect(color = "black",fill = "transparent"),aspect.ratio=1)
```

# Untersuchen möglicher Einflussfaktoren auf den Kenntnisstand

In weiterer Folge mittels Hypothesentests geprüft, ob verschiedene Variablen einen Einfluss auf den Übereinstimmungsfaktor haben. Dies wird zudem mittels Boxplots graphisch abgebildet, bei denen die Gruppen der untersuchten Variablen sowie die Summe dieser Gruppen einander gegenüber gestellt werden.

*__Vorgehensweise bei den Hypothesentests__*

1. Bilden von Subsets für jede Gruppe einer Variable
2. Bilden von je einem Histogramm je Gruppe, um die Normalverteilung zu prüfen (Statistische Tests sind bei großen Stichproben sehr schnell signifikant.)
3. Testen der Varianzhomogenität mittels Levene-Test.
4. Bei __Normalverteilung und Varianzhomogenität__: ANOVA
    - Durchführen der ANOVA mittels "aov()"-Funktion
    - Anzeigen der Ergebnisse der ANOVA mittels "summary()"
5. Bei __Normalverteilung und Varianzheterogenität__: Welch-Test
    - Bei 2 Gruppen innerhalb einer Variable: Welch-Test mittels "t.test()"-Funktion
    - Bei > 2 Gruppen innerhalb einer Variable: Welch's ANOVA mittels "oneway.test()"-Funktion.
6. Post-hoc-Tests: 
    - Bei ANOVA: Paarweiser Vergleich der Ergebnisse der ANOVA mittels "pairwise.t.test()". Ergebnis ist eine t-Test-Signifikanztabelle. Ist der p-Wert <0,05, so ist die Nullhypothese, dass die beiden verglichenen Gruppen ähnlich sind, zu verwerfen. Es sind zwei Methoden zur Anpassung des p-Werts empfehlenswert: Bonferroni ist am konservativsten, Holm ist auch ok. 
    - Bei ANOVA: Histogramm der standardisierten Residuen zur Prüfung der Normalverteilung mittels "hist(rstandard())"-Funktion
    - Bei ANOVA: Q-Q-Plot, um ebenfalls die Normalverteilung zu prüfen
    - Bei Welch's Test bzw. Welch's ANOVA: games_howell_test

*__Beschriftung der y-Achse__*

```{r}
y_scale_beschriftung <- c(0.01,0.1,1,10,100)
```

## Unabhängige Variable: Zugangsweite zur nächstgelegenen Haltestelle laut VAO

Zunächst werden die Labels für die Angabe der Stichprobengröße und des Mittelwerts je Gruppe und für alle Gruppen gemeinsam erzeugt. Anschließend wird ein Subset gebildet und fehlende Werte rausgefiltert. Danach wird geplottet. 

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
Vergleich <- mutate(Vergleich, hst_gehlaenge_kat = cut(hst_gehlaenge, c(0,500,1000,2000,5000,10000,20000),labels = c("1","2","3","4","5","6")))
Vergleich$hst_gehlaenge_kat <- as.ordered(Vergleich$hst_gehlaenge_kat)

hst_gehlaenge_kat1 <- subset(Vergleich, hst_gehlaenge_kat==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hst_gehlaenge_kat2 <- subset(Vergleich, hst_gehlaenge_kat==2,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hst_gehlaenge_kat3 <- subset(Vergleich, hst_gehlaenge_kat==3,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hst_gehlaenge_kat4 <- subset(Vergleich, hst_gehlaenge_kat==4,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hst_gehlaenge_kat5 <- subset(Vergleich, hst_gehlaenge_kat==5,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hst_gehlaenge_kat6 <- subset(Vergleich, hst_gehlaenge_kat==6,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(2,3))
hist(hst_gehlaenge_kat1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hst_gehlaenge_kat2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hst_gehlaenge_kat3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hst_gehlaenge_kat4$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hst_gehlaenge_kat5$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hst_gehlaenge_kat6$gleich_entf_fakt_lg,xlim=range(breaks = seq(-3, 3, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$hst_gehlaenge_kat)
```

3. Hypothesentests

```{r}
oneway.test(gleich_entf_fakt_lg ~ hst_gehlaenge_kat, data=Vergleich)
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich, gleich_entf_fakt_lg ~ hst_gehlaenge_kat, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
hst_gehlaengeBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "hst_gehlaenge_kat", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehlaenge_kat","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,hst_gehlaenge_kat)

# Labels erstellen
text_labels1 <- group_by(
  hst_gehlaengeBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_gehlaenge_kat, gleich_entf_fakt_lg),
  hst_gehlaenge_kat
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  hst_gehlaengeBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(hst_gehlaengeBoxplot,mapping = aes(
  x = as.numeric(hst_gehlaenge_kat),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=hst_gehlaenge_kat),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=hst_gehlaenge_kat),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:6, name = "Zugangsweite zur nächstgelegenen Haltestelle laut VAO [m]", labels = c("bis 500", "501\n - \n1 000", "1 001\n - \n2 000", "2 001\n - \n5 000", "5 001\n - \n10 000", "> 10 000")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:6, name = "Zugangsweite zur nächstgelegenen Haltestelle laut VAO [m]", labels = c("bis 500", "501\n - \n1 000", "1 001\n - \n2 000", "2 001\n - \n5 000", "5 001\n - \n10 000", "> 10 000")) +
  labs(x = "Entfernung [m]",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(hst_gehlaengeBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c(" \n \n ")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c(" \n \n ")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(4,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

## Unabhängige Variable: Wohnbundesland hochgerechnet

Zunächst werden die Labels für die Angabe der Stichprobengröße und des Mittelwerts je Gruppe und für alle Gruppen gemeinsam erzeugt. Anschließend wird ein Subset gebildet und fehlende Werte rausgefiltert. Danach wird geplottet. 

### Hochrechnen des Datensatzes

```{r}
Vergleich_hoch <- mutate(Vergleich, hh_hochrechnungsfaktor_8 = round(8 * hh_hochrechnungsfaktor))
Vergleich_hoch$hh_hochrechnungsfaktor_8 <- as.integer(Vergleich_hoch$hh_hochrechnungsfaktor_8)

Vergleich_hoch <- setDT(Vergleich_hoch)
Vergleich_hoch <<- Vergleich_hoch[rep(seq(1, nrow(Vergleich_hoch)), Vergleich_hoch$hh_hochrechnungsfaktor)]
```

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
hh_wohnbdl_hoch <- subset(Vergleich_hoch, select=c("hh_nr","gleich_entf_kat", "hh_wohnbdl", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf","hh_hochrechnungsfaktor")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,gleich_entf_fakt_lg,hh_wohnbdl)

hh_wohnbdl1 <- subset(hh_wohnbdl_hoch, hh_wohnbdl==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wohnbdl2 <- subset(hh_wohnbdl_hoch, hh_wohnbdl==2,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wohnbdl3 <- subset(hh_wohnbdl_hoch, hh_wohnbdl==3,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wohnbdl4 <- subset(hh_wohnbdl_hoch, hh_wohnbdl==4,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wohnbdl5 <- subset(hh_wohnbdl_hoch, hh_wohnbdl==5,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wohnbdl6 <- subset(hh_wohnbdl_hoch, hh_wohnbdl==6,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wohnbdl7 <- subset(hh_wohnbdl_hoch, hh_wohnbdl==7,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wohnbdl8 <- subset(hh_wohnbdl_hoch, hh_wohnbdl==8,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wohnbdl9 <- subset(hh_wohnbdl_hoch, hh_wohnbdl==9,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(3,3))
hist(hh_wohnbdl1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hh_wohnbdl2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hh_wohnbdl3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hh_wohnbdl4$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hh_wohnbdl5$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hh_wohnbdl6$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hh_wohnbdl7$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hh_wohnbdl8$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hh_wohnbdl9$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(hh_wohnbdl_hoch$gleich_entf_fakt_lg, hh_wohnbdl_hoch$hh_wohnbdl)
```

3. Hypothesentests

```{r}
oneway.test(gleich_entf_fakt_lg ~ hh_wohnbdl, data=hh_wohnbdl_hoch)
```

4. Post-hoc-Tests

```{r}
games_howell_test(hh_wohnbdl_hoch, gleich_entf_fakt_lg ~ hh_wohnbdl, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
wohnbdlBoxplot <- subset(hh_wohnbdl_hoch, select=c("gleich_entf_kat", "hh_wohnbdl", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,hh_wohnbdl)

# Labels erstellen
text_labels1 <- group_by(
  wohnbdlBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hh_wohnbdl, gleich_entf_fakt_lg),
  hh_wohnbdl
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  wohnbdlBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)


# plotten
plot1 <-  ggplot(wohnbdlBoxplot,mapping = aes(
  x = as.numeric(hh_wohnbdl),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.3, size = 0.75)+
  stat_boxplot(aes(group=hh_wohnbdl),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=hh_wohnbdl),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:9, name = "Bundesland (hochgerechnet)", labels = c("Bgld", "Ktn", "NÖ", "OÖ", "Sbg", "Stmk", "T", "Vbg", "W")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:9, name = "Bundesland", labels = c("Bgld", "Ktn", "NÖ", "OÖ", "Sbg", "Stmk", "T", "Vbg", "W")) +
  labs(x = "Bundesland (hochgerechnet)",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(wohnbdlBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.05,show.legend = FALSE,size=0.75)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(4,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

### Durchschnittliche Zugangsweite pro Wohnbundesland hochgerechnet

```{r}
Vergleich_hoch %>% group_by(hh_wohnbdl) %>% drop_na(hst_gehlaenge, hh_wohnbdl) %>% summarise_at(vars(hst_gehlaenge), list(name = mean))
```

## Unabhängige Variable: Wohnbundesland

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
hh_wohnbdl1 <- subset(Vergleich, hh_wohnbdl==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wohnbdl2 <- subset(Vergleich, hh_wohnbdl==2,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wohnbdl3 <- subset(Vergleich, hh_wohnbdl==3,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wohnbdl4 <- subset(Vergleich, hh_wohnbdl==4,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wohnbdl5 <- subset(Vergleich, hh_wohnbdl==5,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wohnbdl6 <- subset(Vergleich, hh_wohnbdl==6,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wohnbdl7 <- subset(Vergleich, hh_wohnbdl==7,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wohnbdl8 <- subset(Vergleich, hh_wohnbdl==8,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wohnbdl9 <- subset(Vergleich, hh_wohnbdl==9,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(3,3))
hist(hh_wohnbdl1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hh_wohnbdl2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hh_wohnbdl3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hh_wohnbdl4$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hh_wohnbdl5$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hh_wohnbdl6$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hh_wohnbdl7$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hh_wohnbdl8$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hh_wohnbdl9$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$hh_wohnbdl)
```

3. Hypothesentests

```{r}
oneway.test(gleich_entf_fakt_lg ~ hh_wohnbdl, data=Vergleich)
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich, gleich_entf_fakt_lg ~ hh_wohnbdl, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
wohnbdlBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "hh_wohnbdl", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,hh_wohnbdl)

# Labels erstellen
text_labels1 <- group_by(
  wohnbdlBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hh_wohnbdl, gleich_entf_fakt_lg),
  hh_wohnbdl
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  wohnbdlBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)


# plotten
plot1 <-  ggplot(wohnbdlBoxplot,mapping = aes(
  x = as.numeric(hh_wohnbdl),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=hh_wohnbdl),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=hh_wohnbdl),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:9, name = "Bundesland", labels = c("Bgld", "Ktn", "NÖ", "OÖ", "Sbg", "Stmk", "T", "Vbg", "W")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:9, name = "Bundesland", labels = c("Bgld", "Ktn", "NÖ", "OÖ", "Sbg", "Stmk", "T", "Vbg", "W")) +
  labs(x = "Bundesland",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(wohnbdlBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(4,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(wohnbdlBoxplot$gleich_entf_fakt_lg) # gesamt

wohnbdlBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hh_wohnbdl, gleich_entf_fakt_lg) %>% group_by(hh_wohnbdl) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(wohnbdlBoxplot$gleich_entf_fakt) # gesamt

wohnbdlBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hh_wohnbdl, gleich_entf_fakt_lg) %>% group_by(hh_wohnbdl) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

### Durchschnittliche Zugangsweite pro Wohnbundesland

```{r}
Vergleich %>% group_by(hh_wohnbdl) %>% drop_na(hst_gehlaenge, hh_wohnbdl) %>% summarise_at(vars(hst_gehlaenge), list(name = mean))

# gesamt
Vergleich %>% drop_na(hst_gehlaenge, hh_wohnbdl) %>% summarise_at(vars(hst_gehlaenge), list(name = mean))
```

## Unabhängige Variable: Wohnraumtyp

Der Wohnraum wurde in 4 Kategorien unterteilt. 

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
hh_wohnraumtyp1 <- subset(Vergleich, hh_wohnraumtyp==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wohnraumtyp2 <- subset(Vergleich, hh_wohnraumtyp==2,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wohnraumtyp3 <- subset(Vergleich, hh_wohnraumtyp==3,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wohnraumtyp4 <- subset(Vergleich, hh_wohnraumtyp==4,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(2,2))
hist(hh_wohnraumtyp1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hh_wohnraumtyp2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hh_wohnraumtyp3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hh_wohnraumtyp4$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$hh_wohnraumtyp)
```

3. Hypothesentests

```{r}
oneway.test(gleich_entf_fakt_lg ~ hh_wohnraumtyp, data=Vergleich)
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich, gleich_entf_fakt_lg ~ hh_wohnraumtyp, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
wohnraumtypBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "hh_wohnraumtyp", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,hh_wohnraumtyp)

# Labels erstellen
text_labels1 <- group_by(
  wohnraumtypBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hh_wohnraumtyp, gleich_entf_fakt_lg),
  hh_wohnraumtyp
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  wohnraumtypBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(wohnraumtypBoxplot,mapping = aes(
  x = as.numeric(hh_wohnraumtyp),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=hh_wohnraumtyp),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=hh_wohnraumtyp),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
   scale_x_continuous(breaks = 1:4, name = "Wohnraumtyp", labels = c("Wien", "Großstädte\nohne Wien", "Zentrale Bezirke", "Periphere Bezirke")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:4, name = "Wohnraumtyp", labels = c("Wien", "Großstädte\nohne Wien", "Zentrale Bezirke", "Periphere Bezirke")) +
  labs(x = "Wohnraumtyp",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(wohnraumtypBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c(" \n ")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c(" \n ")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(4,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

## Unabhängige Variable: Urban-Rural-Typologie (hochgerechnet)

Der Wohnraum wurde in 11 Kategorien unterteilt. 

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
UR_TYP1 <- subset(Vergleich_hoch, UR_TYP==101,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
UR_TYP2 <- subset(Vergleich_hoch, UR_TYP==102,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
UR_TYP3 <- subset(Vergleich_hoch, UR_TYP==103,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
UR_TYP4 <- subset(Vergleich_hoch, UR_TYP==210,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
UR_TYP5 <- subset(Vergleich_hoch, UR_TYP==220,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
UR_TYP6 <- subset(Vergleich_hoch, UR_TYP==310,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
UR_TYP7 <- subset(Vergleich_hoch, UR_TYP==320,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
UR_TYP8 <- subset(Vergleich_hoch, UR_TYP==330,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
UR_TYP9 <- subset(Vergleich_hoch, UR_TYP==410,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
UR_TYP10 <- subset(Vergleich_hoch, UR_TYP==420,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
UR_TYP11 <- subset(Vergleich_hoch, UR_TYP==430,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)


par(mfrow=c(3,4))
hist(UR_TYP1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(UR_TYP2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(UR_TYP3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(UR_TYP4$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(UR_TYP5$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(UR_TYP6$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(UR_TYP7$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(UR_TYP8$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(UR_TYP9$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(UR_TYP10$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(UR_TYP11$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich_hoch$gleich_entf_fakt_lg, Vergleich_hoch$UR_TYP)
```

3. Hypothesentests

```{r}
oneway.test(gleich_entf_fakt_lg ~ UR_TYP, data=Vergleich_hoch)
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich_hoch, gleich_entf_fakt_lg ~ UR_TYP, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
Vergleich_hochBoxplot <- subset(Vergleich_hoch, select=c("gleich_entf_kat", "UR_TYP", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,UR_TYP)

# Labels erstellen
text_labels1 <- group_by(
  Vergleich_hochBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, UR_TYP, gleich_entf_fakt_lg),
  UR_TYP
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  Vergleich_hochBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(Vergleich_hochBoxplot,mapping = aes(
  x = as.numeric(UR_TYP),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.3, size = 0.75)+
  stat_boxplot(aes(group=UR_TYP),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=UR_TYP),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:11, name = "Urban-Rural-Typologie (hochgerechnet)", labels = c("101", "102", "103", "210","220","310","320","330","410","420","430")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:11, name = "Urban-Rural-Typologie (hochgerechnet)", labels = c("101", "102", "103", "210","220","310","320","330","410","420","430")) +
  labs(x = "Urban-Rural-Typologie (hochgerechnet)",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(Vergleich_hochBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.05,show.legend = FALSE,size=0.75)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c(" ")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c(" ")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(5,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

## Unabhängige Variable: Urban-Rural-Typologie

Der Wohnraum wurde in 11 Kategorien unterteilt. 

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
UR_TYP1 <- subset(Vergleich, UR_TYP==101,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
UR_TYP2 <- subset(Vergleich, UR_TYP==102,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
UR_TYP3 <- subset(Vergleich, UR_TYP==103,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
UR_TYP4 <- subset(Vergleich, UR_TYP==210,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
UR_TYP5 <- subset(Vergleich, UR_TYP==220,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
UR_TYP6 <- subset(Vergleich, UR_TYP==310,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
UR_TYP7 <- subset(Vergleich, UR_TYP==320,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
UR_TYP8 <- subset(Vergleich, UR_TYP==330,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
UR_TYP9 <- subset(Vergleich, UR_TYP==410,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
UR_TYP10 <- subset(Vergleich, UR_TYP==420,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
UR_TYP11 <- subset(Vergleich, UR_TYP==430,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)


par(mfrow=c(2,4))
hist(UR_TYP1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(UR_TYP2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(UR_TYP3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(UR_TYP4$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(UR_TYP5$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(UR_TYP6$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(UR_TYP7$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(UR_TYP8$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(UR_TYP9$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(UR_TYP10$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(UR_TYP11$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$UR_TYP)
```

3. Hypothesentests

```{r}
oneway.test(gleich_entf_fakt_lg ~ UR_TYP, data=Vergleich)
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich, gleich_entf_fakt_lg ~ UR_TYP, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
VergleichBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "UR_TYP", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,UR_TYP)

# Labels erstellen
text_labels1 <- group_by(
  VergleichBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, UR_TYP, gleich_entf_fakt_lg),
  UR_TYP
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  VergleichBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(VergleichBoxplot,mapping = aes(
  x = as.numeric(UR_TYP),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=UR_TYP),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=UR_TYP),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:11, name = "Urban-Rural-Typologie", labels = c("101", "102", "103", "210","220","310","320","330","410","420","430")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:11, name = "Urban-Rural-Typologie", labels = c("101", "102", "103", "210","220","310","320","330","410","420","430")) +
  labs(x = "Urban-Rural-Typologie",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(VergleichBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c(" ")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c(" ")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(5,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(VergleichBoxplot$gleich_entf_fakt_lg) # gesamt

VergleichBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, UR_TYP, gleich_entf_fakt_lg) %>% group_by(UR_TYP) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(VergleichBoxplot$gleich_entf_fakt) # gesamt

VergleichBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, UR_TYP, gleich_entf_fakt_lg) %>% group_by(UR_TYP) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Wirtschaftssituation

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
hh_wirtschsituation1 <- subset(Vergleich, hh_wirtschsituation==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wirtschsituation2 <- subset(Vergleich, hh_wirtschsituation==2,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wirtschsituation3 <- subset(Vergleich, hh_wirtschsituation==3,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wirtschsituation4 <- subset(Vergleich, hh_wirtschsituation==4,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_wirtschsituation5 <- subset(Vergleich, hh_wirtschsituation==5,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(2,3))
hist(hh_wirtschsituation1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hh_wirtschsituation2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hh_wirtschsituation3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hh_wirtschsituation4$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hh_wirtschsituation5$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$hh_wirtschsituation)
```

3. Hypothesentests

```{r}
oneway.test(gleich_entf_fakt_lg ~ hh_wirtschsituation, data=Vergleich)
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich, gleich_entf_fakt_lg ~ hh_wirtschsituation, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
hh_wirtschsituationBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "hh_wirtschsituation", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,hh_wirtschsituation)

# Labels erstellen
text_labels1 <- group_by(
  hh_wirtschsituationBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hh_wirtschsituation, gleich_entf_fakt_lg),
  hh_wirtschsituation
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  hh_wirtschsituationBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(hh_wirtschsituationBoxplot,mapping = aes(
  x = as.numeric(hh_wirtschsituation),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=hh_wirtschsituation),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=hh_wirtschsituation),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:5, name = "Wirtschaftssituation", labels = c("Sehr schlecht", "Schlecht", "Mittel", "Gut", "Sehr gut")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:5, name = "Wirtschaftssituation", labels = c("Sehr schlecht", "Schlecht", "Mittel", "Gut", "Sehr gut")) +
  labs(x = "Wirtschaftssituation",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(hh_wirtschsituationBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(3.5,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(hh_wirtschsituationBoxplot$gleich_entf_fakt_lg) # gesamt

hh_wirtschsituationBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hh_wirtschsituation, gleich_entf_fakt_lg) %>% group_by(hh_wirtschsituation) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(hh_wirtschsituationBoxplot$gleich_entf_fakt) # gesamt

hh_wirtschsituationBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hh_wirtschsituation, gleich_entf_fakt_lg) %>% group_by(hh_wirtschsituation) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```


## Unabhängige Variable: Datenbasis für Koordinaten

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
hh_kobasis1 <- subset(Vergleich, hh_kobasis==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_kobasis2 <- subset(Vergleich, hh_kobasis==2,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_kobasis3 <- subset(Vergleich, hh_kobasis==3,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_kobasis4 <- subset(Vergleich, hh_kobasis==4,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_kobasis5 <- subset(Vergleich, hh_kobasis==5,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_kobasis6 <- subset(Vergleich, hh_kobasis==6,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(2,3))
hist(hh_kobasis1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hh_kobasis2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hh_kobasis3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hh_kobasis4$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hh_kobasis5$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hh_kobasis6$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$hh_kobasis)
```

3. Hypothesentests

```{r}
oneway.test(gleich_entf_fakt_lg ~ hh_kobasis, data=Vergleich)
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich, gleich_entf_fakt_lg ~ hh_kobasis, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
kobasisBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "hh_kobasis", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,hh_kobasis)

# Labels erstellen
text_labels1 <- group_by(
  kobasisBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hh_kobasis, gleich_entf_fakt_lg),
  hh_kobasis
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  kobasisBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(kobasisBoxplot,mapping = aes(
  x = as.numeric(hh_kobasis),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=hh_kobasis),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=hh_kobasis),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:6, name = "Koordinatenbasis", labels = c("VAO-\nAbfrage", "Google-\nAbfrage", "Manuelle\nAbfrage", "VAO\n(manuell\nüberarbeitet)", "Google\n(manuell\nüberarbeitet)", "Korrektur der\nmanuellen\nAbfrage")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:6, name = "Koordinatenbasis", labels = c("VAO-\nAbfrage", "Google-\nAbfrage", "Manuelle\nAbfrage", "VAO\n(manuell\nüberarbeitet)", "Google\n(manuell\nüberarbeitet)", "Korrektur der\nmanuellen\nAbfrage")) +
  labs(x = "Koordinatenbasis",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(kobasisBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c(" \n \n ")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c(" \n \n ")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(4,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

## Unabhängige Variable: ÖV-Güteklasse

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
hh_öv_güteA <- subset(Vergleich, hh_öv_güte=="A",select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_öv_güteB <- subset(Vergleich, hh_öv_güte=="B",select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_öv_güteC <- subset(Vergleich, hh_öv_güte=="C",select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_öv_güteD <- subset(Vergleich, hh_öv_güte=="D",select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_öv_güteE <- subset(Vergleich, hh_öv_güte=="E",select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_öv_güteF <- subset(Vergleich, hh_öv_güte=="F",select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hh_öv_güteG <- subset(Vergleich, hh_öv_güte=="G",select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(3,3))
hist(hh_öv_güteA$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hh_öv_güteB$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hh_öv_güteC$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hh_öv_güteD$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hh_öv_güteE$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hh_öv_güteF$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hh_öv_güteG$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$hh_öv_güte)
```

3. Hypothesentests

```{r}
oneway.test(gleich_entf_fakt_lg ~ hh_öv_güte, data=Vergleich)
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich, gleich_entf_fakt_lg ~ hh_öv_güte, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
öv_güteBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "hh_öv_güte", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,hh_öv_güte)

# Labels erstellen
text_labels1 <- group_by(
  öv_güteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hh_öv_güte, gleich_entf_fakt_lg),
  hh_öv_güte
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  öv_güteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(öv_güteBoxplot,mapping = aes(
  x = as.numeric(hh_öv_güte),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=hh_öv_güte),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=hh_öv_güte),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
   scale_x_continuous(breaks = 1:7, name = "ÖV-Güteklasse", labels = c("A", "B", "C", "D", "E", "F","G")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:7, name = "ÖV-Güteklasse", labels = c("A", "B", "C", "D", "E", "F","G")) +
  labs(x = "ÖV-Güteklasse",
        y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(öv_güteBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("A-G")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("A-G")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(4,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

## Unabhängige Variable: Haltestellenkategorie (ÖROK)

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
hst_kategorie1 <- subset(Vergleich, hst_kategorie=="I",select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hst_kategorie2 <- subset(Vergleich, hst_kategorie=="II",select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hst_kategorie3 <- subset(Vergleich, hst_kategorie=="III",select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hst_kategorie4 <- subset(Vergleich, hst_kategorie=="IV",select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hst_kategorie5 <- subset(Vergleich, hst_kategorie=="V",select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hst_kategorie6 <- subset(Vergleich, hst_kategorie=="VI",select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hst_kategorie7 <- subset(Vergleich, hst_kategorie=="VII",select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hst_kategorie8 <- subset(Vergleich, hst_kategorie=="VIII",select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(3,3))
hist(hst_kategorie1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hst_kategorie2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hst_kategorie3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hst_kategorie4$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hst_kategorie5$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hst_kategorie6$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hst_kategorie7$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hst_kategorie8$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$hst_kategorie)
```

3. Hypothesentests

```{r}
oneway.test(gleich_entf_fakt_lg ~ hst_kategorie, data=Vergleich)
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich, gleich_entf_fakt_lg ~ hst_kategorie, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
hst_kategorieBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "hst_kategorie", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,hst_kategorie)

# Labels erstellen
text_labels1 <- group_by(
  hst_kategorieBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_kategorie, gleich_entf_fakt_lg),
  hst_kategorie
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  hst_kategorieBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(hst_kategorieBoxplot,mapping = aes(
  x = as.numeric(hst_kategorie),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=hst_kategorie),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=hst_kategorie),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
 scale_x_continuous(breaks = 1:8, name = "Haltestellenkategorie (ÖROK)", labels = c("I", "II", "III", "IV", "V", "VI","VII","VIII")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:8, name = "Haltestellenkategorie (ÖROK)", labels = c("I", "II", "III", "IV", "V", "VI","VII","VIII")) +
  labs(x = "Haltestellenkategorie (ÖROK)",
           y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(hst_kategorieBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("I-VIII")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("I-VIII")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(4,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

## Unabhängige Variable: U-Bahnhaltestelle laut VAO-Datensatz

Fährt an der nächstgelegenen Haltestelle eine U-Bahn weg? Ja (1)/Nein (0)

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
hst_ubahn0 <- subset(Vergleich, hst_ubahn==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hst_ubahn1 <- subset(Vergleich, hst_ubahn==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(hst_ubahn0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hst_ubahn1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$hst_ubahn)
```

3. Hypothesentests

```{r}
anova_hst_ubahn <- aov(gleich_entf_fakt_lg~hst_ubahn,data=Vergleich)
summary(anova_hst_ubahn)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich$gleich_entf_fakt_lg, Vergleich$hst_ubahn,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_hst_ubahn), main = NULL)
plot(anova_hst_ubahn, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
hst_ubahnBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "hst_ubahn", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,hst_ubahn)

# Labels erstellen
text_labels1 <- group_by(
  hst_ubahnBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_ubahn, gleich_entf_fakt_lg),
  hst_ubahn
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  hst_ubahnBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(hst_ubahnBoxplot,mapping = aes(
  x = as.numeric(hst_ubahn),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=hst_ubahn),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=hst_ubahn),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "U-Bahnhaltestelle", labels = c("Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "U-Bahnhaltestelle", labels = c("Nein","Ja")) +
  labs(x = "U-Bahnhaltestelle",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(hst_ubahnBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(hst_ubahnBoxplot$gleich_entf_fakt_lg) # gesamt

hst_ubahnBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_ubahn, gleich_entf_fakt_lg) %>% group_by(hst_ubahn) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(hst_ubahnBoxplot$gleich_entf_fakt) # gesamt

hst_ubahnBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_ubahn, gleich_entf_fakt_lg) %>% group_by(hst_ubahn) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Straßenbahnhaltestelle laut VAO-Datensatz

Fährt an der nächstgelegenen Haltestelle eine Straßenbahn weg? Ja (1)/Nein (0)

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
hst_tram0 <- subset(Vergleich, hst_tram==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hst_tram1 <- subset(Vergleich, hst_tram==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(hst_tram0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hst_tram1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$hst_tram)
```

3. Hypothesentests

```{r}
t.test(gleich_entf_fakt_lg~hst_tram,data=Vergleich,var.equal=FALSE,alternative="two.sided")
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich, gleich_entf_fakt_lg ~ hst_tram, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
hst_tramBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "hst_tram", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,hst_tram)

# Labels erstellen
text_labels1 <- group_by(
  hst_tramBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_tram, gleich_entf_fakt_lg),
  hst_tram
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  hst_tramBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(hst_tramBoxplot,mapping = aes(
  x = as.numeric(hst_tram),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=hst_tram),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=hst_tram),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Straßenbahnhaltestelle", labels = c("Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Straßenbahnhaltestelle", labels = c("Nein","Ja")) +
  labs(x = "Straßenbahnhaltestelle",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(hst_tramBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(hst_tramBoxplot$gleich_entf_fakt_lg) # gesamt

hst_tramBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_tram, gleich_entf_fakt_lg) %>% group_by(hst_tram) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(hst_tramBoxplot$gleich_entf_fakt) # gesamt

hst_tramBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_tram, gleich_entf_fakt_lg) %>% group_by(hst_tram) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Bushaltestelle

Fährt an der nächstgelegenen Haltestelle ein Bus weg? Ja (1)/Nein (0)

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
hst_bus0 <- subset(Vergleich, hst_bus==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hst_bus1 <- subset(Vergleich, hst_bus==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(hst_bus0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hst_bus1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$hst_bus)
```

3. Hypothesentests

```{r}
anova_hst_bus <- aov(gleich_entf_fakt_lg~hst_bus,data=Vergleich)
summary(anova_hst_bus)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich$gleich_entf_fakt_lg, Vergleich$hst_bus,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_hst_bus), main = NULL)
plot(anova_hst_bus, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
hst_busBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "hst_bus", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,hst_bus)

# Labels erstellen
text_labels1 <- group_by(
  hst_busBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_bus, gleich_entf_fakt_lg),
  hst_bus
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  hst_busBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(hst_busBoxplot,mapping = aes(
  x = as.numeric(hst_bus),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=hst_bus),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=hst_bus),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Bushaltestelle", labels = c("Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Bushaltestelle", labels = c("Nein","Ja")) +
  labs(x = "Bushaltestelle",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(hst_busBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(hst_busBoxplot$gleich_entf_fakt_lg) # gesamt

hst_busBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_bus, gleich_entf_fakt_lg) %>% group_by(hst_bus) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(hst_busBoxplot$gleich_entf_fakt) # gesamt

hst_busBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_bus, gleich_entf_fakt_lg) %>% group_by(hst_bus) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Lokalbushaltestelle

Fährt an der nächstgelegenen Haltestelle ein Lokalbus weg? Ja (1)/Nein (0)

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
hst_lokbus0 <- subset(Vergleich, hst_lokbus==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hst_lokbus1 <- subset(Vergleich, hst_lokbus==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(hst_lokbus0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hst_lokbus1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$hst_lokbus)
```

3. Hypothesentests

```{r}
t.test(gleich_entf_fakt_lg~hst_lokbus,data=Vergleich,var.equal=FALSE,alternative="two.sided")
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich, gleich_entf_fakt_lg ~ hst_lokbus, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
hst_lokbusBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "hst_lokbus", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,hst_lokbus)

# Labels erstellen
text_labels1 <- group_by(
  hst_lokbusBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_lokbus, gleich_entf_fakt_lg),
  hst_lokbus
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  hst_lokbusBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(hst_lokbusBoxplot,mapping = aes(
  x = as.numeric(hst_lokbus),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=hst_lokbus),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=hst_lokbus),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 0:1, name = "Lokalbushaltestelle", labels = c("Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 0:1, name = "Lokalbushaltestelle", labels = c("Nein","Ja")) +
  labs(x = "Lokalbushaltestelle",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(hst_lokbusBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(hst_lokbusBoxplot$gleich_entf_fakt_lg) # gesamt

hst_lokbusBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_lokbus, gleich_entf_fakt_lg) %>% group_by(hst_lokbus) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(hst_lokbusBoxplot$gleich_entf_fakt) # gesamt

hst_lokbusBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_lokbus, gleich_entf_fakt_lg) %>% group_by(hst_lokbus) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Regionalbushaltestelle

Fährt an der nächstgelegenen Haltestelle ein Regionalbus weg? Ja (1)/Nein (0)

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
hst_regbus0 <- subset(Vergleich, hst_regbus==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hst_regbus1 <- subset(Vergleich, hst_regbus==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(hst_regbus0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hst_regbus1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$hst_regbus)
```

3. Hypothesentests

```{r}
t.test(gleich_entf_fakt_lg~hst_regbus,data=Vergleich,var.equal=FALSE,alternative="two.sided")
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich, gleich_entf_fakt_lg ~ hst_regbus, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
hst_regbusBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "hst_regbus", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,hst_regbus)

# Labels erstellen
text_labels1 <- group_by(
  hst_regbusBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_regbus, gleich_entf_fakt_lg),
  hst_regbus
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  hst_regbusBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(hst_regbusBoxplot,mapping = aes(
  x = as.numeric(hst_regbus),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=hst_regbus),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=hst_regbus),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 0:1, name = "Regionalbushaltestelle", labels = c("Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 0:1, name = "Regionalbushaltestelle", labels = c("Nein","Ja")) +
  labs(x = "Regionalbushaltestelle",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(hst_regbusBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(hst_regbusBoxplot$gleich_entf_fakt_lg) # gesamt

hst_regbusBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_regbus, gleich_entf_fakt_lg) %>% group_by(hst_regbus) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(hst_regbusBoxplot$gleich_entf_fakt) # gesamt

hst_regbusBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_regbus, gleich_entf_fakt_lg) %>% group_by(hst_regbus) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Bahnhaltestelle

Fährt an der nächstgelegenen Haltestelle eine Eisenbahn weg? Ja (1)/Nein (0)

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
hst_bahn0 <- subset(Vergleich, hst_bahn==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hst_bahn1 <- subset(Vergleich, hst_bahn==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(hst_bahn0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(hst_bahn1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$hst_bahn)
```

3. Hypothesentests

```{r}
t.test(gleich_entf_fakt_lg~hst_bahn,data=Vergleich,var.equal=FALSE,alternative="two.sided")
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich, gleich_entf_fakt_lg ~ hst_bahn, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
hst_bahnBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "hst_bahn", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,hst_bahn)

# Labels erstellen
text_labels1 <- group_by(
  hst_bahnBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_bahn, gleich_entf_fakt_lg),
  hst_bahn
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  hst_bahnBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(hst_bahnBoxplot,mapping = aes(
  x = as.numeric(hst_bahn),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=hst_bahn),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=hst_bahn),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 0:1, name = "Bahnhaltestelle", labels = c("Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 0:1, name = "Bahnhaltestelle", labels = c("Nein","Ja")) +
  labs(x = "U-Bahnhaltestelle",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(hst_bahnBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(hst_bahnBoxplot$gleich_entf_fakt_lg) # gesamt

hst_bahnBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_bahn, gleich_entf_fakt_lg) %>% group_by(hst_bahn) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(hst_bahnBoxplot$gleich_entf_fakt) # gesamt

hst_bahnBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_bahn, gleich_entf_fakt_lg) %>% group_by(hst_bahn) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

# Einlesen des Personendatensatzes von ÖU 2013/2014

```{r}
OeU_Pers <- read.csv('OeU2013_2014_Personendatensatz.csv', header = TRUE, sep = ";")
names(OeU_Pers)
```

## Datenaufbereitung

Negative Werte werden zu NAs umgewandelt, um besser rechnen zu können. 

```{r, results='hide',warning=FALSE}
OeU_Pers <- OeU_Pers %>% dplyr::na_if(-90)
OeU_Pers <- OeU_Pers %>% dplyr::na_if(-93)
```

Negative Werte werden zu NA umgeformt. "Nein"-Antworten, die im ÖU 2013/2014-Datensatz mit 2 codiert wurden, werden zu 0 codiert und so an den VAO-Datensatz angepasst.

```{r, results='hide'}
OeU_Pers <- OeU_Pers %>% mutate(pers_arbeitflex = replace(pers_arbeitflex, pers_arbeitflex == 2, 0),
                                pers_arbeittele = replace(pers_arbeittele, pers_arbeittele == 2, 0),
                                pers_arbeit_parkpl = case_when(pers_arbeit_parkpl == 2 ~ 0, # Nein (2) zu 0
                                                               pers_arbeit_parkpl == 3 ~ 2, # Unterschiedlich (3) zu 2
                                                               pers_arbeit_parkpl == 1 ~ 3),  # Ja (1) zu 3
                                pers_fs_krad = replace(pers_fs_krad, pers_fs_krad == 2, 0),
                                pers_fs_pkw = replace(pers_fs_pkw, pers_fs_pkw == 2, 0),
                                pers_fahrrad = replace(pers_fahrrad, pers_fahrrad == 2, 0),
                                pers_krad = replace(pers_krad, pers_krad == 2, 0),
                                pers_pkw = case_when(pers_pkw == 3 ~ 0, # Nie (3) zu 0
                                                     pers_pkw == 1 ~ 3,  # Jederzeit (1) zu 3
                                                     pers_pkw == 2 ~ 2), # Gelegentlich (2) bleibt 2
                                pers_oev_zeitkarte = replace(pers_oev_zeitkarte, pers_oev_zeitkarte == 2, 0),
                                pers_oev_ermaessigung = replace(pers_oev_ermaessigung, pers_oev_ermaessigung == 2, 0),
                                pers_navi_pkw = replace(pers_navi_pkw, pers_navi_pkw == 2, 0),
                                pers_navi_oev = replace(pers_navi_oev, pers_navi_oev == 2, 0),
                                pers_navi_andere = replace(pers_navi_andere, pers_navi_andere == 2, 0),
                                pers_betr_kind = replace(pers_betr_kind, pers_betr_kind == 2, 0),
                                pers_betr_verwandte = replace(pers_betr_verwandte, pers_betr_verwandte == 2, 0),
                                pers_betr_andere = replace(pers_betr_andere, pers_betr_andere == 2, 0))

OeU_Pers <- OeU_Pers %>% mutate(pers_arbeit_parkpl = replace(pers_arbeit_parkpl, pers_arbeit_parkpl == 0, 1)) # Nein (0) zu 1)
OeU_Pers <- OeU_Pers %>% mutate(pers_pkw = replace(pers_pkw, pers_pkw == 0, 1)) # Nie (0) zu 1
```

## Subset bilden für Einpersonenhaushalte

```{r, results='hide',warning=FALSE}
OeU_Pers$hh_nr <- as.factor(OeU_Pers$hh_nr)
Vergleich$hh_nr <- as.factor(Vergleich$hh_nr)

Vergleich1 <- full_join(Vergleich,OeU_Pers,by = "hh_nr")
Vergleich1 <- subset(Vergleich1, hh_gr==1)

str(Vergleich1)

Vergleich1$pers_alter_kat <- as.ordered(Vergleich1$pers_alter_kat)
Vergleich1$pers_geschlecht <- as.factor(Vergleich1$pers_geschlecht)
Vergleich1$pers_bildung <- as.ordered(Vergleich1$pers_bildung)
Vergleich1$pers_beruf <- as.ordered(Vergleich1$pers_beruf)
Vergleich1$pers_arbeitflex <- as.factor(Vergleich1$pers_arbeitflex)
Vergleich1$pers_arbeittele <- as.factor(Vergleich1$pers_arbeittele)
Vergleich1$pers_arbeit_parkpl <- as.factor(Vergleich1$pers_arbeit_parkpl)
Vergleich1$pers_fs_krad <- as.factor(Vergleich1$pers_fs_krad)
Vergleich1$pers_fs_pkw <- as.factor(Vergleich1$pers_fs_pkw)
Vergleich1$pers_fahrrad <- as.factor(Vergleich1$pers_fahrrad)
Vergleich1$pers_krad <- as.factor(Vergleich1$pers_krad)
Vergleich1$pers_pkw <- as.ordered(Vergleich1$pers_pkw)
Vergleich1$pers_oev_zeitkarte <- as.factor(Vergleich1$pers_oev_zeitkarte)
Vergleich1$pers_oev_ermaessigung <- as.factor(Vergleich1$pers_oev_ermaessigung)
Vergleich1$pers_navi_pkw <- as.factor(Vergleich1$pers_navi_pkw)
Vergleich1$pers_navi_oev <- as.factor(Vergleich1$pers_navi_oev)
Vergleich1$pers_navi_andere <- as.factor(Vergleich1$pers_navi_andere)
Vergleich1$pers_betr_kind <- as.factor(Vergleich1$pers_betr_kind)
Vergleich1$pers_betr_verwandte <- as.factor(Vergleich1$pers_betr_verwandte)
Vergleich1$pers_betr_andere <- as.factor(Vergleich1$pers_betr_andere)
```


## Umrechnen des Personendatensatzes auf Haushaltsebene

Da die Zugangszeiten nur auf Haushaltsebene vorhanden sind, ist der Personendatensatz auf Haushaltsebene umzurechnen. Allerdings ist dies nicht bei allen Variablen sinnvoll. Umrechnung der Arbeitsstunden auf Haushaltsebene funktionierte nicht, da vermutlich zu viele NAs enthalten sind. 

```{r, results='hide',warning=FALSE}
OeU_Pers_HH <- OeU_Pers %>% 
  group_by(hh_nr) %>% 
  summarise(mean_pers_alter=round(mean(pers_alter,na.rm = TRUE), digits = 0),
            max_pers_bildung=max(pers_bildung,na.rm = TRUE),
            mean_pers_arbeitsstd=mean(pers_arbeitsstd,na.rm = TRUE),
            max_pers_arbeitflex=max(pers_arbeitflex,na.rm = TRUE),
            max_pers_arbeittele=max(pers_arbeittele,na.rm = TRUE),
            max_pers_arbeit_parkpl=max(pers_arbeit_parkpl,na.rm = TRUE),
            max_pers_fs_krad=max(pers_fs_krad,na.rm = TRUE),
            max_pers_fs_pkw=max(pers_fs_pkw,na.rm = TRUE),
            max_pers_fahrrad=max(pers_fahrrad,na.rm = TRUE),
            max_pers_krad=max(pers_krad,na.rm = TRUE),
            max_pers_pkw=max(pers_pkw,na.rm = TRUE),
            max_pers_oev_zeitkarte=max(pers_oev_zeitkarte,na.rm = TRUE),
            max_pers_oev_ermaessigung=max(pers_oev_ermaessigung,na.rm = TRUE),
            max_pers_navi_pkw=max(pers_navi_pkw,na.rm = TRUE),
            max_pers_navi_oev=max(pers_navi_oev,na.rm = TRUE),
            max_pers_navi_andere=max(pers_navi_andere,na.rm = TRUE),
            max_pers_betr_kind=max(pers_betr_kind,na.rm = TRUE),
            max_pers_betr_verwandte=max(pers_betr_verwandte,na.rm = TRUE),
            max_pers_betr_andere=max(pers_betr_andere,na.rm = TRUE),
            mean_pers_oev_zeitkarte=mean(pers_oev_zeitkarte,na.rm = TRUE))
OeU_Pers_HH <- mutate(OeU_Pers_HH, mean_pers_alter_kat = cut(mean_pers_alter, c(6,14,19,24,34,44,54,64,120),labels = c("1","2","3","4","5","6","7","8")))
```

Negative Werte werden zu NAs umgewandelt, um besser rechnen zu können. 

```{r, results='hide',warning=FALSE}
OeU_Pers_HH <- OeU_Pers_HH %>% dplyr::na_if(-90)
OeU_Pers_HH <- OeU_Pers_HH %>% dplyr::na_if(-93)
```


## Einführen eines ÖV-Nutzungsfaktors nach ÖV-Zeitkartenbesitz

Auf Haushaltsebene: Besitzen alle Personen des Haushalts eine ÖV-Zeitkarte oder nur manche oder niemand?
- 0 ... niemand besitzt eine ÖV-Zeitkarte
- 1 ... mindestens eine Person im Haushalt, aber nicht jede besitzt eine ÖV-Zeitkarte
- 2 ... alle Personen im Haushalt besitzen eine ÖV-Zeitkarte

```{r, results='hide',warning=FALSE}
OeU_Pers_HH <- mutate(OeU_Pers_HH, mean_pers_oev_zeitkarte = ifelse(mean_pers_oev_zeitkarte == 0,0,ifelse(mean_pers_oev_zeitkarte == 1, 2, 1)))
OeU_Pers_HH <- rename(OeU_Pers_HH, nutz_oev_zeitkarte = mean_pers_oev_zeitkarte)
```


### Klassifizieren der Daten

Die Klassifizierung ist für die statistische Auswertung erforderlich. 

```{r}
str(OeU_Pers_HH)
```

```{r, results='hide'}
OeU_Pers_HH$hh_nr <- as.factor(OeU_Pers_HH$hh_nr)
OeU_Pers_HH$mean_pers_alter_kat <- as.factor(OeU_Pers_HH$mean_pers_alter_kat)
OeU_Pers_HH$max_pers_bildung <- as.ordered(OeU_Pers_HH$max_pers_bildung)
OeU_Pers_HH$max_pers_arbeitflex <- as.factor(OeU_Pers_HH$max_pers_arbeitflex)
OeU_Pers_HH$max_pers_arbeittele <- as.factor(OeU_Pers_HH$max_pers_arbeittele)
OeU_Pers_HH$max_pers_arbeit_parkpl <- as.factor(OeU_Pers_HH$max_pers_arbeit_parkpl)
OeU_Pers_HH$max_pers_fs_krad <- as.factor(OeU_Pers_HH$max_pers_fs_krad)
OeU_Pers_HH$max_pers_fs_pkw <- as.factor(OeU_Pers_HH$max_pers_fs_pkw)
OeU_Pers_HH$max_pers_fahrrad <- as.factor(OeU_Pers_HH$max_pers_fahrrad)
OeU_Pers_HH$max_pers_krad <- as.factor(OeU_Pers_HH$max_pers_krad)
OeU_Pers_HH$max_pers_pkw <- as.ordered(OeU_Pers_HH$max_pers_pkw)
OeU_Pers_HH$max_pers_oev_zeitkarte <- as.factor(OeU_Pers_HH$max_pers_oev_zeitkarte)
OeU_Pers_HH$max_pers_oev_ermaessigung <- as.factor(OeU_Pers_HH$max_pers_oev_ermaessigung)
OeU_Pers_HH$max_pers_navi_pkw <- as.factor(OeU_Pers_HH$max_pers_navi_pkw)
OeU_Pers_HH$max_pers_navi_oev <- as.factor(OeU_Pers_HH$max_pers_navi_oev)
OeU_Pers_HH$max_pers_navi_andere <- as.factor(OeU_Pers_HH$max_pers_navi_andere)
OeU_Pers_HH$max_pers_betr_kind <- as.factor(OeU_Pers_HH$max_pers_betr_kind)
OeU_Pers_HH$max_pers_betr_verwandte <- as.factor(OeU_Pers_HH$max_pers_betr_verwandte)
OeU_Pers_HH$max_pers_betr_andere <- as.factor(OeU_Pers_HH$max_pers_betr_andere)
```

```{r}
str(Vergleich)
```

### Hinzufügen zum Datensatz "Vergleich"

Die auf Haushaltsebene umgerechneten Personendaten werden an den Datensatz "Vergleich" angehängt. 

```{r, results='hide'}
Vergleich <- full_join(Vergleich,OeU_Pers_HH,by = "hh_nr")
Vergleich <- Vergleich %>% dplyr::na_if(-Inf)
Vergleich <- Vergleich %>% dplyr::na_if(Inf)
names(Vergleich)
```

# Untersuchen möglicher Einflussfaktoren auf den Kenntnisstand

## Unabhängige Variable: Geschlecht (Einpersonenhaushalte)

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
pers_geschlecht1 <- subset(Vergleich1, pers_geschlecht==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_geschlecht2 <- subset(Vergleich1, pers_geschlecht==2,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(pers_geschlecht1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_geschlecht2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_geschlecht)
```

3. Hypothesentests

```{r}
anova_pers_geschlecht <- aov(gleich_entf_fakt_lg~pers_geschlecht,data=Vergleich1)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_geschlecht,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_pers_geschlecht), main = NULL)
plot(anova_pers_geschlecht, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
pers_geschlechtBoxplot <- subset(Vergleich1, select=c("gleich_entf_kat", "pers_geschlecht", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,pers_geschlecht)

# Labels erstellen
text_labels1 <- group_by(
  pers_geschlechtBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_geschlecht, gleich_entf_fakt_lg),
  pers_geschlecht
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  pers_geschlechtBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(pers_geschlechtBoxplot,mapping = aes(
  x = as.numeric(pers_geschlecht),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=pers_geschlecht),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=pers_geschlecht),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Geschlecht (Einpersonenhaushalte)", labels = c("Männlich", "Weiblich")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Geschlecht (Einpersonenhaushalte)", labels = c("Männlich", "Weiblich")) +
  labs(x = "Geschlecht (Einpersonenhaushalte)",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(pers_geschlechtBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

## Unabhängige Variable: Durchschnittliche Alterskategorie

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
mean_pers_alter_kat1 <- subset(Vergleich, mean_pers_alter_kat==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
mean_pers_alter_kat2 <- subset(Vergleich, mean_pers_alter_kat==2,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
mean_pers_alter_kat3 <- subset(Vergleich, mean_pers_alter_kat==3,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
mean_pers_alter_kat4 <- subset(Vergleich, mean_pers_alter_kat==4,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
mean_pers_alter_kat5 <- subset(Vergleich, mean_pers_alter_kat==5,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
mean_pers_alter_kat6 <- subset(Vergleich, mean_pers_alter_kat==6,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
mean_pers_alter_kat7 <- subset(Vergleich, mean_pers_alter_kat==7,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
mean_pers_alter_kat8 <- subset(Vergleich, mean_pers_alter_kat==8,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(3,3))
hist(mean_pers_alter_kat1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(mean_pers_alter_kat2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(mean_pers_alter_kat3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(mean_pers_alter_kat4$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(mean_pers_alter_kat5$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(mean_pers_alter_kat6$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(mean_pers_alter_kat7$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(mean_pers_alter_kat8$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$mean_pers_alter_kat)
```

3. Hypothesentests

```{r}
oneway.test(gleich_entf_fakt_lg ~ mean_pers_alter_kat, data=Vergleich)
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich, gleich_entf_fakt_lg ~ mean_pers_alter_kat, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
mean_pers_alter_katBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "mean_pers_alter_kat", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,mean_pers_alter_kat)

# Labels erstellen
text_labels1 <- group_by(
  mean_pers_alter_katBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, mean_pers_alter_kat, gleich_entf_fakt_lg),
  mean_pers_alter_kat
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  mean_pers_alter_katBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(mean_pers_alter_katBoxplot,mapping = aes(
  x = as.numeric(mean_pers_alter_kat),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=mean_pers_alter_kat),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=mean_pers_alter_kat),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:8, name = "Durchschnittliches Alter [Jahre]", labels = c("6-14", "15-19", "20-24", "25-34", "35-44", "45-54","55-64","65+")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:8, name = "Durchschnittliches Alter [Jahre]", labels = c("6-14", "15-19", "20-24", "25-34", "35-44", "45-54","55-64","65+")) +
  labs(x = "Durchschnittliches Alter [Jahre]",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(mean_pers_alter_katBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("6-65+")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("6-65+")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(4,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

## Unabhängige Variable: Alterskategorie (Einpersonenhaushalte)

Null Beobachtungen in der Alterskategorie 6-14 Jahre. 

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
pers_alter_kat1 <- subset(Vergleich1, pers_alter_kat==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_alter_kat2 <- subset(Vergleich1, pers_alter_kat==2,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_alter_kat3 <- subset(Vergleich1, pers_alter_kat==3,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_alter_kat4 <- subset(Vergleich1, pers_alter_kat==4,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_alter_kat5 <- subset(Vergleich1, pers_alter_kat==5,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_alter_kat6 <- subset(Vergleich1, pers_alter_kat==6,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_alter_kat7 <- subset(Vergleich1, pers_alter_kat==7,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_alter_kat8 <- subset(Vergleich1, pers_alter_kat==8,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(3,3))
hist(pers_alter_kat2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_alter_kat3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_alter_kat4$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_alter_kat5$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_alter_kat6$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_alter_kat7$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_alter_kat8$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_alter_kat)
```

3. Hypothesentests

```{r}
anova_pers_alter_kat <- aov(gleich_entf_fakt_lg~pers_alter_kat,data=Vergleich1)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_alter_kat,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_pers_alter_kat), main = NULL)
plot(anova_pers_alter_kat, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
pers_alter_katBoxplot <- subset(Vergleich1, select=c("gleich_entf_kat", "pers_alter_kat", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,pers_alter_kat)

# Labels erstellen
text_labels1 <- group_by(
  pers_alter_katBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_alter_kat, gleich_entf_fakt_lg),
  pers_alter_kat
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  pers_alter_katBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(pers_alter_katBoxplot,mapping = aes(
  x = as.numeric(pers_alter_kat),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=pers_alter_kat),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=pers_alter_kat),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:7, name = "Alter [Jahre] (Einpersonenhaushalte)", labels = c("15-19", "20-24", "25-34", "35-44", "45-54","55-64","65+")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:7, name = "Alter [Jahre] (Einpersonenhaushalte)", labels = c("15-19", "20-24", "25-34", "35-44", "45-54","55-64","65+")) +
  labs(x = "Alter [Jahre] (Einpersonenhaushalte)",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(pers_alter_katBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("6-65+")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("6-65+")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(4,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

## Unabhängige Variable: Höchste abgeschlossene Ausbildung

Die jeweils höchste Ausbildung von den in einem Haushalt lebenden Personen wird hierfür herangezogen. 

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
max_pers_bildung1 <- subset(Vergleich, max_pers_bildung==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
max_pers_bildung2 <- subset(Vergleich, max_pers_bildung==2,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
max_pers_bildung3 <- subset(Vergleich, max_pers_bildung==3,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
max_pers_bildung4 <- subset(Vergleich, max_pers_bildung==4,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
max_pers_bildung5 <- subset(Vergleich, max_pers_bildung==5,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(2,3))
hist(max_pers_bildung1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(max_pers_bildung2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(max_pers_bildung3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(max_pers_bildung4$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(max_pers_bildung5$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_bildung)
```

3. Hypothesentests

```{r}
oneway.test(gleich_entf_fakt_lg ~ max_pers_bildung, data=Vergleich)
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich, gleich_entf_fakt_lg ~ max_pers_bildung, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
max_pers_bildungBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "max_pers_bildung", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,max_pers_bildung)

# Labels erstellen
text_labels1 <- group_by(
  max_pers_bildungBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_bildung, gleich_entf_fakt_lg),
  max_pers_bildung
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  max_pers_bildungBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(max_pers_bildungBoxplot,mapping = aes(
  x = as.numeric(max_pers_bildung),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=max_pers_bildung),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=max_pers_bildung),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:6, name = "Höchste abgeschlossene Ausbildung", labels = c("","noch kein\nSchulabschluss", "Pflicht-\nschule", "Lehre/\nFachschule", "Matura", "Hochschule")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:6, name = "Höchste abgeschlossene Ausbildung", labels = c("","noch kein\nSchulabschluss", "Pflicht-\nschule", "Lehre/\nFachschule", "Matura", "Hochschule")) +
  labs(x = "Höchste abgeschlossene Ausbildung",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(max_pers_bildungBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c(" \n ")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c(" \n ")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(4,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

## Unabhängige Variable: Höchste abgeschlossene Ausbildung (Einpersonenhaushalte)

Die höchste abgeschlossene Ausbildung von in Einpersonenhaushalten lebenden Personen wird hierfür herangezogen. 

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
pers_bildung1 <- subset(Vergleich1, pers_bildung==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_bildung2 <- subset(Vergleich1, pers_bildung==2,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_bildung3 <- subset(Vergleich1, pers_bildung==3,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_bildung4 <- subset(Vergleich1, pers_bildung==4,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_bildung5 <- subset(Vergleich1, pers_bildung==5,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(2,3))
hist(pers_bildung1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_bildung2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_bildung3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_bildung4$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_bildung5$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_bildung)
```

3. Hypothesentests

```{r}
oneway.test(gleich_entf_fakt_lg ~ pers_bildung, data=Vergleich1)
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich1, gleich_entf_fakt_lg ~ pers_bildung, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
pers_bildungBoxplot <- subset(Vergleich1, select=c("gleich_entf_kat", "pers_bildung", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,pers_bildung)

# Labels erstellen
text_labels1 <- group_by(
  pers_bildungBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_bildung, gleich_entf_fakt_lg),
  pers_bildung
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  pers_bildungBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(pers_bildungBoxplot,mapping = aes(
  x = as.numeric(pers_bildung),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=pers_bildung),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=pers_bildung),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:5, name = "Höchste abgeschlossene Ausbildung (Einpersonenhaushalte)", labels = c("noch kein\nSchulabschluss", "Pflicht-\nschule", "Lehre/\nFachschule", "Matura", "Hochschule")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:5, name = "Höchste abgeschlossene Ausbildung (Einpersonenhaushalte)", labels = c("noch kein\nSchulabschluss", "Pflicht-\nschule", "Lehre/\nFachschule", "Matura", "Hochschule")) +
  labs(x = "Höchste abgeschlossene Ausbildung",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(pers_bildungBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c(" \n ")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c(" \n ")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(4,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

## Unabhängige Variable: Beruf (Einpersonenhaushalte)

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
pers_beruf1 <- subset(Vergleich1, pers_beruf==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_beruf2 <- subset(Vergleich1, pers_beruf==2,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_beruf3 <- subset(Vergleich1, pers_beruf==3,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_beruf4 <- subset(Vergleich1, pers_beruf==4,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(2,2))
hist(pers_beruf1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_beruf2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_beruf3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_beruf4$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_beruf)
```

3. Hypothesentests

```{r}
anova_pers_beruf <- aov(gleich_entf_fakt_lg~pers_beruf,data=Vergleich1)
summary(anova_pers_beruf)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_beruf,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_pers_beruf), main = NULL)
plot(anova_pers_beruf, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
pers_berufBoxplot <- subset(Vergleich1, select=c("gleich_entf_kat", "pers_beruf", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,pers_beruf)

# Labels erstellen
text_labels1 <- group_by(
  pers_berufBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_beruf, gleich_entf_fakt_lg),
  pers_beruf
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  pers_berufBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(pers_berufBoxplot,mapping = aes(
  x = as.numeric(pers_beruf),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=pers_beruf),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=pers_beruf),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:4, name = "Beschäftigung (Einpersonenhaushalte)", labels = c("In Ausbildung", "Erwerbstätig", "Pension", "Andere Tätigkeit")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:4, name = "Beschäftigung (Einpersonenhaushalte)", labels = c("In Ausbildung", "Erwerbstätig", "Pension", "Andere Tätigkeit")) +
  labs(x = "Beschäftigung",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(pers_berufBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c(" \n ")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c(" \n ")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(3.5,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

## Unabhängige Variable: Flexible Arbeitszeiten

Hat eine Person im Haushalt flexible Arbeitszeiten? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
max_pers_arbeitflex0 <- subset(Vergleich, max_pers_arbeitflex==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
max_pers_arbeitflex1 <- subset(Vergleich, max_pers_arbeitflex==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(max_pers_arbeitflex0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(max_pers_arbeitflex1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_arbeitflex)
```

3. Hypothesentests

```{r}
anova_max_pers_arbeitflex <- aov(gleich_entf_fakt_lg~max_pers_arbeitflex,data=Vergleich)
summary(anova_max_pers_arbeitflex)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_arbeitflex,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_max_pers_arbeitflex), main = NULL)
plot(anova_max_pers_arbeitflex, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
max_pers_arbeitflexBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "max_pers_arbeitflex", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,max_pers_arbeitflex)

# Labels erstellen
text_labels1 <- group_by(
  max_pers_arbeitflexBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_arbeitflex, gleich_entf_fakt_lg),
  max_pers_arbeitflex
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  max_pers_arbeitflexBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(max_pers_arbeitflexBoxplot,mapping = aes(
  x = as.numeric(max_pers_arbeitflex),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=max_pers_arbeitflex),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=max_pers_arbeitflex),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:3, name = "Flexible Arbeitszeiten", labels = c("","Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:3, name = "Flexible Arbeitszeiten", labels = c("","Nein", "Ja")) +
  labs(x = "Flexible Arbeitszeiten",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(max_pers_arbeitflexBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(max_pers_arbeitflexBoxplot$gleich_entf_fakt_lg) # gesamt

max_pers_arbeitflexBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_arbeitflex, gleich_entf_fakt_lg) %>% group_by(max_pers_arbeitflex) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(max_pers_arbeitflexBoxplot$gleich_entf_fakt) # gesamt

max_pers_arbeitflexBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_arbeitflex, gleich_entf_fakt_lg) %>% group_by(max_pers_arbeitflex) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Flexible Arbeitszeiten (Einpersonenhaushalte)

Hat für die im Einpersonenhaushalt lebende Person flexible Arbeitszeiten? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
pers_arbeitflex0 <- subset(Vergleich1, pers_arbeitflex==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_arbeitflex1 <- subset(Vergleich1, pers_arbeitflex==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(pers_arbeitflex0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_arbeitflex1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_arbeitflex)
```

3. Hypothesentests

```{r}
t.test(gleich_entf_fakt_lg~pers_arbeitflex,data=Vergleich1,var.equal=FALSE,alternative="two.sided")
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich1, gleich_entf_fakt_lg ~ pers_arbeitflex, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
pers_arbeitflexBoxplot <- subset(Vergleich1, select=c("gleich_entf_kat", "pers_arbeitflex", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,pers_arbeitflex)

# Labels erstellen
text_labels1 <- group_by(
  pers_arbeitflexBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_arbeitflex, gleich_entf_fakt_lg),
  pers_arbeitflex
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  pers_arbeitflexBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(pers_arbeitflexBoxplot,mapping = aes(
  x = as.numeric(pers_arbeitflex),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=pers_arbeitflex),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=pers_arbeitflex),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Flexible Arbeitszeiten (Einpersonenhaushalte)", labels = c("Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Flexible Arbeitszeiten (Einpersonenhaushalte)", labels = c("Nein", "Ja")) +
  labs(x = "Flexible Arbeitszeiten (Einpersonenhaushalte)",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(pers_arbeitflexBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(pers_arbeitflexBoxplot$gleich_entf_fakt_lg) # gesamt

pers_arbeitflexBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_arbeitflex, gleich_entf_fakt_lg) %>% group_by(pers_arbeitflex) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(pers_arbeitflexBoxplot$gleich_entf_fakt) # gesamt

pers_arbeitflexBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_arbeitflex, gleich_entf_fakt_lg) %>% group_by(pers_arbeitflex) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Telearbeit

Ist Telearbeit für zumindest eine Person im Haushalt möglich? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
max_pers_arbeittele0 <- subset(Vergleich, max_pers_arbeittele==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
max_pers_arbeittele1 <- subset(Vergleich, max_pers_arbeittele==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(max_pers_arbeittele0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(max_pers_arbeittele1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_arbeittele)
```

3. Hypothesentests

```{r}
anova_max_pers_arbeittele <- aov(gleich_entf_fakt_lg~max_pers_arbeittele,data=Vergleich)
summary(anova_max_pers_arbeittele)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_arbeittele,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_max_pers_arbeittele), main = NULL)
plot(anova_max_pers_arbeittele, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
max_pers_arbeitteleBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "max_pers_arbeittele", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,max_pers_arbeittele)

# Labels erstellen
text_labels1 <- group_by(
  max_pers_arbeitteleBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_arbeittele, gleich_entf_fakt_lg),
  max_pers_arbeittele
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  max_pers_arbeitteleBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(max_pers_arbeitteleBoxplot,mapping = aes(
  x = as.numeric(max_pers_arbeittele),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=max_pers_arbeittele),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=max_pers_arbeittele),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:3, name = "Telearbeit", labels = c("","Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:3, name = "Telearbeit", labels = c("","Nein", "Ja")) +
  labs(x = "Telearbeit",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(max_pers_arbeitteleBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(max_pers_arbeitteleBoxplot$gleich_entf_fakt_lg) # gesamt

max_pers_arbeitteleBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_arbeittele, gleich_entf_fakt_lg) %>% group_by(max_pers_arbeittele) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(max_pers_arbeitteleBoxplot$gleich_entf_fakt) # gesamt

max_pers_arbeitteleBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_arbeittele, gleich_entf_fakt_lg) %>% group_by(max_pers_arbeittele) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Telearbeit (Einpersonenhaushalte)

Ist Telearbeit für die im Einpersonenhaushalt lebende Person möglich? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
pers_arbeittele0 <- subset(Vergleich1, pers_arbeittele==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_arbeittele1 <- subset(Vergleich1, pers_arbeittele==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(pers_arbeittele0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_arbeittele1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_arbeittele)
```

3. Hypothesentests

```{r}
anova_pers_arbeittele <- aov(gleich_entf_fakt_lg~pers_arbeittele,data=Vergleich1)
summary(anova_pers_arbeittele)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_arbeittele,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_pers_arbeittele), main = NULL)
plot(anova_pers_arbeittele, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
pers_arbeitteleBoxplot <- subset(Vergleich1, select=c("gleich_entf_kat", "pers_arbeittele", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,pers_arbeittele)

# Labels erstellen
text_labels1 <- group_by(
  pers_arbeitteleBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_arbeittele, gleich_entf_fakt_lg),
  pers_arbeittele
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  pers_arbeitteleBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(pers_arbeitteleBoxplot,mapping = aes(
  x = as.numeric(pers_arbeittele),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=pers_arbeittele),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=pers_arbeittele),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Telearbeit (Einpersonenhaushalte)", labels = c("Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Telearbeit (Einpersonenhaushalte)", labels = c("Nein", "Ja")) +
  labs(x = "Telearbeit (Einpersonenhaushalte)",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(pers_arbeitteleBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(pers_arbeitteleBoxplot$gleich_entf_fakt_lg) # gesamt

pers_arbeitteleBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_arbeittele, gleich_entf_fakt_lg) %>% group_by(pers_arbeittele) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(pers_arbeitteleBoxplot$gleich_entf_fakt) # gesamt

pers_arbeitteleBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_arbeittele, gleich_entf_fakt_lg) %>% group_by(pers_arbeittele) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: PKW-Abstellplatz am Arbeitsplatz

Hat zumindest eine Person aus dem Haushalt eine PKW-Abstellmöglichkeit am Arbeitsplatz? 
- 1 ... Nein
- 2 ... Unterschiedlich
- 3 ... Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
max_pers_arbeit_parkpl1 <- subset(Vergleich, max_pers_arbeit_parkpl==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
max_pers_arbeit_parkpl2 <- subset(Vergleich, max_pers_arbeit_parkpl==2,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
max_pers_arbeit_parkpl3 <- subset(Vergleich, max_pers_arbeit_parkpl==3,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,3))
hist(max_pers_arbeit_parkpl1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(max_pers_arbeit_parkpl2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(max_pers_arbeit_parkpl3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_arbeit_parkpl)
```

3. Hypothesentests

```{r}
oneway.test(gleich_entf_fakt_lg ~ max_pers_arbeit_parkpl, data=Vergleich)
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich, gleich_entf_fakt_lg ~ max_pers_arbeit_parkpl, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
max_pers_arbeit_parkplBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "max_pers_arbeit_parkpl", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,max_pers_arbeit_parkpl)

# Labels erstellen
text_labels1 <- group_by(
  max_pers_arbeit_parkplBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_arbeit_parkpl, gleich_entf_fakt_lg),
  max_pers_arbeit_parkpl
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  max_pers_arbeit_parkplBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(max_pers_arbeit_parkplBoxplot,mapping = aes(
  x = as.numeric(max_pers_arbeit_parkpl),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=max_pers_arbeit_parkpl),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=max_pers_arbeit_parkpl),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:4, name = "Pkw-Abstellplatz am Arbeitsplatz", labels = c("","Nein", "Unterschiedlich","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:4, name = "Pkw-Abstellplatz am Arbeitsplatz", labels = c("","Nein", "Unterschiedlich","Ja")) +
  labs(x = "Pkw-Abstellplatz am Arbeitsplatz",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(max_pers_arbeit_parkplBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(3,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(max_pers_arbeit_parkplBoxplot$gleich_entf_fakt_lg) # gesamt

max_pers_arbeit_parkplBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_arbeit_parkpl, gleich_entf_fakt_lg) %>% group_by(max_pers_arbeit_parkpl) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(max_pers_arbeit_parkplBoxplot$gleich_entf_fakt) # gesamt

max_pers_arbeit_parkplBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_arbeit_parkpl, gleich_entf_fakt_lg) %>% group_by(max_pers_arbeit_parkpl) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Pkw-Abstellplatz am Arbeitsplatz (Einpersonenhaushalte)

Hat eine Person in einem Einpersonenhaushalt eine PKW-Abstellmöglichkeit am Arbeitsplatz? 
- 1 ... Nein
- 2 ... Unterschiedlich
- 3 ... Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
pers_arbeit_parkpl1 <- subset(Vergleich1, pers_arbeit_parkpl==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_arbeit_parkpl2 <- subset(Vergleich1, pers_arbeit_parkpl==2,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_arbeit_parkpl3 <- subset(Vergleich1, pers_arbeit_parkpl==3,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,3))
hist(pers_arbeit_parkpl1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_arbeit_parkpl2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_arbeit_parkpl3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_arbeit_parkpl)
```

3. Hypothesentests

```{r}
oneway.test(gleich_entf_fakt_lg ~ pers_arbeit_parkpl, data=Vergleich1)
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich1, gleich_entf_fakt_lg ~ pers_arbeit_parkpl, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
pers_arbeit_parkplBoxplot <- subset(Vergleich1, select=c("gleich_entf_kat", "pers_arbeit_parkpl", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,pers_arbeit_parkpl)

# Labels erstellen
text_labels1 <- group_by(
  pers_arbeit_parkplBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_arbeit_parkpl, gleich_entf_fakt_lg),
  pers_arbeit_parkpl
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  pers_arbeit_parkplBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(pers_arbeit_parkplBoxplot,mapping = aes(
  x = as.numeric(pers_arbeit_parkpl),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=pers_arbeit_parkpl),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=pers_arbeit_parkpl),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:3, name = "Pkw-Abstellplatz am Arbeitsplatz (Einpersonenhaushalte)", labels = c("Nein", "Unterschiedlich","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:3, name = "Pkw-Abstellplatz am Arbeitsplatz (Einpersonenhaushalte)", labels = c("Nein", "Unterschiedlich","Ja")) +
  labs(x = "Pkw-Abstellplatz am Arbeitsplatz (Einpersonenhaushalte)",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(pers_arbeit_parkplBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(3,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(pers_arbeit_parkplBoxplot$gleich_entf_fakt_lg) # gesamt

pers_arbeit_parkplBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_arbeit_parkpl, gleich_entf_fakt_lg) %>% group_by(pers_arbeit_parkpl) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(pers_arbeit_parkplBoxplot$gleich_entf_fakt) # gesamt

pers_arbeit_parkplBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_arbeit_parkpl, gleich_entf_fakt_lg) %>% group_by(pers_arbeit_parkpl) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Führerscheinbesitz Moped/Motorrad

Hat zumindest eine Person aus dem Haushalt einen Führerschein für Moped oder Motorrad? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
max_pers_fs_krad0 <- subset(Vergleich, max_pers_fs_krad==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
max_pers_fs_krad1 <- subset(Vergleich, max_pers_fs_krad==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(max_pers_fs_krad0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(max_pers_fs_krad1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_fs_krad)
```

3. Hypothesentests

```{r}
anova_max_pers_fs_krad <- aov(gleich_entf_fakt_lg~max_pers_fs_krad,data=Vergleich)
summary(anova_max_pers_fs_krad)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_fs_krad,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_max_pers_fs_krad), main = NULL)
plot(anova_max_pers_fs_krad, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
max_pers_fs_kradBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "max_pers_fs_krad", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,max_pers_fs_krad)

# Labels erstellen
text_labels1 <- group_by(
  max_pers_fs_kradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_fs_krad, gleich_entf_fakt_lg),
  max_pers_fs_krad
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  max_pers_fs_kradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(max_pers_fs_kradBoxplot,mapping = aes(
  x = as.numeric(max_pers_fs_krad),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=max_pers_fs_krad),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=max_pers_fs_krad),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:3, name = "Führerscheinbesitz Moped/Motorrad", labels = c("","Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:3, name = "Führerscheinbesitz Moped/Motorrad", labels = c("","Nein","Ja")) +
  labs(x = "Führerscheinbesitz Moped/Motorrad",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(max_pers_fs_kradBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(max_pers_fs_kradBoxplot$gleich_entf_fakt_lg) # gesamt

max_pers_fs_kradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_fs_krad, gleich_entf_fakt_lg) %>% group_by(max_pers_fs_krad) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(max_pers_fs_kradBoxplot$gleich_entf_fakt) # gesamt

max_pers_fs_kradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_fs_krad, gleich_entf_fakt_lg) %>% group_by(max_pers_fs_krad) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Führerscheinbesitz Moped/Motorrad (Einpersonenhaushalte)

Hat eine in einem Einpersonenhaushalt wohnende Person einen Führerschein für Moped oder Motorrad? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
pers_fs_krad0 <- subset(Vergleich1, pers_fs_krad==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_fs_krad1 <- subset(Vergleich1, pers_fs_krad==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(pers_fs_krad0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_fs_krad1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_fs_krad)
```

3. Hypothesentests

```{r}
anova_pers_fs_krad <- aov(gleich_entf_fakt_lg~pers_fs_krad,data=Vergleich1)
summary(anova_pers_fs_krad)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_fs_krad,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_pers_fs_krad), main = NULL)
plot(anova_pers_fs_krad, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
pers_fs_kradBoxplot <- subset(Vergleich1, select=c("gleich_entf_kat", "pers_fs_krad", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,pers_fs_krad)

# Labels erstellen
text_labels1 <- group_by(
  pers_fs_kradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_fs_krad, gleich_entf_fakt_lg),
  pers_fs_krad
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  pers_fs_kradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(pers_fs_kradBoxplot,mapping = aes(
  x = as.numeric(pers_fs_krad),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=pers_fs_krad),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=pers_fs_krad),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Führerscheinbesitz Moped/Motorrad (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Führerscheinbesitz Moped/Motorrad (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  labs(x = "Führerscheinbesitz Moped/Motorrad (Einpersonenhaushalte)",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(pers_fs_kradBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(pers_fs_kradBoxplot$gleich_entf_fakt_lg) # gesamt

pers_fs_kradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_fs_krad, gleich_entf_fakt_lg) %>% group_by(pers_fs_krad) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(pers_fs_kradBoxplot$gleich_entf_fakt) # gesamt

pers_fs_kradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_fs_krad, gleich_entf_fakt_lg) %>% group_by(pers_fs_krad) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Führerscheinbesitz PKW

Hat zumindest eine Person aus dem Haushalt einen PKW-Führerschein? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
max_pers_fs_pkw0 <- subset(Vergleich, max_pers_fs_pkw==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
max_pers_fs_pkw1 <- subset(Vergleich, max_pers_fs_pkw==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(max_pers_fs_pkw0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(max_pers_fs_pkw1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_fs_pkw)
```

3. Hypothesentests

```{r}
anova_max_pers_fs_pkw <- aov(gleich_entf_fakt_lg~max_pers_fs_pkw,data=Vergleich)
summary(anova_max_pers_fs_pkw)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_fs_pkw,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_max_pers_fs_pkw), main = NULL)
plot(anova_max_pers_fs_pkw, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
max_pers_fs_pkwBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "max_pers_fs_pkw", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,max_pers_fs_pkw)

# Labels erstellen
text_labels1 <- group_by(
  max_pers_fs_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_fs_pkw, gleich_entf_fakt_lg),
  max_pers_fs_pkw
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  max_pers_fs_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(max_pers_fs_pkwBoxplot,mapping = aes(
  x = as.numeric(max_pers_fs_pkw),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=max_pers_fs_pkw),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=max_pers_fs_pkw),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:3, name = "Führerscheinbesitz PKW", labels = c("","Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:3, name = "Führerscheinbesitz PKW", labels = c("","Nein","Ja")) +
  labs(x = "Führerscheinbesitz PKW",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(max_pers_fs_pkwBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(max_pers_fs_pkwBoxplot$gleich_entf_fakt_lg) # gesamt

max_pers_fs_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_fs_pkw, gleich_entf_fakt_lg) %>% group_by(max_pers_fs_pkw) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(max_pers_fs_pkwBoxplot$gleich_entf_fakt) # gesamt

max_pers_fs_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_fs_pkw, gleich_entf_fakt_lg) %>% group_by(max_pers_fs_pkw) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Führerscheinbesitz PKW (Einpersonenhaushalte)

Hat zumindest eine Person aus dem Haushalt einen PKW-Führerschein? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
pers_fs_pkw0 <- subset(Vergleich1, pers_fs_pkw==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_fs_pkw1 <- subset(Vergleich1, pers_fs_pkw==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(pers_fs_pkw0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_fs_pkw1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_fs_pkw)
```

3. Hypothesentests

```{r}
anova_pers_fs_pkw <- aov(gleich_entf_fakt_lg~pers_fs_pkw,data=Vergleich1)
summary(anova_pers_fs_pkw)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_fs_pkw,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_pers_fs_pkw), main = NULL)
plot(anova_pers_fs_pkw, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
pers_fs_pkwBoxplot <- subset(Vergleich1, select=c("gleich_entf_kat", "pers_fs_pkw", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,pers_fs_pkw)

# Labels erstellen
text_labels1 <- group_by(
  pers_fs_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_fs_pkw, gleich_entf_fakt_lg),
  pers_fs_pkw
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  pers_fs_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(pers_fs_pkwBoxplot,mapping = aes(
  x = as.numeric(pers_fs_pkw),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=pers_fs_pkw),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=pers_fs_pkw),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Führerscheinbesitz PKW (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Führerscheinbesitz PKW (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  labs(x = "Führerscheinbesitz PKW (Einpersonenhaushalte)",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(pers_fs_pkwBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(pers_fs_pkwBoxplot$gleich_entf_fakt_lg) # gesamt

pers_fs_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_fs_pkw, gleich_entf_fakt_lg) %>% group_by(pers_fs_pkw) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(pers_fs_pkwBoxplot$gleich_entf_fakt) # gesamt

pers_fs_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_fs_pkw, gleich_entf_fakt_lg) %>% group_by(pers_fs_pkw) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Fahrzeugverfügbarkeit Fahrrad

Hat zumindest eine Person aus dem Haushalt ein Fahrrad? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
max_pers_fahrrad0 <- subset(Vergleich, max_pers_fahrrad==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
max_pers_fahrrad1 <- subset(Vergleich, max_pers_fahrrad==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(max_pers_fahrrad0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(max_pers_fahrrad1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_fahrrad)
```

3. Hypothesentests

```{r}
t.test(gleich_entf_fakt_lg~max_pers_fahrrad,data=Vergleich,var.equal=FALSE,alternative="two.sided")
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich, gleich_entf_fakt_lg ~ max_pers_fahrrad, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
max_pers_fahrradBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "max_pers_fahrrad", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,max_pers_fahrrad)

# Labels erstellen
text_labels1 <- group_by(
  max_pers_fahrradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_fahrrad, gleich_entf_fakt_lg),
  max_pers_fahrrad
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  max_pers_fahrradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(max_pers_fahrradBoxplot,mapping = aes(
  x = as.numeric(max_pers_fahrrad),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=max_pers_fahrrad),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=max_pers_fahrrad),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:3, name = "Verfügbarkeit Fahrrad", labels = c("","Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:3, name = "Verfügbarkeit Fahrrad", labels = c("","Nein","Ja")) +
  labs(x = "Verfügbarkeit Fahrrad",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(max_pers_fahrradBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(max_pers_fahrradBoxplot$gleich_entf_fakt_lg) # gesamt

max_pers_fahrradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_fahrrad, gleich_entf_fakt_lg) %>% group_by(max_pers_fahrrad) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(max_pers_fahrradBoxplot$gleich_entf_fakt) # gesamt

max_pers_fahrradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_fahrrad, gleich_entf_fakt_lg) %>% group_by(max_pers_fahrrad) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Fahrzeugverfügbarkeit Fahrrad (Einpersonenhaushalt)

Hat zumindest eine Person aus dem Haushalt ein Fahrrad? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
pers_fahrrad0 <- subset(Vergleich1, pers_fahrrad==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_fahrrad1 <- subset(Vergleich1, pers_fahrrad==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(pers_fahrrad0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_fahrrad1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_fahrrad)
```

3. Hypothesentests

```{r}
anova_pers_fahrrad <- aov(gleich_entf_fakt_lg~pers_fahrrad,data=Vergleich1)
summary(anova_pers_fahrrad)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_fahrrad,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_pers_fahrrad), main = NULL)
plot(anova_pers_fahrrad, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
pers_fahrradBoxplot <- subset(Vergleich1, select=c("gleich_entf_kat", "pers_fahrrad", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,pers_fahrrad)

# Labels erstellen
text_labels1 <- group_by(
  pers_fahrradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_fahrrad, gleich_entf_fakt_lg),
  pers_fahrrad
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  pers_fahrradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(pers_fahrradBoxplot,mapping = aes(
  x = as.numeric(pers_fahrrad),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=pers_fahrrad),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=pers_fahrrad),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Verfügbarkeit Fahrrad (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Verfügbarkeit Fahrrad (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  labs(x = "Verfügbarkeit Fahrrad (Einpersonenhaushalte)",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(pers_fahrradBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(pers_fahrradBoxplot$gleich_entf_fakt_lg) # gesamt

pers_fahrradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_fahrrad, gleich_entf_fakt_lg) %>% group_by(pers_fahrrad) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(pers_fahrradBoxplot$gleich_entf_fakt) # gesamt

pers_fahrradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_fahrrad, gleich_entf_fakt_lg) %>% group_by(pers_fahrrad) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Fahrzeugverfügbarkeit Moped/Motorrad

Hat zumindest eine Person aus dem Haushalt ein Moped/Motorrad? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
max_pers_krad0 <- subset(Vergleich, max_pers_krad==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
max_pers_krad1 <- subset(Vergleich, max_pers_krad==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(max_pers_krad0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(max_pers_krad1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_krad)
```

3. Hypothesentests

```{r}
anova_max_pers_krad <- aov(gleich_entf_fakt_lg~max_pers_krad,data=Vergleich)
summary(anova_max_pers_krad)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_krad,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_max_pers_krad), main = NULL)
plot(anova_max_pers_krad, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
max_pers_kradBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "max_pers_krad", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,max_pers_krad)

# Labels erstellen
text_labels1 <- group_by(
  max_pers_kradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_krad, gleich_entf_fakt_lg),
  max_pers_krad
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  max_pers_kradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(max_pers_kradBoxplot,mapping = aes(
  x = as.numeric(max_pers_krad),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=max_pers_krad),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=max_pers_krad),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:3, name = "Verfügbarkeit Moped/Motorrad", labels = c("","Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:3, name = "Verfügbarkeit Moped/Motorrad", labels = c("","Nein","Ja")) +
  labs(x = "Verfügbarkeit Moped/Motorrad",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(max_pers_kradBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(max_pers_kradBoxplot$gleich_entf_fakt_lg) # gesamt

max_pers_kradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_krad, gleich_entf_fakt_lg) %>% group_by(max_pers_krad) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(max_pers_kradBoxplot$gleich_entf_fakt) # gesamt

max_pers_kradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_krad, gleich_entf_fakt_lg) %>% group_by(max_pers_krad) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Fahrzeugverfügbarkeit Moped/Motorrad (Einpersonenhaushalte)

Hat zumindest eine Person aus dem Haushalt ein Moped/Motorrad? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
pers_krad0 <- subset(Vergleich1, pers_krad==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_krad1 <- subset(Vergleich1, pers_krad==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(pers_krad0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_krad1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_krad)
```

3. Hypothesentests

```{r}
anova_pers_krad <- aov(gleich_entf_fakt_lg~pers_krad,data=Vergleich1)
summary(anova_pers_krad)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_krad,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_pers_krad), main = NULL)
plot(anova_pers_krad, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
pers_kradBoxplot <- subset(Vergleich1, select=c("gleich_entf_kat", "pers_krad", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,pers_krad)

# Labels erstellen
text_labels1 <- group_by(
  pers_kradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_krad, gleich_entf_fakt_lg),
  pers_krad
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  pers_kradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(pers_kradBoxplot,mapping = aes(
  x = as.numeric(pers_krad),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=pers_krad),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=pers_krad),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Verfügbarkeit Moped/Motorrad (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Verfügbarkeit Moped/Motorrad (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  labs(x = "Verfügbarkeit Moped/Motorrad (Einpersonenhaushalte)",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(pers_kradBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(pers_kradBoxplot$gleich_entf_fakt_lg) # gesamt

pers_kradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_krad, gleich_entf_fakt_lg) %>% group_by(pers_krad) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(pers_kradBoxplot$gleich_entf_fakt) # gesamt

pers_kradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_krad, gleich_entf_fakt_lg) %>% group_by(pers_krad) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Fahrzeugverfügbarkeit PKW

Hat zumindest eine Person aus dem Haushalt einen PKW zur Verfügung?
- 1 ... nie
- 2 ... gelegentlich
- 3 ... jederzeit

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
max_pers_pkw1 <- subset(Vergleich, max_pers_pkw==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
max_pers_pkw2 <- subset(Vergleich, max_pers_pkw==2,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
max_pers_pkw3 <- subset(Vergleich, max_pers_pkw==3,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,3))
hist(max_pers_pkw1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(max_pers_pkw2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(max_pers_pkw3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_pkw)
```

3. Hypothesentests

```{r}
oneway.test(gleich_entf_fakt_lg ~ max_pers_pkw, data=Vergleich)
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich, gleich_entf_fakt_lg ~ max_pers_pkw, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
max_pers_pkwBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "max_pers_pkw", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,max_pers_pkw)

# Labels erstellen
text_labels1 <- group_by(
  max_pers_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_pkw, gleich_entf_fakt_lg),
  max_pers_pkw
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  max_pers_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(max_pers_pkwBoxplot,mapping = aes(
  x = as.numeric(max_pers_pkw),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=max_pers_pkw),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=max_pers_pkw),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:4, name = "Verfügbarkeit PKW", labels = c("","Nie","Gelegentlich","Jederzeit")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:4, name = "Verfügbarkeit PKW", labels = c("","Nie","Gelegentlich","Jederzeit")) +
  labs(x = "Verfügbarkeit PKW",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(max_pers_pkwBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(3,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(max_pers_pkwBoxplot$gleich_entf_fakt_lg) # gesamt

max_pers_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_pkw, gleich_entf_fakt_lg) %>% group_by(max_pers_pkw) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(max_pers_pkwBoxplot$gleich_entf_fakt) # gesamt

max_pers_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_pkw, gleich_entf_fakt_lg) %>% group_by(max_pers_pkw) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Fahrzeugverfügbarkeit PKW (Einpersonenhaushalte)

Hat zumindest eine Person aus dem Haushalt einen PKW zur Verfügung?
- 1 ... nie
- 2 ... gelegentlich
- 3 ... jederzeit

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
pers_pkw1 <- subset(Vergleich1, pers_pkw==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_pkw2 <- subset(Vergleich1, pers_pkw==2,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_pkw3 <- subset(Vergleich1, pers_pkw==3,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,3))
hist(pers_pkw1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_pkw2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_pkw3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_pkw)
```

3. Hypothesentests

```{r}
oneway.test(gleich_entf_fakt_lg ~ pers_pkw, data=Vergleich1)
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich1, gleich_entf_fakt_lg ~ pers_pkw, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
pers_pkwBoxplot <- subset(Vergleich1, select=c("gleich_entf_kat", "pers_pkw", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,pers_pkw)

# Labels erstellen
text_labels1 <- group_by(
  pers_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_pkw, gleich_entf_fakt_lg),
  pers_pkw
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  pers_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(pers_pkwBoxplot,mapping = aes(
  x = as.numeric(pers_pkw),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=pers_pkw),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=pers_pkw),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:3, name = "Verfügbarkeit PKW (Einpersonenhaushalte)", labels = c("Nie","Gelegentlich","Jederzeit")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:3, name = "Verfügbarkeit PKW (Einpersonenhaushalte)", labels = c("Nie","Gelegentlich","Jederzeit")) +
  labs(x = "Verfügbarkeit PKW (Einpersonenhaushalte)",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(pers_pkwBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(3,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(pers_pkwBoxplot$gleich_entf_fakt_lg) # gesamt

pers_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_pkw, gleich_entf_fakt_lg) %>% group_by(pers_pkw) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(pers_pkwBoxplot$gleich_entf_fakt) # gesamt

pers_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_pkw, gleich_entf_fakt_lg) %>% group_by(pers_pkw) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: ÖV-Zeitkartenbesitz (Wochen-/Monats-/Jahreskarte)

Hat zumindest eine Person aus dem Haushalt eine Wochen-, Monats- oder Jahreskarte für den öffentlichen Verkehr? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
max_pers_oev_zeitkarte0 <- subset(Vergleich, max_pers_oev_zeitkarte==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
max_pers_oev_zeitkarte1 <- subset(Vergleich, max_pers_oev_zeitkarte==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(max_pers_oev_zeitkarte0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(max_pers_oev_zeitkarte1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_oev_zeitkarte)
```

3. Hypothesentests

```{r}
t.test(gleich_entf_fakt_lg~max_pers_oev_zeitkarte,data=Vergleich,var.equal=FALSE,alternative="two.sided")
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich, gleich_entf_fakt_lg ~ max_pers_oev_zeitkarte, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
max_pers_oev_zeitkarteBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "max_pers_oev_zeitkarte", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,max_pers_oev_zeitkarte)

# Labels erstellen
text_labels1 <- group_by(
  max_pers_oev_zeitkarteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_oev_zeitkarte, gleich_entf_fakt_lg),
  max_pers_oev_zeitkarte
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  max_pers_oev_zeitkarteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(max_pers_oev_zeitkarteBoxplot,mapping = aes(
  x = as.numeric(max_pers_oev_zeitkarte),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=max_pers_oev_zeitkarte),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=max_pers_oev_zeitkarte),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:3, name = "ÖV-Zeitkarte (Wochen-/Monats-/Jahreskarte)", labels = c("","Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:3, name = "ÖV-Zeitkarte (Wochen-/Monats-/Jahreskarte)", labels = c("","Nein","Ja")) +
  labs(x = "ÖV-Zeitkarte (Wochen-/Monats-/Jahreskarte)",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(max_pers_oev_zeitkarteBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(max_pers_oev_zeitkarteBoxplot$gleich_entf_fakt_lg) # gesamt

max_pers_oev_zeitkarteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_oev_zeitkarte, gleich_entf_fakt_lg) %>% group_by(max_pers_oev_zeitkarte) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(max_pers_oev_zeitkarteBoxplot$gleich_entf_fakt) # gesamt

max_pers_oev_zeitkarteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_oev_zeitkarte, gleich_entf_fakt_lg) %>% group_by(max_pers_oev_zeitkarte) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: ÖV-Zeitkartenbesitz (Wochen-/Monats-/Jahreskarte) (Einpersonenhaushalte)

Hat eine im Einpersonenhaushalt lebende Person eine Wochen-, Monats- oder Jahreskarte für den öffentlichen Verkehr? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
pers_oev_zeitkarte0 <- subset(Vergleich1, pers_oev_zeitkarte==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_oev_zeitkarte1 <- subset(Vergleich1, pers_oev_zeitkarte==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(pers_oev_zeitkarte0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_oev_zeitkarte1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_oev_zeitkarte)
```

3. Hypothesentests

```{r}
t.test(gleich_entf_fakt_lg~pers_oev_zeitkarte,data=Vergleich1,var.equal=FALSE,alternative="two.sided")
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich1, gleich_entf_fakt_lg ~ pers_oev_zeitkarte, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
pers_oev_zeitkarteBoxplot <- subset(Vergleich1, select=c("gleich_entf_kat", "pers_oev_zeitkarte", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,pers_oev_zeitkarte)

# Labels erstellen
text_labels1 <- group_by(
  pers_oev_zeitkarteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_oev_zeitkarte, gleich_entf_fakt_lg),
  pers_oev_zeitkarte
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  pers_oev_zeitkarteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(pers_oev_zeitkarteBoxplot,mapping = aes(
  x = as.numeric(pers_oev_zeitkarte),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=pers_oev_zeitkarte),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=pers_oev_zeitkarte),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "ÖV-Zeitkarte (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "ÖV-Zeitkarte (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  labs(x = "ÖV-Zeitkarte (Einpersonenhaushalte)",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(pers_oev_zeitkarteBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(pers_oev_zeitkarteBoxplot$gleich_entf_fakt_lg) # gesamt

pers_oev_zeitkarteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_oev_zeitkarte, gleich_entf_fakt_lg) %>% group_by(pers_oev_zeitkarte) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(pers_oev_zeitkarteBoxplot$gleich_entf_fakt) # gesamt

pers_oev_zeitkarteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_oev_zeitkarte, gleich_entf_fakt_lg) %>% group_by(pers_oev_zeitkarte) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## ÖV-Nutzungsfaktor nach ÖV-Zeitkartenbesitz

Auf Haushaltsebene: Besitzen alle Personen des Haushalts eine ÖV-Zeitkarte oder nur manche oder niemand?
- 0 ... niemand besitzt eine ÖV-Zeitkarte (ÖV-averser Haushalt)
- 1 ... mindestens eine Person im Haushalt, aber nicht jede besitzt eine ÖV-Zeitkarte (ÖV-gemischter Haushalt)
- 2 ... alle Personen im Haushalt besitzen eine ÖV-Zeitkarte (ÖV-affiner Haushalt)

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
nutz_oev_zeitkarte0 <- subset(Vergleich, nutz_oev_zeitkarte==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
nutz_oev_zeitkarte1 <- subset(Vergleich, nutz_oev_zeitkarte==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
nutz_oev_zeitkarte2 <- subset(Vergleich, nutz_oev_zeitkarte==2,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,3))
hist(nutz_oev_zeitkarte0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(nutz_oev_zeitkarte1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(nutz_oev_zeitkarte2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$nutz_oev_zeitkarte)
```

3. Hypothesentests

```{r}
oneway.test(gleich_entf_fakt_lg ~ nutz_oev_zeitkarte, data=Vergleich)
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich, gleich_entf_fakt_lg ~ nutz_oev_zeitkarte, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
nutz_oev_zeitkarteBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "nutz_oev_zeitkarte", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,nutz_oev_zeitkarte)

# Labels erstellen
text_labels1 <- group_by(
  nutz_oev_zeitkarteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, nutz_oev_zeitkarte, gleich_entf_fakt_lg),
  nutz_oev_zeitkarte
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  nutz_oev_zeitkarteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(nutz_oev_zeitkarteBoxplot,mapping = aes(
  x = as.numeric(nutz_oev_zeitkarte),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=nutz_oev_zeitkarte),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=nutz_oev_zeitkarte),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 0:2, name = "ÖV-Affinität des Haushalts (nach Zeitkartenbesitz)", labels = c("avers","gemischt","affin")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 0:2, name = "ÖV-Affinität des Haushalts (nach Zeitkartenbesitz)", labels = c("avers","gemischt","affin")) +
  labs(x = "ÖV-Affinität des Haushalts (nach Zeitkartenbesitz)",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(nutz_oev_zeitkarteBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(3,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

## Unabhängige Variable: ÖV-Ermäßigungskarte (Vorteilscard)

Hat zumindest eine Person aus dem Haushalt eine Ermäßigung für den öffentlichen Verkehr? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
max_pers_oev_ermaessigung0 <- subset(Vergleich, max_pers_oev_ermaessigung==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
max_pers_oev_ermaessigung1 <- subset(Vergleich, max_pers_oev_ermaessigung==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(max_pers_oev_ermaessigung0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(max_pers_oev_ermaessigung1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_oev_ermaessigung)
```

3. Hypothesentests

```{r}
t.test(gleich_entf_fakt_lg~max_pers_oev_ermaessigung,data=Vergleich,var.equal=FALSE,alternative="two.sided")
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich, gleich_entf_fakt_lg ~ max_pers_oev_ermaessigung, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
max_pers_oev_ermaessigungBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "max_pers_oev_ermaessigung", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,max_pers_oev_ermaessigung)

# Labels erstellen
text_labels1 <- group_by(
  max_pers_oev_ermaessigungBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_oev_ermaessigung, gleich_entf_fakt_lg),
  max_pers_oev_ermaessigung
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  max_pers_oev_ermaessigungBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(max_pers_oev_ermaessigungBoxplot,mapping = aes(
  x = as.numeric(max_pers_oev_ermaessigung),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=max_pers_oev_ermaessigung),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=max_pers_oev_ermaessigung),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:3, name = "ÖV-Ermäßigungskarte (Vorteilscard)", labels = c("","Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:3, name = "ÖV-Ermäßigungskarte (Vorteilscard)", labels = c("","Nein","Ja")) +
  labs(x = "ÖV-Ermäßigungskarte (Vorteilscard)",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(max_pers_oev_ermaessigungBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(max_pers_oev_ermaessigungBoxplot$gleich_entf_fakt_lg) # gesamt

max_pers_oev_ermaessigungBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_oev_ermaessigung, gleich_entf_fakt_lg) %>% group_by(max_pers_oev_ermaessigung) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(max_pers_oev_ermaessigungBoxplot$gleich_entf_fakt) # gesamt

max_pers_oev_ermaessigungBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_oev_ermaessigung, gleich_entf_fakt_lg) %>% group_by(max_pers_oev_ermaessigung) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: ÖV-Ermäßigungskarte (Vorteilscard) (Einpersonenhaushalte)

Hat zumindest eine Person aus dem Haushalt eine Ermäßigung für den öffentlichen Verkehr? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
pers_oev_ermaessigung0 <- subset(Vergleich1, pers_oev_ermaessigung==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_oev_ermaessigung1 <- subset(Vergleich1, pers_oev_ermaessigung==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(pers_oev_ermaessigung0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_oev_ermaessigung1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_oev_ermaessigung)
```

3. Hypothesentests

```{r}
anova_pers_oev_ermaessigung <- aov(gleich_entf_fakt_lg~pers_oev_ermaessigung,data=Vergleich1)
summary(anova_pers_oev_ermaessigung)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_oev_ermaessigung,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_pers_oev_ermaessigung), main = NULL)
plot(anova_pers_oev_ermaessigung, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
pers_oev_ermaessigungBoxplot <- subset(Vergleich1, select=c("gleich_entf_kat", "pers_oev_ermaessigung", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,pers_oev_ermaessigung)

# Labels erstellen
text_labels1 <- group_by(
  pers_oev_ermaessigungBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_oev_ermaessigung, gleich_entf_fakt_lg),
  pers_oev_ermaessigung
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  pers_oev_ermaessigungBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(pers_oev_ermaessigungBoxplot,mapping = aes(
  x = as.numeric(pers_oev_ermaessigung),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=pers_oev_ermaessigung),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=pers_oev_ermaessigung),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "ÖV-Ermäßigungskarte (Vorteilscard) (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "ÖV-Ermäßigungskarte (Vorteilscard) (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  labs(x = "ÖV-Ermäßigungskarte (Vorteilscard) (Einpersonenhaushalte)",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(pers_oev_ermaessigungBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(pers_oev_ermaessigungBoxplot$gleich_entf_fakt_lg) # gesamt

pers_oev_ermaessigungBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_oev_ermaessigung, gleich_entf_fakt_lg) %>% group_by(pers_oev_ermaessigung) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(pers_oev_ermaessigungBoxplot$gleich_entf_fakt) # gesamt

pers_oev_ermaessigungBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_oev_ermaessigung, gleich_entf_fakt_lg) %>% group_by(pers_oev_ermaessigung) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Elektronische Navigation Pkw

Verwendet zumindest eine Person aus dem Haushalt beim Autofahren ein Navigationssystem? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
max_pers_navi_pkw0 <- subset(Vergleich, max_pers_navi_pkw==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
max_pers_navi_pkw1 <- subset(Vergleich, max_pers_navi_pkw==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(max_pers_navi_pkw0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(max_pers_navi_pkw1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_navi_pkw)
```

3. Hypothesentests

```{r}
anova_max_pers_navi_pkw <- aov(gleich_entf_fakt_lg~max_pers_navi_pkw,data=Vergleich)
summary(anova_max_pers_navi_pkw)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_navi_pkw,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_max_pers_navi_pkw), main = NULL)
plot(anova_max_pers_navi_pkw, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
max_pers_navi_pkwBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "max_pers_navi_pkw", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,max_pers_navi_pkw)

# Labels erstellen
text_labels1 <- group_by(
  max_pers_navi_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_navi_pkw, gleich_entf_fakt_lg),
  max_pers_navi_pkw
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  max_pers_navi_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(max_pers_navi_pkwBoxplot,mapping = aes(
  x = as.numeric(max_pers_navi_pkw),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=max_pers_navi_pkw),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=max_pers_navi_pkw),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:3, name = "Elektronische Navigation Pkw", labels = c("","Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:3, name = "Elektronische Navigation Pkw", labels = c("","Nein","Ja")) +
  labs(x = "Elektronische Navigation Pkw",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(max_pers_navi_pkwBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(max_pers_navi_pkwBoxplot$gleich_entf_fakt_lg) # gesamt

max_pers_navi_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_navi_pkw, gleich_entf_fakt_lg) %>% group_by(max_pers_navi_pkw) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(max_pers_navi_pkwBoxplot$gleich_entf_fakt) # gesamt

max_pers_navi_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_navi_pkw, gleich_entf_fakt_lg) %>% group_by(max_pers_navi_pkw) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```


## Unabhängige Variable: Elektronische Navigation PKW (Einpersonenhaushalte)

Verwendet zumindest eine Person aus dem Haushalt beim Autofahren ein Navigationssystem? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
pers_navi_pkw0 <- subset(Vergleich1, pers_navi_pkw==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_navi_pkw1 <- subset(Vergleich1, pers_navi_pkw==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(pers_navi_pkw0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_navi_pkw1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_navi_pkw)
```

3. Hypothesentests

```{r}
anova_pers_navi_pkw <- aov(gleich_entf_fakt_lg~pers_navi_pkw,data=Vergleich1)
summary(anova_pers_navi_pkw)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_navi_pkw,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_pers_navi_pkw), main = NULL)
plot(anova_pers_navi_pkw, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
pers_navi_pkwBoxplot <- subset(Vergleich1, select=c("gleich_entf_kat", "pers_navi_pkw", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,pers_navi_pkw)

# Labels erstellen
text_labels1 <- group_by(
  pers_navi_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_navi_pkw, gleich_entf_fakt_lg),
  pers_navi_pkw
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  pers_navi_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(pers_navi_pkwBoxplot,mapping = aes(
  x = as.numeric(pers_navi_pkw),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=pers_navi_pkw),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=pers_navi_pkw),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Elektronische Navigation PKW (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Elektronische Navigation PKW (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  labs(x = "Elektronische Navigation PKW (Einpersonenhaushalte)",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(pers_navi_pkwBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(pers_navi_pkwBoxplot$gleich_entf_fakt_lg) # gesamt

pers_navi_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_navi_pkw, gleich_entf_fakt_lg) %>% group_by(pers_navi_pkw) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(pers_navi_pkwBoxplot$gleich_entf_fakt) # gesamt

pers_navi_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_navi_pkw, gleich_entf_fakt_lg) %>% group_by(pers_navi_pkw) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Elektronische Navigation ÖV

Verwendet zumindest eine Person aus dem Haushalt für die Benutzung des öffentlichen Verkehrs ein Navigationssystem? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
max_pers_navi_oev0 <- subset(Vergleich, max_pers_navi_oev==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
max_pers_navi_oev1 <- subset(Vergleich, max_pers_navi_oev==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(max_pers_navi_oev0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(max_pers_navi_oev1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_navi_oev)
```

3. Hypothesentests

```{r}
t.test(gleich_entf_fakt_lg~max_pers_navi_oev,data=Vergleich,var.equal=FALSE,alternative="two.sided")
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich, gleich_entf_fakt_lg ~ max_pers_navi_oev, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
max_pers_navi_oevBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "max_pers_navi_oev", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,max_pers_navi_oev)

# Labels erstellen
text_labels1 <- group_by(
  max_pers_navi_oevBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_navi_oev, gleich_entf_fakt_lg),
  max_pers_navi_oev
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  max_pers_navi_oevBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(max_pers_navi_oevBoxplot,mapping = aes(
  x = as.numeric(max_pers_navi_oev),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=max_pers_navi_oev),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=max_pers_navi_oev),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:3, name = "Elektronische Navigation ÖV", labels = c("","Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:3, name = "Elektronische Navigation ÖV", labels = c("","Nein","Ja")) +
  labs(x = "Elektronische Navigation ÖV",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(max_pers_navi_oevBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(max_pers_navi_oevBoxplot$gleich_entf_fakt_lg) # gesamt

max_pers_navi_oevBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_navi_oev, gleich_entf_fakt_lg) %>% group_by(max_pers_navi_oev) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(max_pers_navi_oevBoxplot$gleich_entf_fakt) # gesamt

max_pers_navi_oevBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_navi_oev, gleich_entf_fakt_lg) %>% group_by(max_pers_navi_oev) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Elektronische Navigation ÖV (Einpersonenhaushalte)

Verwendet zumindest eine Person aus dem Haushalt für die Benutzung des öffentlichen Verkehrs ein Navigationssystem? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
pers_navi_oev0 <- subset(Vergleich1, pers_navi_oev==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_navi_oev1 <- subset(Vergleich1, pers_navi_oev==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(pers_navi_oev0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_navi_oev1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_navi_oev)
```

3. Hypothesentests

```{r}
anova_pers_navi_oev <- aov(gleich_entf_fakt_lg~pers_navi_oev,data=Vergleich1)
summary(anova_pers_navi_oev)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_navi_oev,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_pers_navi_oev), main = NULL)
plot(anova_pers_navi_oev, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
pers_navi_oevBoxplot <- subset(Vergleich1, select=c("gleich_entf_kat", "pers_navi_oev", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,pers_navi_oev)

# Labels erstellen
text_labels1 <- group_by(
  pers_navi_oevBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_navi_oev, gleich_entf_fakt_lg),
  pers_navi_oev
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  pers_navi_oevBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(pers_navi_oevBoxplot,mapping = aes(
  x = as.numeric(pers_navi_oev),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=pers_navi_oev),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=pers_navi_oev),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Elektronische Navigation ÖV (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Elektronische Navigation ÖV (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  labs(x = "Elektronische Navigation ÖV (Einpersonenhaushalte)",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(pers_navi_oevBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(pers_navi_oevBoxplot$gleich_entf_fakt_lg) # gesamt

pers_navi_oevBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_navi_oev, gleich_entf_fakt_lg) %>% group_by(pers_navi_oev) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(pers_navi_oevBoxplot$gleich_entf_fakt) # gesamt

pers_navi_oevBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_navi_oev, gleich_entf_fakt_lg) %>% group_by(pers_navi_oev) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Elektronische Navigation andere Gelegenheiten

Wird von zumindest einer Person aus dem Haushalt ein Navigationssystem zu einem anderen Zweck verwendet? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
max_pers_navi_andere0 <- subset(Vergleich, max_pers_navi_andere==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
max_pers_navi_andere1 <- subset(Vergleich, max_pers_navi_andere==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(max_pers_navi_andere0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(max_pers_navi_andere1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_navi_andere)
```

3. Hypothesentests

```{r}
anova_max_pers_navi_andere <- aov(gleich_entf_fakt_lg~max_pers_navi_andere,data=Vergleich)
summary(anova_max_pers_navi_andere)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_navi_andere,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_max_pers_navi_andere), main = NULL)
plot(anova_max_pers_navi_andere, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
max_pers_navi_andereBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "max_pers_navi_andere", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,max_pers_navi_andere)

# Labels erstellen
text_labels1 <- group_by(
  max_pers_navi_andereBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_navi_andere, gleich_entf_fakt_lg),
  max_pers_navi_andere
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  max_pers_navi_andereBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(max_pers_navi_andereBoxplot,mapping = aes(
  x = as.numeric(max_pers_navi_andere),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=max_pers_navi_andere),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=max_pers_navi_andere),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:3, name = "Elektronische Navigation andere Gelegenheiten", labels = c("","Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:3, name = "Elektronische Navigation andere Gelegenheiten", labels = c("","Nein","Ja")) +
  labs(x = "Elektronische Navigation andere Gelegenheiten",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(max_pers_navi_andereBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(max_pers_navi_andereBoxplot$gleich_entf_fakt_lg) # gesamt

max_pers_navi_andereBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_navi_andere, gleich_entf_fakt_lg) %>% group_by(max_pers_navi_andere) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(max_pers_navi_andereBoxplot$gleich_entf_fakt) # gesamt

max_pers_navi_andereBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_navi_andere, gleich_entf_fakt_lg) %>% group_by(max_pers_navi_andere) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Elektronische Navigation andere Gelegenheiten (Einpersonenhaushalte)

Wird von zumindest einer Person aus dem Haushalt ein Navigationssystem zu einem anderen Zweck verwendet? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
pers_navi_andere0 <- subset(Vergleich1, pers_navi_andere==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_navi_andere1 <- subset(Vergleich1, pers_navi_andere==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(pers_navi_andere0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_navi_andere1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_navi_andere)
```

3. Hypothesentests

```{r}
anova_pers_navi_andere <- aov(gleich_entf_fakt_lg~pers_navi_andere,data=Vergleich1)
summary(anova_pers_navi_andere)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_navi_andere,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_pers_navi_andere), main = NULL)
plot(anova_pers_navi_andere, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
pers_navi_andereBoxplot <- subset(Vergleich1, select=c("gleich_entf_kat", "pers_navi_andere", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,pers_navi_andere)

# Labels erstellen
text_labels1 <- group_by(
  pers_navi_andereBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_navi_andere, gleich_entf_fakt_lg),
  pers_navi_andere
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  pers_navi_andereBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(pers_navi_andereBoxplot,mapping = aes(
  x = as.numeric(pers_navi_andere),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=pers_navi_andere),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=pers_navi_andere),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Andere elektronische Navigation (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Andere elektronische Navigation (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  labs(x = "Elektronische Navigation andere Gelegenheiten (Einpersonenhaushalte)",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(pers_navi_andereBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(pers_navi_andereBoxplot$gleich_entf_fakt_lg) # gesamt

pers_navi_andereBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_navi_andere, gleich_entf_fakt_lg) %>% group_by(pers_navi_andere) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(pers_navi_andereBoxplot$gleich_entf_fakt) # gesamt

pers_navi_andereBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_navi_andere, gleich_entf_fakt_lg) %>% group_by(pers_navi_andere) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Betreuung von Kindern

Betreut zumindest eine Person im Haushalt ein Kind? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
max_pers_betr_kind0 <- subset(Vergleich, max_pers_betr_kind==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
max_pers_betr_kind1 <- subset(Vergleich, max_pers_betr_kind==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(max_pers_betr_kind0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(max_pers_betr_kind1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_betr_kind)
```

3. Hypothesentests

```{r}
anova_max_pers_betr_kind <- aov(gleich_entf_fakt_lg~max_pers_betr_kind,data=Vergleich)
summary(anova_max_pers_betr_kind)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_betr_kind,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_max_pers_betr_kind), main = NULL)
plot(anova_max_pers_betr_kind, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
max_pers_betr_kindBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "max_pers_betr_kind", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,max_pers_betr_kind)

# Labels erstellen
text_labels1 <- group_by(
  max_pers_betr_kindBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_betr_kind, gleich_entf_fakt_lg),
  max_pers_betr_kind
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  max_pers_betr_kindBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(max_pers_betr_kindBoxplot,mapping = aes(
  x = as.numeric(max_pers_betr_kind),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=max_pers_betr_kind),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=max_pers_betr_kind),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:3, name = "Betreuung von Kindern", labels = c("","Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:3, name = "Betreuung von Kindern", labels = c("","Nein","Ja")) +
  labs(x = "Betreuung von Kindern",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(max_pers_betr_kindBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(max_pers_betr_kindBoxplot$gleich_entf_fakt_lg) # gesamt

max_pers_betr_kindBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_betr_kind, gleich_entf_fakt_lg) %>% group_by(max_pers_betr_kind) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(max_pers_betr_kindBoxplot$gleich_entf_fakt) # gesamt

max_pers_betr_kindBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_betr_kind, gleich_entf_fakt_lg) %>% group_by(max_pers_betr_kind) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Betreuung von Kindern (Einpersonenhaushalte)

Betreut zumindest eine Person im Haushalt ein Kind? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
pers_betr_kind0 <- subset(Vergleich1, pers_betr_kind==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_betr_kind1 <- subset(Vergleich1, pers_betr_kind==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(pers_betr_kind0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_betr_kind1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_betr_kind)
```

3. Hypothesentests

```{r}
anova_pers_betr_kind <- aov(gleich_entf_fakt_lg~pers_betr_kind,data=Vergleich1)
summary(anova_pers_betr_kind)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_betr_kind,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_pers_betr_kind), main = NULL)
plot(anova_pers_betr_kind, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
pers_betr_kindBoxplot <- subset(Vergleich1, select=c("gleich_entf_kat", "pers_betr_kind", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,pers_betr_kind)

# Labels erstellen
text_labels1 <- group_by(
  pers_betr_kindBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_betr_kind, gleich_entf_fakt_lg),
  pers_betr_kind
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  pers_betr_kindBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(pers_betr_kindBoxplot,mapping = aes(
  x = as.numeric(pers_betr_kind),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=pers_betr_kind),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=pers_betr_kind),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Betreuung von Kindern (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Betreuung von Kindern (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  labs(x = "Betreuung von Kindern (Einpersonenhaushalte)",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(pers_betr_kindBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(pers_betr_kindBoxplot$gleich_entf_fakt_lg) # gesamt

pers_betr_kindBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_betr_kind, gleich_entf_fakt_lg) %>% group_by(pers_betr_kind) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(pers_betr_kindBoxplot$gleich_entf_fakt) # gesamt

pers_betr_kindBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_betr_kind, gleich_entf_fakt_lg) %>% group_by(pers_betr_kind) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Betreuung von Verwandten

Betreut zumindest eine Person im Haushalt eine/n Verwandte/n? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
max_pers_betr_verwandte0 <- subset(Vergleich, max_pers_betr_verwandte==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
max_pers_betr_verwandte1 <- subset(Vergleich, max_pers_betr_verwandte==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(max_pers_betr_verwandte0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(max_pers_betr_verwandte1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_betr_verwandte)
```

3. Hypothesentests

```{r}
anova_max_pers_betr_verwandte <- aov(gleich_entf_fakt_lg~max_pers_betr_verwandte,data=Vergleich)
summary(anova_max_pers_betr_verwandte)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_betr_verwandte,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_max_pers_betr_verwandte), main = NULL)
plot(anova_max_pers_betr_verwandte, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
max_pers_betr_verwandteBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "max_pers_betr_verwandte", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,max_pers_betr_verwandte)

# Labels erstellen
text_labels1 <- group_by(
  max_pers_betr_verwandteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_betr_verwandte, gleich_entf_fakt_lg),
  max_pers_betr_verwandte
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  max_pers_betr_verwandteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(max_pers_betr_verwandteBoxplot,mapping = aes(
  x = as.numeric(max_pers_betr_verwandte),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=max_pers_betr_verwandte),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=max_pers_betr_verwandte),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:3, name = "Betreuung von Verwandten", labels = c("","Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:3, name = "Betreuung von Verwandten", labels = c("","Nein","Ja")) +
  labs(x = "Betreuung von Verwandten",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(max_pers_betr_verwandteBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(max_pers_betr_verwandteBoxplot$gleich_entf_fakt_lg) # gesamt

max_pers_betr_verwandteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_betr_verwandte, gleich_entf_fakt_lg) %>% group_by(max_pers_betr_verwandte) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(max_pers_betr_verwandteBoxplot$gleich_entf_fakt) # gesamt

max_pers_betr_verwandteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_betr_verwandte, gleich_entf_fakt_lg) %>% group_by(max_pers_betr_verwandte) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Betreuung von Verwandten (Einpersonenhaushalte)

Betreut zumindest eine Person im Haushalt eine/n Verwandte/n? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
pers_betr_verwandte0 <- subset(Vergleich1, pers_betr_verwandte==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_betr_verwandte1 <- subset(Vergleich1, pers_betr_verwandte==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(pers_betr_verwandte0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_betr_verwandte1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_betr_verwandte)
```

3. Hypothesentests

```{r}
anova_pers_betr_verwandte <- aov(gleich_entf_fakt_lg~pers_betr_verwandte,data=Vergleich1)
summary(anova_pers_betr_verwandte)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_betr_verwandte,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_pers_betr_verwandte), main = NULL)
plot(anova_pers_betr_verwandte, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
pers_betr_verwandteBoxplot <- subset(Vergleich1, select=c("gleich_entf_kat", "pers_betr_verwandte", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,pers_betr_verwandte)

# Labels erstellen
text_labels1 <- group_by(
  pers_betr_verwandteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_betr_verwandte, gleich_entf_fakt_lg),
  pers_betr_verwandte
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  pers_betr_verwandteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(pers_betr_verwandteBoxplot,mapping = aes(
  x = as.numeric(pers_betr_verwandte),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=pers_betr_verwandte),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=pers_betr_verwandte),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Betreuung von Verwandten (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Betreuung von Verwandten (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  labs(x = "Betreuung von Verwandten (Einpersonenhaushalte)",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(pers_betr_verwandteBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(pers_betr_verwandteBoxplot$gleich_entf_fakt_lg) # gesamt

pers_betr_verwandteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_betr_verwandte, gleich_entf_fakt_lg) %>% group_by(pers_betr_verwandte) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(pers_betr_verwandteBoxplot$gleich_entf_fakt) # gesamt

pers_betr_verwandteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_betr_verwandte, gleich_entf_fakt_lg) %>% group_by(pers_betr_verwandte) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Betreuung von anderen Personen

Betreut zumindest eine Person im Haushalt eine andere Person? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
max_pers_betr_andere0 <- subset(Vergleich, max_pers_betr_andere==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
max_pers_betr_andere1 <- subset(Vergleich, max_pers_betr_andere==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(max_pers_betr_andere0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(max_pers_betr_andere1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_betr_andere)
```

3. Hypothesentests

```{r}
anova_max_pers_betr_andere <- aov(gleich_entf_fakt_lg~max_pers_betr_andere,data=Vergleich)
summary(anova_max_pers_betr_andere)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich$gleich_entf_fakt_lg, Vergleich$max_pers_betr_andere,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_max_pers_betr_andere), main = NULL)
plot(anova_max_pers_betr_andere, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
max_pers_betr_andereBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "max_pers_betr_andere", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,max_pers_betr_andere)

# Labels erstellen
text_labels1 <- group_by(
  max_pers_betr_andereBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_betr_andere, gleich_entf_fakt_lg),
  max_pers_betr_andere
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  max_pers_betr_andereBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(max_pers_betr_andereBoxplot,mapping = aes(
  x = as.numeric(max_pers_betr_andere),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=max_pers_betr_andere),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=max_pers_betr_andere),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:3, name = "Betreuung von anderen Personen", labels = c("","Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:3, name = "Betreuung von anderen Personen", labels = c("","Nein","Ja")) +
  labs(x = "Betreuung von anderen Personen",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(max_pers_betr_andereBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(max_pers_betr_andereBoxplot$gleich_entf_fakt_lg) # gesamt

max_pers_betr_andereBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_betr_andere, gleich_entf_fakt_lg) %>% group_by(max_pers_betr_andere) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(max_pers_betr_andereBoxplot$gleich_entf_fakt) # gesamt

max_pers_betr_andereBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, max_pers_betr_andere, gleich_entf_fakt_lg) %>% group_by(max_pers_betr_andere) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Betreuung von anderen Personen (Einpersonenhaushalte)

Betreut zumindest eine Person im Haushalt eine andere Person? Nein/Ja

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
pers_betr_andere0 <- subset(Vergleich1, pers_betr_andere==0,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
pers_betr_andere1 <- subset(Vergleich1, pers_betr_andere==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(pers_betr_andere0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(pers_betr_andere1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_betr_andere)
```

3. Hypothesentests

```{r}
anova_pers_betr_andere <- aov(gleich_entf_fakt_lg~pers_betr_andere,data=Vergleich1)
summary(anova_pers_betr_andere)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Vergleich1$gleich_entf_fakt_lg, Vergleich1$pers_betr_andere,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_pers_betr_andere), main = NULL)
plot(anova_pers_betr_andere, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
pers_betr_andereBoxplot <- subset(Vergleich1, select=c("gleich_entf_kat", "pers_betr_andere", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,pers_betr_andere)

# Labels erstellen
text_labels1 <- group_by(
  pers_betr_andereBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_betr_andere, gleich_entf_fakt_lg),
  pers_betr_andere
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  pers_betr_andereBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(pers_betr_andereBoxplot,mapping = aes(
  x = as.numeric(pers_betr_andere),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=pers_betr_andere),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=pers_betr_andere),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Betreuung von anderen Personen (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Betreuung von anderen Personen (Einpersonenhaushalte)", labels = c("Nein","Ja")) +
  labs(x = "Betreuung von anderen Personen (Einpersonenhaushalte)",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(pers_betr_andereBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
    scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(pers_betr_andereBoxplot$gleich_entf_fakt_lg) # gesamt

pers_betr_andereBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_betr_andere, gleich_entf_fakt_lg) %>% group_by(pers_betr_andere) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(pers_betr_andereBoxplot$gleich_entf_fakt) # gesamt

pers_betr_andereBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, pers_betr_andere, gleich_entf_fakt_lg) %>% group_by(pers_betr_andere) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

# Einlesen des Wegedatensatzes von ÖU 2013/2014

```{r}
OeU_Wege <- read.csv('OeU2013_2014_Wegedatensatz.csv', header = TRUE, sep = ";")
names(OeU_Wege)
```

## Datenaufbereitung

Zwecks Vereinfachung fürs Rechnen werden alle negativen Werte (nicht anwendbar oder keine Angabe) zu NA umgerechnet, da R fehlende Werte in vielen Fällen automatisch bei Rechnungen ignoriert. 
```{r, results='hide'}
OeU_Wege <- OeU_Wege %>% dplyr::na_if(-90)
OeU_Wege <- OeU_Wege %>% dplyr::na_if(-93)
```

Es wird eine neue Spalte eingefügt, die Auskunft darüber gibt, ob der ÖV das Hauptverkehrsmittel am Weg war oder nicht. (Ja = 1, Nein = 0)

```{r, results='hide'}
OeU_Wege <- mutate(OeU_Wege, hh_oev_haupt = ifelse(OeU_Wege$weg_vm_haupt_kl == 5, 1, 0))
```

Es wird nun umgerechnet, ob alle, manche oder gar keine Wege innerhalb eines Haushaltes mit dem ÖV zurückgelegt wurden. Dies wird über die Berechnung des Durchschnitts der zuvor neu eingeführten Variable ermittelt. 

0 = gar keine
0 < x < 1 = manche
1 = alle

```{r, results='hide',warning=FALSE}
OeU_Wege_HH <- OeU_Wege %>% 
  group_by(hh_nr) %>% 
  summarise(mean_hh_oev_haupt=mean(hh_oev_haupt,na.rm = TRUE))
```
Dies wird nun dem großen Datensatz angefügt. Zuerst werden aber folgende neue Kategorien gebildet: 
1 ... gar keine (vormals 0)
2 ... gemischt (0 < x < 1)
3 ... alle (vormals 1)

```{r}
OeU_Wege_HH <- OeU_Wege_HH %>% mutate(mean_hh_oev_haupt_kat = case_when(mean_hh_oev_haupt > 0 & mean_hh_oev_haupt < 1 ~ 2, # gemischt (0 < x < 1) zu 2
                                                                         mean_hh_oev_haupt == 1 ~ 3, #alle (1) zu 3
                                                                         mean_hh_oev_haupt == 0 ~ 1)) # gar keine (0) zu 1
OeU_Wege_HH$mean_hh_oev_haupt_kat <- as.factor(OeU_Wege_HH$mean_hh_oev_haupt_kat)
OeU_Wege_HH$hh_nr <- as.factor(OeU_Wege_HH$hh_nr)
Vergleich <- full_join(Vergleich,OeU_Wege_HH,by = "hh_nr")
names(Vergleich)
```

## Unabhängige Variable: ÖV-Nutzung laut Wegetagebuch

Es gibt drei Kategorien, die aus den Einträgen im Wegetagebuch ergaben: 
1 ... es wurden gar keine Wege während des Beobachtungszeitraum mit dem ÖV zurückgelegt
2 ... es wurden manche Wege mit dem ÖV zurückgelegt, aber nicht alle
3 ... alle Personen im Haushalt haben alle ihre Wege mit dem ÖV zurückgelegt. 

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
mean_hh_oev_haupt_kat1 <- subset(Vergleich, mean_hh_oev_haupt_kat==1,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
mean_hh_oev_haupt_kat2 <- subset(Vergleich, mean_hh_oev_haupt_kat==2,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
mean_hh_oev_haupt_kat3 <- subset(Vergleich, mean_hh_oev_haupt_kat==3,select = c(hh_nr,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,3))
hist(mean_hh_oev_haupt_kat1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(mean_hh_oev_haupt_kat2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
hist(mean_hh_oev_haupt_kat3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)), main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Vergleich$gleich_entf_fakt_lg, Vergleich$mean_hh_oev_haupt_kat)
```

3. Hypothesentests

```{r}
oneway.test(gleich_entf_fakt_lg ~ mean_hh_oev_haupt_kat, data=Vergleich)
```

4. Post-hoc-Tests

```{r}
games_howell_test(Vergleich, gleich_entf_fakt_lg ~ mean_hh_oev_haupt_kat, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
mean_hh_oev_haupt_katBoxplot <- subset(Vergleich, select=c("gleich_entf_kat", "mean_hh_oev_haupt_kat", "gleich_entf_fakt","gleich_entf_fakt_lg","hst_gehdauer","hh_oev_entf")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,mean_hh_oev_haupt_kat)

# Labels erstellen
text_labels1 <- group_by(
  mean_hh_oev_haupt_katBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, mean_hh_oev_haupt_kat, gleich_entf_fakt_lg),
  mean_hh_oev_haupt_kat
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  mean_hh_oev_haupt_katBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(mean_hh_oev_haupt_katBoxplot,mapping = aes(
  x = as.numeric(mean_hh_oev_haupt_kat),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=mean_hh_oev_haupt_kat),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=mean_hh_oev_haupt_kat),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:3, name = "ÖV-Nutzung laut Wegetagebuch", labels = c("Gar kein ÖV","Teilweise ÖV","Nur ÖV")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:3, name = "ÖV-Nutzung laut Wegetagebuch", labels = c("Gar kein ÖV","Teilweise ÖV","Nur ÖV")) +
  labs(x = "ÖV-Nutzung laut Wegetagebuch",
      y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(mean_hh_oev_haupt_katBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Übereinstimmungsgrad ÖU/VAO",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(3,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

## Alterspyramide ÖU 2013/2014

Zunächst werden die entsprechenden Alterskategorien gebildet.

```{r, results='hide'}
OeU_Pers <- mutate(OeU_Pers, pers_alter_kat_5Jahre = cut(pers_alter, breaks = c(0,4,9,14,19,24,29,34,39,44,49,54,59,64,69,74,79,84,150), labels = c("0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85+")), ordered = TRUE)
```

Nun wird die Alterspyramide erstellt.

```{r}
ggplot(data = OeU_Pers, mapping = aes(x = as.factor(pers_alter_kat_5Jahre), fill = pers_geschlecht))+
  geom_bar(data = subset(OeU_Pers, pers_geschlecht == 1), fill = "#a23232", labels = "Weiblich")+
  geom_bar(data = subset(OeU_Pers, pers_geschlecht == 2), aes(y=..count..*(-1)), fill = "#588ebb", labels = "Männlich")+
  coord_flip()+
  scale_color_manual(breaks = c("Weiblich", "Männlich"))+
  scale_y_continuous(labels = abs, breaks = seq(-10000,10000,1000), name = "Altersverteilung ÖU 2013/2014 [Personen]")+
  labs(x = "Alter", y = "Anzahl")+
  theme_bw()
```

