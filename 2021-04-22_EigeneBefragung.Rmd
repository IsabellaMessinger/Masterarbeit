---
title: 'Auswertung der eigenen Befragung für die Masterarbeit'
author: "Isabella Messinger"
date: "22.04.2021"
output: html_document
---

# Benötigte Packages öffnen

```{r setup, results='hide', include=FALSE}
library(tidyverse)
library(ggrepel)
library(ggpubr)
library(reshape2)
library(patchwork)
library(gtools)
library(car)
library(psych)
library(pastecs)
library(rstatix)
library(gridExtra)
library(data.table)
library(kableExtra)
knitr::opts_chunk$set(include = TRUE, echo = FALSE, warning = FALSE) # Generelle Einstellungen für alle Chunks: include = TRUE (Output anzeigenlassen), echo = TRUE (Codes anzeigen lassen)
options(knitr.kable.NA = '') # damit in der Tabelle NAs als leere Felder angezeigt werden
```

# Einlesen des Datensatzes der eigenen Befragung

Es wird zunächst die Working Directory festgelegt und anschließend das CSV-File eingelesen.

```{r, results='hide'}
Befragung <- read.csv('2021-03-18_Auswertung-Befragung_neu.csv', header = TRUE, sep = ";")
str(Befragung)
```

## Histogramm Zugangszeiten angegeben vs. ermittelt

NAs in den Variablen "nxste_zeit" und "test_nxste_zeit" werden für die Kategoriebildung kurzfristig auf "-90" gesetzt und anschließend folgende Klassen ("nxste_zeit_kat" und "test_nxste_zeit_kat") gebildet. 


Klassen: 1...-90, 2...0 min, 3... 1-5 min, 4... 6-15 min, 5... 16-30 min, 6... 31-60 min, 7... 61-120 min, 8... 120-180 min, 9...>180 min)

```{r, results='hide'}
x=length(which(is.na(Befragung$nxste_zeit)))
x
x=length(which(is.na(Befragung$test_nxste_zeit)))
x

Befragung <- Befragung %>% mutate(nxste_zeit = replace(nxste_zeit, is.na(nxste_zeit), -90))
Befragung <- Befragung %>% mutate(test_nxste_zeit = replace(test_nxste_zeit, is.na(test_nxste_zeit), -90))

Befragung <- mutate(Befragung, nxste_zeit_kat = cut(nxste_zeit, c(-91,-1,0,5,15,30,60,120,180,480),labels = c("1","2","3","4","5","6","7","8","9")))
Befragung <- mutate(Befragung, test_nxste_zeit_kat = cut(test_nxste_zeit, c(-91,-1,0,5,15,30,60,120,180,480),labels = c("1","2","3","4","5","6","7","8","9")))
factor(Befragung$hst_zeit_kat)
factor(Befragung$test_zeit_kat)
```

Es wird eine Häufigkeitstabelle ausgegeben. Anschließend wird das Histogramm gebildet.

```{r}
yz <- data.table(table(Befragung$test_nxste_zeit_kat), table(Befragung$nxste_zeit_kat))
colnames(yz) <- c("Kategorie","Ermittlung", "Kategorie1","Befragung")
yz <- select(yz,-"Kategorie1")
yz <- slice(yz, 1:7) # nur die Zeilen 1-7 auswählen, da die Kategorien 8 und 9 ohnehin leer sind und > 60 min zusammengefasst wird
yz <- melt(yz, id = "Kategorie")

ggplot(data = yz, aes(x = Kategorie, y=value)) + 
  geom_bar(aes(fill = variable), position = "dodge", stat = "identity")+ 
  scale_fill_manual(values = c("#9ecae1", "#3182bd"))+
  scale_x_discrete(breaks = 1:7, name = "Zugangszeit [min]", labels = c("unzureichende/\nkeine Angabe", "Unbekannt", "1-5", "6-15", "16-30", "31-60", "> 60")) +
  geom_text(aes(label=paste0(0.01*round(value/(sum(value)/2)*10000),'%'), group=variable), position = position_dodge(.9),size=2.5,vjust=-1)+
  labs(x = "Zugangszeit [min]",
    y = "Anzahl") +
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5, face = "bold"),
        legend.title = element_blank(),legend.position = c(0.8,0.9),legend.direction =  "horizontal",legend.spacing.x = unit(0.1,"cm"),legend.background = element_rect(color = "black",fill = "transparent"))
```

## Datenaufbereitung

Die zuvor auf "-90" geänderten Werte wieder auf "NA" gesetzt. 

```{r, results='hide'}
Befragung <- Befragung %>% dplyr::na_if(-90)
x=length(which(is.na(Befragung$nxste_zeit)))
x
x=length(which(is.na(Befragung$test_nxste_zeit)))
x
```

Es werden nun die Zugangszeiten in einem Liniendiagramm dargestellt, um Unterschiede zwischen den ermittelten und angegebenen Zugangszeiten feststellen zu können. 

```{r}
zuabzeiten_kum_erm <- data.table(table(Befragung$test_nxste_zeit))
zuabzeiten_kum_erm$Kategorie <- " Ermittlung"

zuabzeiten_kum_befr <- subset(Befragung, nxste_zeit != 0)
zuabzeiten_kum_befr <- data.table(table(zuabzeiten_kum_befr$nxste_zeit))
zuabzeiten_kum_befr$Kategorie <- "Befragung"

zuabzeiten_kum <- bind_rows(zuabzeiten_kum_befr, zuabzeiten_kum_erm)

zuabzeiten_kum <- zuabzeiten_kum %>% arrange(as.numeric(V1)) %>% group_by(Kategorie) %>% mutate(cum_sum = cumsum(N))

ggplot(data = zuabzeiten_kum, aes(x = as.numeric(V1), y=as.numeric(cum_sum), group = Kategorie, color = Kategorie)) +
  geom_line(aes(color = Kategorie, group = Kategorie), size = 1.2)+
  scale_color_manual(values = c("#9ecae1","#3182bd"))+
  labs(x = "Zu- bzw. Abgangszeit [min]",
    y = "Anzahl") +
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5, face = "bold"),
        legend.title = element_blank(),legend.position = c(0.8,0.1),legend.direction =  "horizontal",legend.spacing.x = unit(0.1,"cm"),legend.background = element_rect(color = "black",fill = "transparent"))
```

Nun werden die Zu- und Abgangszeiten getrennt betrachtet und ebenfalls als Linien dargestellt. Zunächst werden die Häufigkeiten pro Minute betrachtet. 

```{r}
eins_bis_vierzig <- data.table(1:40)
eins_bis_vierzig$V1 <- as.integer(eins_bis_vierzig$V1)

zugangsweg <- subset(Befragung, zuab == 1)
abgangsweg <- subset(Befragung, zuab == 2)

zuzeiten_kum_erm <- data.table(table(zugangsweg$test_nxste_zeit))
zuzeiten_kum_erm$V1 <- as.integer(zuzeiten_kum_erm$V1)
zuzeiten_kum_erm <- full_join(eins_bis_vierzig, zuzeiten_kum_erm, by = "V1")
zuzeiten_kum_erm$Kategorie <- "Ermittlung"
zuzeiten_kum_erm$zuab <- "Zugangszeit"

abzeiten_kum_erm <- data.table(table(abgangsweg$test_nxste_zeit))
abzeiten_kum_erm$V1 <- as.integer(abzeiten_kum_erm$V1)
abzeiten_kum_erm <- full_join(eins_bis_vierzig, abzeiten_kum_erm, by = "V1")
abzeiten_kum_erm$Kategorie <- "Ermittlung"
abzeiten_kum_erm$zuab <- "Abgangszeit"
zuabzeiten_kum_erm <- bind_rows(zuzeiten_kum_erm, abzeiten_kum_erm)

zuabzeiten_kum_befr <- subset(Befragung, nxste_zeit != 0)
zugangsweg <- subset(zuabzeiten_kum_befr, zuab == 1)
abgangsweg <- subset(zuabzeiten_kum_befr, zuab == 2)

zuzeiten_kum_befr <- data.table(table(zugangsweg$nxste_zeit))
zuzeiten_kum_befr$V1 <- as.integer(zuzeiten_kum_befr$V1)
zuzeiten_kum_befr <- full_join(eins_bis_vierzig, zuzeiten_kum_befr, by = "V1")
zuzeiten_kum_befr$Kategorie <- "Befragung"
zuzeiten_kum_befr$zuab <- "Zugangszeit"

abzeiten_kum_befr <- data.table(table(abgangsweg$nxste_zeit))
abzeiten_kum_befr$V1 <- as.integer(abzeiten_kum_befr$V1)
abzeiten_kum_befr <- full_join(eins_bis_vierzig, abzeiten_kum_befr, by = "V1")
abzeiten_kum_befr$Kategorie <- "Befragung"
abzeiten_kum_befr$zuab <- "Abgangszeit"
zuabzeiten_kum_befr <- bind_rows(zuzeiten_kum_befr, abzeiten_kum_befr)

zuabzeiten_kum <- bind_rows(zuabzeiten_kum_erm, zuabzeiten_kum_befr)
zuabzeiten_kum[is.na(zuabzeiten_kum)] <- 0

zuabzeiten_kum <- zuabzeiten_kum %>% arrange(as.numeric(V1)) %>% group_by(Kategorie,zuab) %>% mutate(cum_sum = cumsum(N))

ggplot(data = zuabzeiten_kum, aes(x = as.numeric(V1), y=as.numeric(N), color = Kategorie)) +
  geom_line(aes(color = Kategorie, linetype=zuab), size = 1.2)+
  scale_color_manual(values = c("#3182bd","#9ecae1"))+
  labs(x = "Zu- bzw. Abgangszeit [min]",
    y = "Häufigkeit") +
  theme_bw()+
  theme(legend.title = element_blank(), legend.position = "bottom")
```

Nun werden kumulierten Häufigkeiten betrachtet. 

```{r}
ggplot(data = zuabzeiten_kum, aes(x = as.numeric(V1), y=as.numeric(cum_sum), color = Kategorie)) +
  geom_line(aes(color = Kategorie, linetype=zuab), size = 1.2)+
  scale_color_manual(values = c("#3182bd","#9ecae1"))+
  labs(x = "Zu- bzw. Abgangszeit [min]",
    y = "Kumulierte Häufigkeit") +
  theme_bw()+
  theme(legend.title = element_blank(), legend.position = "bottom")
```

### Klassifizieren der Daten

Die Klassifizierung ist für die statistische Auswertung erforderlich. 

```{r, results='hide'}
str(Befragung)
Befragung$stand <- as.factor(Befragung$stand)
Befragung$tuer <- as.factor(Befragung$tuer)
Befragung$stunde <- as.ordered(Befragung$stunde)
Befragung$zuab <- as.factor(Befragung$zuab)
Befragung$vm_jetzt <- as.factor(Befragung$vm_jetzt)
Befragung$zweck_ausg <- as.factor(Befragung$zweck_ausg)
Befragung$zweck_ziel <- as.factor(Befragung$zweck_ziel)
Befragung$weg_routine <- as.factor(Befragung$weg_routine)
Befragung$vm_vorher <- as.factor(Befragung$vm_vorher)
Befragung$hst_nutz <- as.ordered(Befragung$hst_nutz)
Befragung$hst_nxste <- as.factor(Befragung$hst_nxste)
Befragung$nxste_vm_citybus <- as.factor(Befragung$nxste_vm_citybus)
Befragung$nxste_vm_regbus <- as.factor(Befragung$nxste_vm_regbus)
Befragung$nxste_vm_wlb <- as.factor(Befragung$nxste_vm_wlb)
Befragung$nxste_vm_zug <- as.factor(Befragung$nxste_vm_zug)
Befragung$nxste_nutz <- as.factor(Befragung$nxste_nutz)
Befragung$nxste_nicht1 <- as.factor(Befragung$nxste_nicht1)
Befragung$nxste_nicht2 <- as.factor(Befragung$nxste_nicht2)
Befragung$nxste_nicht3 <- as.factor(Befragung$nxste_nicht3)
Befragung$nxste_zufr <- as.factor(Befragung$nxste_zufr)
Befragung$weg_kurz <- as.factor(Befragung$weg_kurz)
Befragung$weg_kurz_nein1 <- as.factor(Befragung$weg_kurz_nein1)
Befragung$weg_kurz_nein2 <- as.factor(Befragung$weg_kurz_nein2)
Befragung$weg_attrak <- as.ordered(Befragung$weg_attrak)
Befragung$weg_attrak_warum1 <- as.factor(Befragung$weg_attrak_warum1)
Befragung$weg_attrak_warum2 <- as.factor(Befragung$weg_attrak_warum2)
Befragung$weg_attrak_warum3 <- as.factor(Befragung$weg_attrak_warum3)
Befragung$weg_attrak_warum4 <- as.factor(Befragung$weg_attrak_warum4)
Befragung$p_alter_kat <- as.ordered(Befragung$p_alter_kat)
Befragung$p_geschlecht <- as.factor(Befragung$p_geschlecht)
Befragung$p_bildung <- as.ordered(Befragung$p_bildung)
Befragung$p_beruf <- as.factor(Befragung$p_beruf)
Befragung$p_fs_B <- as.factor(Befragung$p_fs_B)
Befragung$p_fs_A <- as.factor(Befragung$p_fs_A)
Befragung$p_fs_C <- as.factor(Befragung$p_fs_C)
Befragung$p_fzg_rad <- as.factor(Befragung$p_fzg_rad)
Befragung$p_fzg_ebike <- as.factor(Befragung$p_fzg_ebike)
Befragung$p_fzg_mrad <- as.factor(Befragung$p_fzg_mrad)
Befragung$p_fzg_pkw <- as.factor(Befragung$p_fzg_pkw)
Befragung$p_zeitkarte <- as.factor(Befragung$p_zeitkarte)
Befragung$p_ermkarte <- as.factor(Befragung$p_ermkarte)
Befragung$p_navi <- as.factor(Befragung$p_navi)
Befragung$p_navi_name1 <- as.factor(Befragung$p_navi_name1)
Befragung$p_navi_name2 <- as.factor(Befragung$p_navi_name2)
Befragung$p_navi_name3 <- as.factor(Befragung$p_navi_name3)

Befragung$test_kurz_weg <- as.factor(Befragung$test_kurz_weg)
Befragung$test_hst_nxste <- as.factor(Befragung$test_hst_nxste)
Befragung$test_citybus <- as.factor(Befragung$test_citybus)
Befragung$test_regbus <- as.factor(Befragung$test_regbus)
Befragung$test_wlb <- as.factor(Befragung$test_wlb)
Befragung$test_zug <- as.factor(Befragung$test_zug)

str(Befragung)
```

# Übereinstimmung der Zugangszeiten

Um die Übereinstimmung der Zugangszeiten feststellen zu können, wird einerseits ein sogenannter Übereinstimmungsfaktor eingeführt, andererseits werden die Zuganszeiten in einem Punktdiagramm dargestellt.

## Übereinstimmungfaktor

Für Vergleiche zwischen den Zugangszeiten der beiden Datensätze wird ein sogenannter Übereinstimmungsfaktor eingeführt. Dabei wird die bei der Befragung angegebene Zu- bzw. Abgangszeit durch die im Nachhinein ermittelte Zu- bzw. Abgangszeit dividiert. Ein Übereinstimmungsfaktor zwischen 0 und kleiner 1 bedeutet, dass die der Befragung angegebene kürzer ist als die ermittelte  Zu- oder Abgangszeit, es wird die Zu- bzw. Abgangszeit also unterschätzt. Ein Übereinstimmungsfaktor von genau 1 bedeutet, dass die Zugangszeiten ident sind und alle Werte größer 1 bedeuten, dass die in der Befragung angegebene Zu- oder Abgangszeit größer ist als die ermittelte Zu- oder Abgangszeit, es handelt sich also um eine Überschätzung der Zu- bzw. Abgangswerte. Jene Werte können zwischen > 1 und unendlich liegen. Da aufgrund dieser Asymmetrie direkte Vergleiche kaum möglich sind, wird in den Diagrammen eine logarithmische Skala herangezogen. Der Übereinstimmungsfaktor ist folgendermaßen zu interpretieren: 

- Übereinstimmungsfaktor < 1: bei Befragung angegeben < Zu- bzw. Abgangszeit ermittelt (Unterschätzen der Zu- bzw. Abgangszeit)
- Übereinstimmungsfaktor = 1: Zugangszeiten sind ident
- Übereinstimmungsfaktor > 1: bei Befragung angegeben > Zu- bzw. Abgangszeit ermittelt (Überschätzen der Zu- bzw. Abgangszeit)

Zusätzlich zu dem Übereinstimmungsfaktor wird der logarithmierte Übereinstimmungsfaktor angegeben (lg10 (Zu- bzw. Abgangszeit angegeben/Zu- bzw. Abgangszeit ermittelt)). Dieser ist folgendermaßen zu interpretieren: 

- Übereinstimmungsfaktor < 0: bei Befragung angegeben < Zu- bzw. Abgangszeit ermittelt (Unterschätzen der Zu- bzw. Abgangszeit)
- Übereinstimmungsfaktor = 0: Zugangszeiten sind ident
- Übereinstimmungsfaktor > 0: bei Befragung angegeben > Zu- bzw. Abgangszeit ermittelt (Überschätzen der Zu- bzw. Abgangszeit)

### Tabelle erzeugen (Interpretation des Übereinstimmungsfaktors)

```{r}
Uebereinstimmungsfaktor <- data.frame(c("Übereinstimmungsfaktor","< 1 (< 0 bei lg)","= 1 (= 0 bei lg)","> 1 (> 0 bei lg)"),  c("Zu- bzw. Abgangszeit","angegeben < ermittelt","angegeben = ermittelt","angegeben > ermittelt"),c("Interpretation","Unterschätzen der Zu- bzw. Abgangszeit","Idente Zu- bzw. Abgangszeit","Überschätzen der Zu- bzw. Abgangszeit"))

colnames(Uebereinstimmungsfaktor) <- Uebereinstimmungsfaktor[1,] # 1. Zeile zur Überschrift machen
Uebereinstimmungsfaktor <- Uebereinstimmungsfaktor[-1, ] 

# Tabelle erzeugen
kbl(Uebereinstimmungsfaktor, align = "c") %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),full_width = FALSE)
```

### Berechnen des Übereinstimmungsfaktors

```{r, results='hide'}
Befragung <- mutate(Befragung, gleich_entf_fakt = ifelse(Befragung$test_nxste_zeit != "NA" & Befragung$test_nxste_zeit != 0 & Befragung$nxste_zeit != "NA" & Befragung$nxste_zeit != 0, (Befragung$nxste_zeit/Befragung$test_nxste_zeit), "NA"))
str(Befragung$gleich_entf_fakt)
Befragung$gleich_entf_fakt <- as.numeric(Befragung$gleich_entf_fakt)

Befragung <- Befragung %>% mutate(gleich_entf_fakt_lg = log10(gleich_entf_fakt))
```

Zusätzlich wird der Übereinstimmungsfaktor in fünf Klassen eingeteilt, die die Kenntnis, also den Grad der Übereinstimmung beschreiben. Dazu wird der nicht logarithmisierte Übereinstimmungfaktor herangezogen. Es ergeben sich folgende Klassen: 

1) sehr gute Kenntnis: 0,90 ≤ gleich_entf_fakt < 1,12
2) gute Kenntnis: 0,70 ≤ gleich_entf_fakt < 0,90 und 1,12 ≤ gleich_entf_fakt < 1,43
3) mäßige Kenntnis: 0,50 ≤ gleich_entf_fakt < 0,70 und 1,43 ≤ gleich_entf_fakt < 2,01
4) schlechte Kenntnis: 0,30 ≤ gleich_entf_fakt < 0,50 und 2,01 ≤ gleich_entf_fakt < 3,31
5) sehr schlechte Kenntnis: gleich_entf_fakt < 0,30 und gleich_entf_fakt ≥ 3,31

```{r, results='hide'}
Befragung <- mutate(Befragung, gleich_entf_kat = cut(gleich_entf_fakt,breaks =  c(0,0.3,0.5,0.7,0.9,1.12,1.43,2.01,3.31,105),labels = c("5","4","3","2","1","2","3","4","5")))
```

## Punktdiagramm

Auf der x-Achse befindet sich die bei der Befragung angegebene Zu- bzw. Abgangszeit, auf der y-Achse die im Anschluss ermittelte Zu- bzw. Abgangszeit. Der Übereinstimmungsgrad (Kenntnis) ist in den zuvor eingeführten Kategorien farblich dargestellt. Zusätzlich wird eine durch den Ursprung gehende Regressionsgerade hinzugefügt und die Formel der Regressionsgerade angeführt. 

```{r}
Befragung %>% 
  drop_na(gleich_entf_kat, test_nxste_zeit, nxste_zeit) %>%
  ggplot(Befragung, mapping = aes(x=as.numeric(nxste_zeit),y=as.numeric(test_nxste_zeit))) + 
  geom_jitter(aes(color = factor(gleich_entf_kat)), alpha=0.6, width = 0.2) + 
  geom_smooth(method = "lm", se=FALSE, formula = y ~-1+ x) +
  stat_regline_equation(aes(label =  paste(..eq.label.., ..rr.label.., sep = "~~~~")),formula =  y ~-1+ x,label.x = 20, label.y = 38)+
  scale_color_manual(values=c("red4","red3","orange","green3","green4"),labels=c("sehr schlecht","schlecht","mäßig","gut","sehr gut")) +
  xlim(0,40.5)+
  ylim(0,40.5)+
  labs(x = "Zu-/Abgangszeit angegeben [min]",
       y = "Zu-/Abgangszeit ermittelt [min]",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.background = element_rect(color = "black",fill = "transparent"),aspect.ratio=1)
```

### Punktdiagramm: Teilbereich von 15 min

Nun wird der Teilbereich von Zugangszeiten bis 15 min dargestellt. Die Punktansammlungen ergeben sich aufgrund der gewählten Darstellung des Punktdiagramms. Je dünkler ein Bereich, umso mehr Werte befinden sich dort. 

```{r}
Befragung %>% 
  drop_na(gleich_entf_kat, test_nxste_zeit, nxste_zeit) %>%
  ggplot(Befragung, mapping = aes(x=as.numeric(nxste_zeit),y=as.numeric(test_nxste_zeit))) + 
  geom_jitter(aes(color = factor(gleich_entf_kat)), alpha=0.6, width = 0.2) + 
  geom_smooth(method = "lm", se=FALSE, formula = y ~-1+ x) +
  stat_regline_equation(aes(label =  paste(..eq.label.., ..rr.label.., sep = "~~~~")),formula =  y ~-1+ x,label.x = 7.5, label.y = 14)+
  scale_color_manual(values=c("red4","red3","orange","green3","green4"),labels=c("sehr schlecht","schlecht","mäßig","gut","sehr gut")) +
  xlim(0,15.5)+
  ylim(0,15.5)+
  labs(x = "Zu-/Abgangszeit angegeben [min]",
       y = "Zu-/Abgangszeit ermittelt [min]",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.background = element_rect(color = "black",fill = "transparent"),aspect.ratio=1)
```

### Punktdiagramm: Teilbereich von 5 min

Nun wird der Teilbereich von Zugangszeiten bis 15 min dargestellt. Die Punktansammlungen ergeben sich aufgrund der gewählten Darstellung des Punktdiagramms. Je quadratischer und dünkler ein Bereich, umso mehr Werte befinden sich dort. 

```{r}
Befragung %>% 
  drop_na(gleich_entf_kat, test_nxste_zeit, nxste_zeit) %>%
  ggplot(Befragung, mapping = aes(x=as.numeric(nxste_zeit),y=as.numeric(test_nxste_zeit))) + 
  geom_jitter(aes(color = factor(gleich_entf_kat)), alpha=0.6, width = 0.2) + 
  geom_smooth(method = "lm", se=FALSE, formula = y ~-1+ x) +
  stat_regline_equation(aes(label =  paste(..eq.label.., ..rr.label.., sep = "~~~~")),formula =  y ~-1+ x,label.x = 0.25, label.y = 4.75)+
  scale_color_manual(values=c("red4","red3","orange","green3","green4"),labels=c("sehr schlecht","schlecht","mäßig","gut","sehr gut")) +
  xlim(0,5)+
  ylim(0,5)+
  labs(x = "Zu-/Abgangszeit angegeben [min]",
       y = "Zu-/Abgangszeit ermittelt [min]",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.background = element_rect(color = "black",fill = "transparent"),aspect.ratio=1)
```

# Untersuchen möglicher Einflussfaktoren auf den Kenntnisstand

In weiterer Folge mittels Hypothesentests geprüft, ob verschiedene Variablen einen Einfluss auf den Übereinstimmungsfaktor haben. Dies wird zudem mittels Boxplots graphisch abgebildet, bei denen die Gruppen der untersuchten Variablen sowie die Summe dieser Gruppen einander gegenüber gestellt werden.

*__Vorgehensweise bei den Hypothesentests__*

1. Bilden von Subsets für jede Gruppe einer Variable
2. Bilden von je einem Histogramm je Gruppe, um die Normalverteilung zu prüfen
3. Testen der Varianzhomogenität mittels Levene-Test
4. Bei __Normalverteilung und Varianzhomogenität__: ANOVA
    - Durchführen der ANOVA mittels "aov()"-Funktion
    - Anzeigen der Ergebnisse der ANOVA mittels "summary()"
5. Bei __Normalverteilung und Varianzheterogenität__: Welch-Test
    - Bei 2 Gruppen innerhalb einer Variable: Welch-Test mittels "t.test()"-Funktion
    - Bei > 2 Gruppen innerhalb einer Variable: Welch's ANOVA mittels "oneway.test()"-Funktion.
6. Post-hoc-Tests: 
    - Bei ANOVA: Paarweiser Vergleich der Ergebnisse der ANOVA mittels "pairwise.t.test()". Ergebnis ist eine t-Test-Signifikanztabelle. Ist der p-Wert <0,05, so ist die Nullhypothese, dass die beiden verglichenen Gruppen ähnlich sind, zu verwerfen. Es sind zwei Methoden zur Anpassung des p-Werts empfehlenswert: Bonferroni ist am konservativsten, Holm ist auch ok. 
    - Bei ANOVA: Histogramm der standardisierten Residuen zur Prüfung der Normalverteilung mittels "hist(rstandard())"-Funktion
    - Bei ANOVA: Q-Q-Plot, um ebenfalls die Normalverteilung zu prüfen
    - Bei Welch's Test bzw. Welch's ANOVA: games_howell_test

*__Beschriftung der y-Achse__*

```{r}
y_scale_beschriftung <- c(0.01,0.1,1,10,100)
```

## Unabhängige Variable: Standort

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
stand1 <- subset(Befragung, stand==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
stand2 <- subset(Befragung, stand==2,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
stand3 <- subset(Befragung, stand==3,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,3))
hist(stand1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(stand2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(stand3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$stand)
```

3. Hypothesentests

```{r}
anova_stand <- aov(gleich_entf_fakt_lg~stand,data=Befragung)
summary(anova_stand)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$stand,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_stand),main=NULL)
plot(anova_stand, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
standBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "stand", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,stand)

# Labels erstellen
text_labels1 <- group_by(
  standBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, stand, gleich_entf_fakt_lg),
  stand
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  standBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(standBoxplot,mapping = aes(
  x = as.numeric(stand),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=stand),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=stand),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:3, name = "Standort", labels = c("Bahnhof", "Josefsplatz (WLB)", "Josefsplatz (Bus)")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:3, name = "Standort", labels = c("Bahnhof", "Josefsplatz (WLB)", "Josefsplatz (Bus)")) +
  labs(x = "Standort",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(standBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1) # gemeinsame Legende für beide Diagramme erstellen
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(3,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(standBoxplot$gleich_entf_fakt_lg) # gesamt

standBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, stand, gleich_entf_fakt_lg) %>% group_by(stand) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(standBoxplot$gleich_entf_fakt) # gesamt

standBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, stand, gleich_entf_fakt_lg) %>% group_by(stand) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Zu-/Abgangsweg

1 ... Zugangsweg, 2 ... Abgangsweg

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
zuab1 <- subset(Befragung, zuab==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
zuab2 <- subset(Befragung, zuab==2,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(zuab1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(zuab2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$zuab)
```

3. Hypothesentests

```{r}
anova_zuab <- aov(gleich_entf_fakt_lg~zuab,data=Befragung)
summary(anova_zuab)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$zuab,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_zuab),main=NULL)
plot(anova_zuab, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
zuabBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "zuab", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,zuab)

# Labels erstellen
text_labels1 <- group_by(
  zuabBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, zuab, gleich_entf_fakt_lg),
  zuab
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  zuabBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(zuabBoxplot,mapping = aes(
  x = as.numeric(zuab),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=zuab),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=zuab),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "", labels = c("Zugangsweg", "Abgangsweg")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "", labels = c("Zugangsweg", "Abgangsweg")) +
  labs(x = "",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(zuabBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "", labels = c("Gesamt")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(zuabBoxplot$gleich_entf_fakt_lg) # gesamt

zuabBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, zuab, gleich_entf_fakt_lg) %>% group_by(zuab) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(zuabBoxplot$gleich_entf_fakt) # gesamt

zuabBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, zuab, gleich_entf_fakt_lg) %>% group_by(zuab) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Ausgangszweck

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
zweck_ausg1 <- subset(Befragung, zweck_ausg==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
zweck_ausg2 <- subset(Befragung, zweck_ausg==2,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
zweck_ausg3 <- subset(Befragung, zweck_ausg==3,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
zweck_ausg4 <- subset(Befragung, zweck_ausg==4,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
zweck_ausg5 <- subset(Befragung, zweck_ausg==5,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
zweck_ausg6 <- subset(Befragung, zweck_ausg==6,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
zweck_ausg7 <- subset(Befragung, zweck_ausg==7,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
zweck_ausg8 <- subset(Befragung, zweck_ausg==8,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
zweck_ausg9 <- subset(Befragung, zweck_ausg==9,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
zweck_ausg10 <- subset(Befragung, zweck_ausg==10,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg) 

par(mfrow=c(3,4))
hist(zweck_ausg1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(zweck_ausg2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(zweck_ausg3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(zweck_ausg4$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(zweck_ausg5$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(zweck_ausg6$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(zweck_ausg7$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(zweck_ausg8$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(zweck_ausg9$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(zweck_ausg10$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$zweck_ausg)
```

3. Hypothesentests

```{r}
anova_zweck_ausg <- aov(gleich_entf_fakt_lg~zweck_ausg,data=Befragung)
summary(anova_zweck_ausg)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$zweck_ausg,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_zweck_ausg),main=NULL)
plot(anova_zweck_ausg, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
zweck_ausgBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "zweck_ausg", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,zweck_ausg)

# Labels erstellen
text_labels1 <- group_by(
  zweck_ausgBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, zweck_ausg, gleich_entf_fakt_lg),
  zweck_ausg
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  zweck_ausgBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(zweck_ausgBoxplot,mapping = aes(
  x = as.numeric(zweck_ausg),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=zweck_ausg),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=zweck_ausg),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:10, name = "Ausgangszweck", labels = c("Arbeit", "Dienst-\nweg", "Schule/\nAusbil-\ndung", "Bring-\nund\nHolwege", "Ein-\nkaufen", "Erledi-\ngung", "Freizeit", "Besuch", "von\nzuhause","Anderer\nZweck")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:10, name = "Ausgangszweck", labels = c("Arbeit", "Dienst-\nweg", "Schule/\nAusbil-\ndung", "Bring-\nund\nHolwege", "Ein-\nkaufen", "Erledi-\ngung", "Freizeit", "Besuch", "von\nzuhause","Anderer\nZweck")) +
  labs(x = "Ausgangszweck",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(zweck_ausgBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("\n\n")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("\n\n")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(5,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(zweck_ausgBoxplot$gleich_entf_fakt_lg) # gesamt

zweck_ausgBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, zweck_ausg, gleich_entf_fakt_lg) %>% group_by(zweck_ausg) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(zweck_ausgBoxplot$gleich_entf_fakt) # gesamt

zweck_ausgBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, zweck_ausg, gleich_entf_fakt_lg) %>% group_by(zweck_ausg) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Zielzweck

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
zweck_ziel1 <- subset(Befragung, zweck_ziel==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
zweck_ziel2 <- subset(Befragung, zweck_ziel==2,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
zweck_ziel3 <- subset(Befragung, zweck_ziel==3,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
zweck_ziel4 <- subset(Befragung, zweck_ziel==4,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
zweck_ziel5 <- subset(Befragung, zweck_ziel==5,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
zweck_ziel6 <- subset(Befragung, zweck_ziel==6,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
zweck_ziel7 <- subset(Befragung, zweck_ziel==7,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
zweck_ziel8 <- subset(Befragung, zweck_ziel==8,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
zweck_ziel9 <- subset(Befragung, zweck_ziel==9,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
zweck_ziel10 <- subset(Befragung, zweck_ziel==10,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(3,4))
hist(zweck_ziel1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(zweck_ziel2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(zweck_ziel3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(zweck_ziel4$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(zweck_ziel5$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(zweck_ziel6$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(zweck_ziel7$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(zweck_ziel8$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(zweck_ziel9$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(zweck_ziel10$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$zweck_ziel)
```

3. Hypothesentests

```{r}
anova_zweck_ziel <- aov(gleich_entf_fakt_lg~zweck_ziel,data=Befragung)
summary(anova_zweck_ziel)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$zweck_ziel,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_zweck_ziel),main=NULL)
plot(anova_zweck_ziel, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
zweck_zielBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "zweck_ziel", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,zweck_ziel)

# Labels erstellen
text_labels1 <- group_by(
  zweck_zielBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, zweck_ziel, gleich_entf_fakt_lg),
  zweck_ziel
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  zweck_zielBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(zweck_zielBoxplot,mapping = aes(
  x = as.numeric(zweck_ziel),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=zweck_ziel),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=zweck_ziel),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:10, name = "Zielzweck", labels = c("Arbeit", "Dienst-\nweg", "Schule/\nAusbil-\ndung", "Bring-\nund\nHolwege", "Ein-\nkaufen", "Erledi-\ngung", "Freizeit", "Besuch", "nach\nHause","Anderer\nZweck"))+
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:10, name = "Zielzweck", labels = c("Arbeit", "Dienst-\nweg", "Schule/\nAusbil-\ndung", "Bring-\nund\nHolwege", "Ein-\nkaufen", "Erledi-\ngung", "Freizeit", "Besuch", "nach\nHause","Anderer\nZweck"))+
  labs(x = "Zielzweck",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(zweck_zielBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("\n\n")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("\n\n")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(5,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(zweck_zielBoxplot$gleich_entf_fakt_lg) # gesamt

zweck_zielBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, zweck_ziel, gleich_entf_fakt_lg) %>% group_by(zweck_ziel) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(zweck_zielBoxplot$gleich_entf_fakt) # gesamt

zweck_zielBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, zweck_ziel, gleich_entf_fakt_lg) %>% group_by(zweck_ziel) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Routineweg

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
weg_routine0 <- subset(Befragung, weg_routine==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
weg_routine1 <- subset(Befragung, weg_routine==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(weg_routine0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(weg_routine1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$weg_routine)
```

3. Hypothesentests

```{r}
anova_weg_routine <- aov(gleich_entf_fakt_lg~weg_routine,data=Befragung)
summary(anova_weg_routine)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$weg_routine,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_weg_routine),main=NULL)
plot(anova_weg_routine, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
weg_routineBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "weg_routine", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,weg_routine)

# Labels erstellen
text_labels1 <- group_by(
  weg_routineBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, weg_routine, gleich_entf_fakt_lg),
  weg_routine
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  weg_routineBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(weg_routineBoxplot,mapping = aes(
  x = as.numeric(weg_routine),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=weg_routine),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=weg_routine),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Routineweg", labels = c("Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Routineweg", labels = c("Nein", "Ja")) +
  labs(x = "Routineweg",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(weg_routineBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(weg_routineBoxplot$gleich_entf_fakt_lg) # gesamt

weg_routineBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, weg_routine, gleich_entf_fakt_lg) %>% group_by(weg_routine) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(weg_routineBoxplot$gleich_entf_fakt) # gesamt

weg_routineBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, weg_routine, gleich_entf_fakt_lg) %>% group_by(weg_routine) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Nutzung des ÖV-Angebotes Befragungsstandort in den letzten 7 Tagen

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
hst_nutz0 <- subset(Befragung, hst_nutz==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hst_nutz1 <- subset(Befragung, hst_nutz==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hst_nutz2 <- subset(Befragung, hst_nutz==2,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hst_nutz3 <- subset(Befragung, hst_nutz==3,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(2,2))
hist(hst_nutz0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hst_nutz1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hst_nutz2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hst_nutz3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$hst_nutz)
```

3. Hypothesentests

```{r}
anova_hst_nutz <- aov(gleich_entf_fakt_lg~hst_nutz,data=Befragung)
summary(anova_hst_nutz)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$hst_nutz,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_hst_nutz),main=NULL)
plot(anova_hst_nutz, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
hst_nutzBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "hst_nutz", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,hst_nutz)

# Labels erstellen
text_labels1 <- group_by(
  hst_nutzBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_nutz, gleich_entf_fakt_lg),
  hst_nutz
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  hst_nutzBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(hst_nutzBoxplot,mapping = aes(
  x = as.numeric(hst_nutz),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=hst_nutz),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=hst_nutz),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:4, name = "Nutzung ÖV-Angebot am Befragungsstandort in den letzten 7 Tagen", labels = c("Gar nicht", "1 Mal", "2 bis 3 Mal", "an 4 oder\nmehr Tagen")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:4, name = "Nutzung ÖV-Angebot am Befragungsstandort in den letzten 7 Tagen", labels = c("Gar nicht", "1 Mal", "2 bis 3 Mal", "an 4 oder\nmehr Tagen")) +
  labs(x = "Nutzung ÖV-Angebot am Standort in den letzten 7 Tagen",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(hst_nutzBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c(" \n ")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c(" \n ")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(3,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(hst_nutzBoxplot$gleich_entf_fakt_lg) # gesamt

hst_nutzBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_nutz, gleich_entf_fakt_lg) %>% group_by(hst_nutz) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(hst_nutzBoxplot$gleich_entf_fakt) # gesamt

hst_nutzBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_nutz, gleich_entf_fakt_lg) %>% group_by(hst_nutz) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Nutzung des ÖV-Angebotes der vermeintlich nächstgelegenen Haltestelle in den letzten 7 Tagen

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
nxste_nutz0 <- subset(Befragung, nxste_nutz==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
nxste_nutz1 <- subset(Befragung, nxste_nutz==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
nxste_nutz2 <- subset(Befragung, nxste_nutz==2,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
nxste_nutz3 <- subset(Befragung, nxste_nutz==3,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(2,2))
hist(nxste_nutz0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(nxste_nutz1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(nxste_nutz2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(nxste_nutz3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$nxste_nutz)
```

3. Hypothesentests

```{r}
oneway.test(gleich_entf_fakt_lg ~ nxste_nutz, data=Befragung)
```

4. Post-hoc-Tests

```{r}
games_howell_test(Befragung, gleich_entf_fakt_lg ~ nxste_nutz, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
nxste_nutzBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "nxste_nutz", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,nxste_nutz)

# Labels erstellen
text_labels1 <- group_by(
  nxste_nutzBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, nxste_nutz, gleich_entf_fakt_lg),
  nxste_nutz
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  nxste_nutzBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(nxste_nutzBoxplot,mapping = aes(
  x = as.numeric(nxste_nutz),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=nxste_nutz),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=nxste_nutz),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:4, name = "Nutzung ÖV-Angebot der nächsten Haltestelle in den letzten 7 Tagen\n(inkl. Befragungsstandort)", labels = c("Gar nicht", "1 Mal", "2 bis 3 Mal", "an 4 oder\nmehr Tagen")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:4, name = "Nutzung ÖV-Angebot der nächsten Haltestelle in den letzten 7 Tagen\n(inkl. Befragungsstandort)", labels = c("Gar nicht", "1 Mal", "2 bis 3 Mal", "an 4 oder\nmehr Tagen")) +
  labs(x = "Nutzung ÖV-Angebot der nächsten Haltestelle in den letzten 7 Tagen",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(nxste_nutzBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c(" \n ")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c(" \n ")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(3,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(nxste_nutzBoxplot$gleich_entf_fakt_lg) # gesamt

nxste_nutzBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, nxste_nutz, gleich_entf_fakt_lg) %>% group_by(nxste_nutz) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(nxste_nutzBoxplot$gleich_entf_fakt) # gesamt

nxste_nutzBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, nxste_nutz, gleich_entf_fakt_lg) %>% group_by(nxste_nutz) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Nutzung des ÖV-Angebotes der nicht gewählten angegebenen nächstgelegenen Haltestelle in den letzten 7 Tagen

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
hst_nxste_nein <- filter(Befragung, hst_nxste == 0)

nxste_nutz0 <- subset(hst_nxste_nein, nxste_nutz==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
nxste_nutz1 <- subset(hst_nxste_nein, nxste_nutz==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
nxste_nutz2 <- subset(hst_nxste_nein, nxste_nutz==2,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
nxste_nutz3 <- subset(hst_nxste_nein, nxste_nutz==3,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(2,2))
hist(nxste_nutz0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(nxste_nutz1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(nxste_nutz2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(nxste_nutz3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(hst_nxste_nein$gleich_entf_fakt_lg, hst_nxste_nein$nxste_nutz)
```

3. Hypothesentests

```{r}
anova_nxste_nutz <- aov(gleich_entf_fakt_lg~nxste_nutz,data=hst_nxste_nein)
summary(anova_nxste_nutz)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(hst_nxste_nein$gleich_entf_fakt_lg, hst_nxste_nein$nxste_nutz,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_nxste_nutz),main=NULL)
plot(anova_nxste_nutz, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
nxste_nutzBoxplot <- subset(hst_nxste_nein, select=c("gleich_entf_kat", "nxste_nutz", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,nxste_nutz)

# Labels erstellen
text_labels1 <- group_by(
  nxste_nutzBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, nxste_nutz, gleich_entf_fakt_lg),
  nxste_nutz
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  nxste_nutzBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(nxste_nutzBoxplot,mapping = aes(
  x = as.numeric(nxste_nutz),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=nxste_nutz),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=nxste_nutz),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:4, name = "Nutzung ÖV-Angebot der nächsten Haltestelle in den letzten 7 Tagen", labels = c("Gar nicht", "1 Mal", "2 bis 3 Mal", "an 4 oder\nmehr Tagen")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:4, name = "Nutzung ÖV-Angebot der nächsten Haltestelle in den letzten 7 Tagen\n(exkl. Befragungsstandort)", labels = c("Gar nicht", "1 Mal", "2 bis 3 Mal", "an 4 oder\nmehr Tagen")) +
  labs(x = "Nutzung ÖV-Angebot der nächsten Haltestelle in den letzten 7 Tagen\n(exkl. Befragungsstandort)",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(nxste_nutzBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c(" \n ")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c(" \n ")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(3,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(nxste_nutzBoxplot$gleich_entf_fakt_lg) # gesamt

nxste_nutzBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, nxste_nutz, gleich_entf_fakt_lg) %>% group_by(nxste_nutz) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(nxste_nutzBoxplot$gleich_entf_fakt) # gesamt

nxste_nutzBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, nxste_nutz, gleich_entf_fakt_lg) %>% group_by(nxste_nutz) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Nutzung des ÖV-Angebotes der nicht gewählten angegebenen nächstgelegenen Haltestelle in den letzten 7 Tagen

Aufgrund der geringen Anzahl an Beobachtungen in den Kategorien "1 Mal" bis "an 4+ Tagen", werden die Kategorien zu 2 Nutzungskategorien zusammengefasst (Nutzung Nein und Ja): 

```{r}
hst_nxste_nein <- filter(Befragung, hst_nxste == 0)
hst_nxste_nein <- hst_nxste_nein %>% mutate(nxste_nutz_neu = case_when(nxste_nutz == 0 ~ 0,
                                                                       nxste_nutz == 1 | nxste_nutz == 2 | nxste_nutz == 3 ~ 1))
```

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
nxste_nutz_neu0 <- subset(hst_nxste_nein, nxste_nutz_neu==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
nxste_nutz_neu1 <- subset(hst_nxste_nein, nxste_nutz_neu==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(nxste_nutz_neu0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(nxste_nutz_neu1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(hst_nxste_nein$gleich_entf_fakt_lg, hst_nxste_nein$nxste_nutz_neu)
```

3. Hypothesentests

```{r}
anova_nxste_nutz_neu <- aov(gleich_entf_fakt_lg~nxste_nutz_neu,data=hst_nxste_nein)
summary(anova_nxste_nutz_neu)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(hst_nxste_nein$gleich_entf_fakt_lg, hst_nxste_nein$nxste_nutz_neu,p.adjust.method = "bonferroni") # bei Anova

par(mfrow=c(1,2))
hist(rstandard(anova_nxste_nutz_neu),main=NULL)
plot(anova_nxste_nutz_neu, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
nxste_nutz_neuBoxplot <- subset(hst_nxste_nein, select=c("gleich_entf_kat", "nxste_nutz_neu", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,nxste_nutz_neu)

# Labels erstellen
text_labels1 <- group_by(
  nxste_nutz_neuBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, nxste_nutz_neu, gleich_entf_fakt_lg),
  nxste_nutz_neu
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  nxste_nutz_neuBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(nxste_nutz_neuBoxplot,mapping = aes(
  x = as.numeric(nxste_nutz_neu),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=nxste_nutz_neu),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=nxste_nutz_neu),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:4, name = "Nutzung ÖV-Angebot der nächsten Haltestelle in den letzten 7 Tagen", labels = c("Gar nicht", "1 Mal", "2 bis 3 Mal", "an 4 oder\nmehr Tagen")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:4, name = "Nutzung ÖV-Angebot der nächsten Haltestelle in den letzten 7 Tagen\n(exkl. Befragungsstandort)", labels = c("Gar nicht", "1 Mal", "2 bis 3 Mal", "an 4 oder\nmehr Tagen")) +
  labs(x = "Nutzung ÖV-Angebot der nächsten Haltestelle in den letzten 7 Tagen\n(exkl. Befragungsstandort)",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(nxste_nutz_neuBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c(" \n ")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c(" \n ")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(3,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(nxste_nutz_neuBoxplot$gleich_entf_fakt_lg) # gesamt

nxste_nutz_neuBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, nxste_nutz_neu, gleich_entf_fakt_lg) %>% group_by(nxste_nutz_neu) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(nxste_nutz_neuBoxplot$gleich_entf_fakt) # gesamt

nxste_nutz_neuBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, nxste_nutz_neu, gleich_entf_fakt_lg) %>% group_by(nxste_nutz_neu) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhänigige Variable: Nächste Haltestelle gewählt (laut Befragung)?

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
hst_nxste0 <- subset(Befragung, hst_nxste==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
hst_nxste1 <- subset(Befragung, hst_nxste==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(hst_nxste0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(hst_nxste1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$hst_nxste)
```

3. Hypothesentests

```{r}
anova_hst_nxste <- aov(gleich_entf_fakt_lg~hst_nxste,data=Befragung)
summary(anova_hst_nxste)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$hst_nxste,p.adjust.method = "bonferroni") # bei Anova

par(mfrow=c(1,2))
hist(rstandard(anova_hst_nxste),main=NULL)
plot(anova_hst_nxste, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
hst_nxsteBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "hst_nxste", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,hst_nxste)

# Labels erstellen
text_labels1 <- group_by(
  hst_nxsteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_nxste, gleich_entf_fakt_lg),
  hst_nxste
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  hst_nxsteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(hst_nxsteBoxplot,mapping = aes(
  x = as.numeric(hst_nxste),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=hst_nxste),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=hst_nxste),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Nächste Haltestelle gewählt (laut Befragung)?", labels = c("Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Nächste Haltestelle gewählt (laut Befragung)?", labels = c("Nein", "Ja")) +
  labs(x = "Nächste Haltestelle gewählt (laut Befragung)?",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(hst_nxsteBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(hst_nxsteBoxplot$gleich_entf_fakt_lg) # gesamt

hst_nxsteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_nxste, gleich_entf_fakt_lg) %>% group_by(hst_nxste) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(hst_nxsteBoxplot$gleich_entf_fakt) # gesamt

hst_nxsteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, hst_nxste, gleich_entf_fakt_lg) %>% group_by(hst_nxste) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhänigige Variable: Nächste Haltestelle gewählt (laut Ermittlung)?

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
test_hst_nxste0 <- subset(Befragung, test_hst_nxste==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
test_hst_nxste1 <- subset(Befragung, test_hst_nxste==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(test_hst_nxste0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(test_hst_nxste1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$test_hst_nxste)
```

3. Hypothesentests

```{r}
t.test(gleich_entf_fakt_lg~test_hst_nxste,data=Befragung,var.equal=FALSE,alternative="two.sided")
```

4. Post-hoc-Tests

```{r}
games_howell_test(Befragung, gleich_entf_fakt_lg ~ test_hst_nxste, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
test_hst_nxsteBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "test_hst_nxste", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,test_hst_nxste)

# Labels erstellen
text_labels1 <- group_by(
  test_hst_nxsteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_hst_nxste, gleich_entf_fakt_lg),
  test_hst_nxste
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  test_hst_nxsteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(test_hst_nxsteBoxplot,mapping = aes(
  x = as.numeric(test_hst_nxste),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=test_hst_nxste),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=test_hst_nxste),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Nächste Haltestelle gewählt (laut Ermitllung)?", labels = c("Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Nächste Haltestelle gewählt (laut Ermittlung)?", labels = c("Nein", "Ja")) +
  labs(x = "Nächste Haltestelle gewählt (laut Ermittlung)?",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(test_hst_nxsteBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(test_hst_nxsteBoxplot$gleich_entf_fakt_lg) # gesamt

test_hst_nxsteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_hst_nxste, gleich_entf_fakt_lg) %>% group_by(test_hst_nxste) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(test_hst_nxsteBoxplot$gleich_entf_fakt) # gesamt

test_hst_nxsteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_hst_nxste, gleich_entf_fakt_lg) %>% group_by(test_hst_nxste) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Zufriedenheit mit dem ÖV-Angebot an der nächstgelegenen Haltestelle

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
nxste_zufr0 <- subset(Befragung, nxste_zufr==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
nxste_zufr1 <- subset(Befragung, nxste_zufr==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
nxste_zufr2 <- subset(Befragung, nxste_zufr==2,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
nxste_zufr3 <- subset(Befragung, nxste_zufr==3,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
nxste_zufr4 <- subset(Befragung, nxste_zufr==4,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
nxste_zufr5 <- subset(Befragung, nxste_zufr==5,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(2,3))
hist(nxste_zufr0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(nxste_zufr1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(nxste_zufr2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(nxste_zufr3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(nxste_zufr4$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(nxste_zufr5$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$nxste_zufr)
```

3. Hypothesentests

```{r}
anova_nxste_zufr <- aov(gleich_entf_fakt_lg~nxste_zufr,data=Befragung)
summary(anova_nxste_zufr)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$nxste_zufr,p.adjust.method = "bonferroni") # bei Anova

par(mfrow=c(1,2))
hist(rstandard(anova_nxste_zufr),main=NULL)
plot(anova_nxste_zufr, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
nxste_zufrBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "nxste_zufr", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,nxste_zufr)

# Labels erstellen
text_labels1 <- group_by(
  nxste_zufrBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, nxste_zufr, gleich_entf_fakt_lg),
  nxste_zufr
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  nxste_zufrBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(nxste_zufrBoxplot,mapping = aes(
  x = as.numeric(nxste_zufr),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=nxste_zufr),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=nxste_zufr),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:6, name = "Zufriedenheit mit dem ÖV-Angebot an der nächstgelegenen Haltestelle", labels = c("Weiß nicht", "Sehr\nunzufrieden", "Eher\nunzufrieden", "Neutral", "Eher\nzufrieden", "Sehr\nzufrieden")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:6, name = "Zufriedenheit mit dem ÖV-Angebot an der nächstgelegenen Haltestelle", labels = c("Weiß nicht", "Sehr\nunzufrieden", "Eher\nunzufrieden", "Neutral", "Eher\nzufrieden", "Sehr\nzufrieden")) +
  labs(x = "Zufriedenheit mit dem ÖV-Angebot an der nächstgelegenen Haltestelle",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(nxste_zufrBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c(" \n ")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c(" \n ")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(4,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(nxste_zufrBoxplot$gleich_entf_fakt_lg) # gesamt

nxste_zufrBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, nxste_zufr, gleich_entf_fakt_lg) %>% group_by(nxste_zufr) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(nxste_zufrBoxplot$gleich_entf_fakt) # gesamt

nxste_zufrBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, nxste_zufr, gleich_entf_fakt_lg) %>% group_by(nxste_zufr) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

Da in den einzelnen Gruppen wenige Beobachtungen sind, werden 5+1 Klassen zu 3+1 Klasse zusammengefasst: 

- Weiß nicht (0) = "Weiß nicht" (0)
- Unzufrieden (1) = "Sehr unzufrieden" (1) + "Eher unzufrieden" (2)
- Neutral (2) = "Neutral" (3)
- Zufrieden (3) = "Sehr zufrieden" (5) + "Eher zufrieden" (4)

```{r, results='hide'}
Befragung <- Befragung %>% 
  mutate(nxste_zufr_neu = case_when(nxste_zufr == 0 ~ 0,
                                    nxste_zufr == 1 | nxste_zufr == 2 ~ 1,
                                    nxste_zufr == 3 ~ 2,
                                    nxste_zufr == 4 | nxste_zufr == 5 ~ 3))
```

Nun werden die Hypothesentests und die Boxplots für die zusammengefasste Zufriedenheitsvariable durchgeführt: 

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
nxste_zufr_neu0 <- subset(Befragung, nxste_zufr_neu==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
nxste_zufr_neu1 <- subset(Befragung, nxste_zufr_neu==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
nxste_zufr_neu2 <- subset(Befragung, nxste_zufr_neu==2,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
nxste_zufr_neu3 <- subset(Befragung, nxste_zufr_neu==3,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(2,2))
hist(nxste_zufr_neu0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(nxste_zufr_neu1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(nxste_zufr_neu2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(nxste_zufr_neu3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$nxste_zufr_neu)
```

3. Hypothesentests

```{r}
anova_nxste_zufr_neu <- aov(gleich_entf_fakt_lg~nxste_zufr_neu,data=Befragung)
summary(anova_nxste_zufr_neu)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$nxste_zufr_neu,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_nxste_zufr_neu),main=NULL)
plot(anova_nxste_zufr_neu, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
nxste_zufr_neuBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "nxste_zufr_neu", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,nxste_zufr_neu)

# Labels erstellen
text_labels1 <- group_by(
  nxste_zufr_neuBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, nxste_zufr_neu, gleich_entf_fakt_lg),
  nxste_zufr_neu
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  nxste_zufr_neuBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(nxste_zufr_neuBoxplot,mapping = aes(
  x = as.numeric(nxste_zufr_neu),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+ 
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=nxste_zufr_neu),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=nxste_zufr_neu),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 0:3, name = "Zufriedenheit mit dem ÖV-Angebot an der nächstgelegenen Haltestelle", labels = c("Weiß nicht", "Unzufrieden", "Neutral", "Zufrieden")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 0:3, name = "Zufriedenheit mit dem ÖV-Angebot an der nächstgelegenen Haltestelle", labels = c("Weiß nicht", "Unzufrieden", "Neutral", "Zufrieden")) +
  labs(x = "Zufriedenheit mit dem ÖV-Angebot an der nächstgelegenen Haltestelle",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(nxste_zufr_neuBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c(" \n ")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c(" \n ")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(3,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(nxste_zufr_neuBoxplot$gleich_entf_fakt_lg) # gesamt

nxste_zufr_neuBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, nxste_zufr_neu, gleich_entf_fakt_lg) %>% group_by(nxste_zufr_neu) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(nxste_zufr_neuBoxplot$gleich_entf_fakt) # gesamt

nxste_zufr_neuBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, nxste_zufr_neu, gleich_entf_fakt_lg) %>% group_by(nxste_zufr_neu) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhänigige Variable: Kürzesten Weg gewählt (laut Befragung)?

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
weg_kurz0 <- subset(Befragung, weg_kurz==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
weg_kurz1 <- subset(Befragung, weg_kurz==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(weg_kurz0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(weg_kurz1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$weg_kurz)
```

3. Hypothesentests

```{r}
t.test(gleich_entf_fakt_lg~weg_kurz,data=Befragung,var.equal=FALSE,alternative="two.sided")
```

4. Post-hoc-Tests

```{r}
games_howell_test(Befragung, gleich_entf_fakt_lg ~ weg_kurz, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
weg_kurzBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "weg_kurz", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,weg_kurz)

# Labels erstellen
text_labels1 <- group_by(
  weg_kurzBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, weg_kurz, gleich_entf_fakt_lg),
  weg_kurz
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  weg_kurzBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(weg_kurzBoxplot,mapping = aes(
  x = as.numeric(weg_kurz),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=weg_kurz),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=weg_kurz),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Kürzesten Weg gewählt (laut Befragung)?", labels = c("Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Kürzesten Weg gewählt (laut Befragung)?", labels = c("Nein", "Ja")) +
  labs(x = "Kürzesten Weg gewählt (laut Befragung)?",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(weg_kurzBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"))+
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(weg_kurzBoxplot$gleich_entf_fakt_lg) # gesamt

weg_kurzBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, weg_kurz, gleich_entf_fakt_lg) %>% group_by(weg_kurz) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(weg_kurzBoxplot$gleich_entf_fakt) # gesamt

weg_kurzBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, weg_kurz, gleich_entf_fakt_lg) %>% group_by(weg_kurz) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhänigige Variable: Kürzesten Weg gewählt (laut Ermittlung)?

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
test_kurz_weg0 <- subset(Befragung, test_kurz_weg==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
test_kurz_weg1 <- subset(Befragung, test_kurz_weg==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(test_kurz_weg0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(test_kurz_weg1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$test_kurz_weg)
```

3. Hypothesentests

```{r}
t.test(gleich_entf_fakt_lg~test_kurz_weg,data=Befragung,var.equal=FALSE,alternative="two.sided")
```

4. Post-hoc-Tests

```{r}
games_howell_test(Befragung, gleich_entf_fakt_lg ~ test_kurz_weg, conf.level = 0.95, detailed = FALSE) # bei Welch-Test oder Welch-Anova
```

### Graphische Darstellung

```{r}
# Subset erzeugen
test_kurz_wegBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "test_kurz_weg", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,test_kurz_weg)

# Labels erstellen
text_labels1 <- group_by(
  test_kurz_wegBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_kurz_weg, gleich_entf_fakt_lg),
  test_kurz_weg
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  test_kurz_wegBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(test_kurz_wegBoxplot,mapping = aes(
  x = as.numeric(test_kurz_weg),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=test_kurz_weg),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=test_kurz_weg),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Kürzesten Weg gewählt (laut Ermittlung)?", labels = c("Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Kürzesten Weg gewählt (laut Ermittlung)?", labels = c("Nein", "Ja")) +
  labs(x = "Kürzesten Weg gewählt (laut Ermittlung)?",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(test_kurz_wegBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(test_kurz_wegBoxplot$gleich_entf_fakt_lg) # gesamt

test_kurz_wegBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_kurz_weg, gleich_entf_fakt_lg) %>% group_by(test_kurz_weg) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(test_kurz_wegBoxplot$gleich_entf_fakt) # gesamt

test_kurz_wegBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_kurz_weg, gleich_entf_fakt_lg) %>% group_by(test_kurz_weg) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Attraktivität des Zu- bzw. Abgangsweges

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
weg_attrak1 <- subset(Befragung, weg_attrak==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
weg_attrak2 <- subset(Befragung, weg_attrak==2,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
weg_attrak3 <- subset(Befragung, weg_attrak==3,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
weg_attrak4 <- subset(Befragung, weg_attrak==4,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
weg_attrak5 <- subset(Befragung, weg_attrak==5,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(2,3))
hist(weg_attrak1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(weg_attrak2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(weg_attrak3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(weg_attrak4$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(weg_attrak5$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$weg_attrak)
```

3. Hypothesentests

```{r}
oneway.test(gleich_entf_fakt_lg ~ weg_attrak, data=Befragung)
```

4. Post-hoc-Tests

```{r}
games_howell_test(Befragung, gleich_entf_fakt_lg ~ weg_attrak, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
weg_attrakBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "weg_attrak", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,weg_attrak)

# Labels erstellen
text_labels1 <- group_by(
  weg_attrakBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, weg_attrak, gleich_entf_fakt_lg),
  weg_attrak
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  weg_attrakBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(weg_attrakBoxplot,mapping = aes(
  x = as.numeric(weg_attrak),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=weg_attrak),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=weg_attrak),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:5, name = "Attraktivität des Zu- bzw. Abgangsweges", labels = c("Sehr unattraktiv", "Eher unattraktiv", "Neutral", "Eher attraktiv", "Sehr attraktiv")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:5, name = "Attraktivität des Zu- bzw. Abgangsweges", labels = c("Sehr unattraktiv", "Eher unattraktiv", "Neutral", "Eher attraktiv", "Sehr attraktiv")) +
  labs(x = "Attraktivität des Zu- bzw. Abgangsweges",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(weg_attrakBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(4,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(weg_attrakBoxplot$gleich_entf_fakt_lg) # gesamt

weg_attrakBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, weg_attrak, gleich_entf_fakt_lg) %>% group_by(weg_attrak) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(weg_attrakBoxplot$gleich_entf_fakt) # gesamt

weg_attrakBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, weg_attrak, gleich_entf_fakt_lg) %>% group_by(weg_attrak) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

Da in den einzelnen Gruppen wenige Beobachtungen sind, werden 5 Klassen zu 3 Klassen zusammengefasst: 

- Unattraktiv (1) = "Sehr unattraktiv" (1) + "Eher unattraktiv" (2)
- Neutral (2) = "Neutral" (3)
- Zufrieden (3) = "Sehr attraktiv" (5) + "Eher attraktiv" (4)

```{r, results='hide'}
Befragung <- Befragung %>% 
  mutate(weg_attrak_neu = case_when(weg_attrak == 1 | weg_attrak == 2 ~ 1,
                                    weg_attrak == 3 ~ 2,
                                    weg_attrak == 4 | weg_attrak == 5 ~ 3))
```

Nun werden die Hypothesentests und die Boxplots für die zusammengefasste Zufriedenheitsvariable durchgeführt: 

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
weg_attrak_neu1 <- subset(Befragung, weg_attrak_neu==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
weg_attrak_neu2 <- subset(Befragung, weg_attrak_neu==2,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
weg_attrak_neu3 <- subset(Befragung, weg_attrak_neu==3,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,3))
hist(weg_attrak_neu1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(weg_attrak_neu2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(weg_attrak_neu3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$weg_attrak_neu)
```

3. Hypothesentests

```{r}
anova_weg_attrak_neu <- aov(gleich_entf_fakt_lg~weg_attrak_neu,data=Befragung)
summary(anova_weg_attrak_neu)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$weg_attrak_neu,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_weg_attrak_neu),main=NULL)
plot(anova_weg_attrak_neu, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
weg_attrak_neuBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "weg_attrak_neu", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,weg_attrak_neu)

# Labels erstellen
text_labels1 <- group_by(
  weg_attrak_neuBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, weg_attrak_neu, gleich_entf_fakt_lg),
  weg_attrak_neu
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  weg_attrak_neuBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(weg_attrak_neuBoxplot,mapping = aes(
  x = as.numeric(weg_attrak_neu),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=weg_attrak_neu),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=weg_attrak_neu),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:3, name = "Attraktivität des Zu- bzw. Abgangsweges", labels = c("Unattraktiv", "Neutral", "Attraktiv")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:3, name = "Attraktivität des Zu- bzw. Abgangsweges", labels = c("Unattraktiv", "Neutral", "Attraktiv")) +
  labs(x = "Attraktivität des Zu- bzw. Abgangsweges",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(weg_attrak_neuBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2.75,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(weg_attrak_neuBoxplot$gleich_entf_fakt_lg) # gesamt

weg_attrak_neuBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, weg_attrak_neu, gleich_entf_fakt_lg) %>% group_by(weg_attrak_neu) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(weg_attrak_neuBoxplot$gleich_entf_fakt) # gesamt

weg_attrak_neuBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, weg_attrak_neu, gleich_entf_fakt_lg) %>% group_by(weg_attrak_neu) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Alterskategorie

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
p_alter_kat1 <- subset(Befragung, p_alter_kat==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_alter_kat2 <- subset(Befragung, p_alter_kat==2,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_alter_kat3 <- subset(Befragung, p_alter_kat==3,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_alter_kat4 <- subset(Befragung, p_alter_kat==4,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_alter_kat5 <- subset(Befragung, p_alter_kat==5,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_alter_kat6 <- subset(Befragung, p_alter_kat==6,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_alter_kat7 <- subset(Befragung, p_alter_kat==7,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_alter_kat8 <- subset(Befragung, p_alter_kat==8,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(3,3))
hist(p_alter_kat1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_alter_kat2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_alter_kat3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_alter_kat4$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_alter_kat5$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_alter_kat6$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_alter_kat7$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_alter_kat8$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$p_alter_kat)
```

3. Hypothesentests

```{r}
anova_p_alter_kat <- aov(gleich_entf_fakt_lg~p_alter_kat,data=Befragung)
summary(anova_p_alter_kat)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$p_alter_kat,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_p_alter_kat),main=NULL)
plot(anova_p_alter_kat, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
p_alter_katBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "p_alter_kat", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,p_alter_kat)

# Labels erstellen
text_labels1 <- group_by(
  p_alter_katBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_alter_kat, gleich_entf_fakt_lg),
  p_alter_kat
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  p_alter_katBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(p_alter_katBoxplot,mapping = aes(
  x = as.numeric(p_alter_kat),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=p_alter_kat),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=p_alter_kat),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:8, name = "Alter [Jahre]", labels = c("6-14", "15-19", "20-24", "25-34", "35-44", "45-54","55-64","65+")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:8, name = "Alter [Jahre]", labels = c("6-14", "15-19", "20-24", "25-34", "35-44", "45-54","55-64","65+")) +
  labs(x = "Alter [Jahre]",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(p_alter_katBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(4,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(p_alter_katBoxplot$gleich_entf_fakt_lg) # gesamt

p_alter_katBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_alter_kat, gleich_entf_fakt_lg) %>% group_by(p_alter_kat) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(p_alter_katBoxplot$gleich_entf_fakt) # gesamt

p_alter_katBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_alter_kat, gleich_entf_fakt_lg) %>% group_by(p_alter_kat) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Geschlecht

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
p_geschlecht1 <- subset(Befragung, p_geschlecht==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_geschlecht2 <- subset(Befragung, p_geschlecht==2,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(p_geschlecht1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_geschlecht2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$p_geschlecht)
```

3. Hypothesentests

```{r}
anova_p_geschlecht <- aov(gleich_entf_fakt_lg~p_geschlecht,data=Befragung)
summary(anova_p_geschlecht)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$p_geschlecht,p.adjust.method = "bonferroni") # bei Anova

par(mfrow=c(1,2))
hist(rstandard(anova_p_geschlecht),main=NULL)
plot(anova_p_geschlecht, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
p_geschlechtBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "p_geschlecht", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,p_geschlecht)

# Labels erstellen
text_labels1 <- group_by(
  p_geschlechtBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_geschlecht, gleich_entf_fakt_lg),
  p_geschlecht
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  p_geschlechtBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(p_geschlechtBoxplot,mapping = aes(
  x = as.numeric(p_geschlecht),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=p_geschlecht),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=p_geschlecht),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Geschlecht", labels = c("männlich", "weiblich")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Geschlecht", labels = c("männlich", "weiblich")) +
  labs(x = "Geschlecht",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(p_geschlechtBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(p_geschlechtBoxplot$gleich_entf_fakt_lg) # gesamt

p_geschlechtBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_geschlecht, gleich_entf_fakt_lg) %>% group_by(p_geschlecht) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(p_geschlechtBoxplot$gleich_entf_fakt) # gesamt

p_geschlechtBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_geschlecht, gleich_entf_fakt_lg) %>% group_by(p_geschlecht) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Höchste abgeschlossene Ausbildung

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
p_bildung1 <- subset(Befragung, p_bildung==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_bildung2 <- subset(Befragung, p_bildung==2,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_bildung3 <- subset(Befragung, p_bildung==3,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_bildung4 <- subset(Befragung, p_bildung==4,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_bildung5 <- subset(Befragung, p_bildung==5,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(2,3))
hist(p_bildung1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_bildung2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_bildung3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_bildung4$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_bildung5$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$p_bildung)
```

3. Hypothesentests

```{r}
anova_p_bildung <- aov(gleich_entf_fakt_lg~p_bildung,data=Befragung)
summary(anova_p_bildung)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$p_bildung,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_p_bildung),main=NULL)
plot(anova_p_bildung, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
p_bildungBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "p_bildung", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,p_bildung)

# Labels erstellen
text_labels1 <- group_by(
  p_bildungBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_bildung, gleich_entf_fakt_lg),
  p_bildung
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  p_bildungBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(p_bildungBoxplot,mapping = aes(
  x = as.numeric(p_bildung),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=p_bildung),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=p_bildung),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:5, name = "Höchste abgeschlossene Ausbildung", labels = c("noch kein\nSchulabschluss", "Pflicht-\nschule", "Lehre/\nFachschule", "Matura", "Hochschule")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:5, name = "Höchste abgeschlossene Ausbildung", labels = c("noch kein\nSchulabschluss", "Pflicht-\nschule", "Lehre/\nFachschule", "Matura", "Hochschule")) +
  labs(x = "Höchste abgeschlossene Ausbildung",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(p_bildungBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("\n")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("\n")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(4,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(p_bildungBoxplot$gleich_entf_fakt_lg) # gesamt

p_bildungBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_bildung, gleich_entf_fakt_lg) %>% group_by(p_bildung) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(p_bildungBoxplot$gleich_entf_fakt) # gesamt

p_bildungBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_bildung, gleich_entf_fakt_lg) %>% group_by(p_bildung) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Derzeitige Beschäftigung

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
p_beruf1 <- subset(Befragung, p_beruf==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_beruf2 <- subset(Befragung, p_beruf==2,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_beruf3 <- subset(Befragung, p_beruf==3,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_beruf4 <- subset(Befragung, p_beruf==4,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(2,2))
hist(p_beruf1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_beruf2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_beruf3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_beruf4$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$p_beruf)
```

3. Hypothesentests

```{r}
anova_p_beruf <- aov(gleich_entf_fakt_lg~p_beruf,data=Befragung)
summary(anova_p_beruf)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$p_beruf,p.adjust.method = "bonferroni") # bei Anova

par(mfrow=c(1,2))
hist(rstandard(anova_p_beruf),main=NULL)
plot(anova_p_beruf, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
p_berufBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "p_beruf", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,p_beruf)

# Labels erstellen
text_labels1 <- group_by(
  p_berufBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_beruf, gleich_entf_fakt_lg),
  p_beruf
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  p_berufBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(p_berufBoxplot,mapping = aes(
  x = as.numeric(p_beruf),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=p_beruf),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=p_beruf),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:4, name = "Derzeitige Beschäftigung", labels = c("In Ausbildung", "Erwerbstätig", "In Pension", "Andere Tätigkeit")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:4, name = "Derzeitige Beschäftigung", labels = c("In Ausbildung", "Erwerbstätig", "In Pension", "Andere Tätigkeit")) +
  labs(x = "Derzeitige Beschäftigung",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(p_berufBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("\n")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("\n")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(4,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(p_berufBoxplot$gleich_entf_fakt_lg) # gesamt

p_berufBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_beruf, gleich_entf_fakt_lg) %>% group_by(p_beruf) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(p_berufBoxplot$gleich_entf_fakt) # gesamt

p_berufBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_beruf, gleich_entf_fakt_lg) %>% group_by(p_beruf) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Führerscheinbesitz PKW

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
p_fs_B0 <- subset(Befragung, p_fs_B==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_fs_B1 <- subset(Befragung, p_fs_B==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(p_fs_B0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_fs_B1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$p_fs_B)
```

3. Hypothesentests

```{r}
anova_p_fs_B <- aov(gleich_entf_fakt_lg~p_fs_B,data=Befragung)
summary(anova_p_fs_B)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$p_fs_B,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_p_fs_B),main=NULL)
plot(anova_p_fs_B, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
p_fs_BBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "p_fs_B", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,p_fs_B)

# Labels erstellen
text_labels1 <- group_by(
  p_fs_BBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_fs_B, gleich_entf_fakt_lg),
  p_fs_B
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  p_fs_BBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(p_fs_BBoxplot,mapping = aes(
  x = as.numeric(p_fs_B),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=p_fs_B),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=p_fs_B),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Führerscheinbesitz PKW", labels = c("Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Führerscheinbesitz PKW", labels = c("Nein", "Ja")) +
  labs(x = "Führerscheinbesitz PKW",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(p_fs_BBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(p_fs_BBoxplot$gleich_entf_fakt_lg) # gesamt

p_fs_BBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_fs_B, gleich_entf_fakt_lg) %>% group_by(p_fs_B) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(p_fs_BBoxplot$gleich_entf_fakt) # gesamt

p_fs_BBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_fs_B, gleich_entf_fakt_lg) %>% group_by(p_fs_B) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Führerscheinbesitz Moped/Motorrad

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
p_fs_A0 <- subset(Befragung, p_fs_A==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_fs_A1 <- subset(Befragung, p_fs_A==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(p_fs_A0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_fs_A1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$p_fs_A)
```

3. Hypothesentests

```{r}
anova_p_fs_A <- aov(gleich_entf_fakt_lg~p_fs_A,data=Befragung)
summary(anova_p_fs_A)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$p_fs_A,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_p_fs_A),main=NULL)
plot(anova_p_fs_A, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
p_fs_ABoxplot <- subset(Befragung, select=c("gleich_entf_kat", "p_fs_A", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,p_fs_A)

# Labels erstellen
text_labels1 <- group_by(
  p_fs_ABoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_fs_A, gleich_entf_fakt_lg),
  p_fs_A
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  p_fs_ABoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(p_fs_ABoxplot,mapping = aes(
  x = as.numeric(p_fs_A),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=p_fs_A),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=p_fs_A),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Führerscheinbesitz Moped/Motorrad", labels = c("Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Führerscheinbesitz Moped/Motorrad", labels = c("Nein", "Ja")) +
  labs(x = "Führerscheinbesitz Moped/Motorrad",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(p_fs_ABoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(p_fs_ABoxplot$gleich_entf_fakt_lg) # gesamt

p_fs_ABoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_fs_A, gleich_entf_fakt_lg) %>% group_by(p_fs_A) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(p_fs_ABoxplot$gleich_entf_fakt) # gesamt

p_fs_ABoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_fs_A, gleich_entf_fakt_lg) %>% group_by(p_fs_A) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Führerscheinbesitz LKW

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
p_fs_C0 <- subset(Befragung, p_fs_C==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_fs_C1 <- subset(Befragung, p_fs_C==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(p_fs_C0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_fs_C1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$p_fs_C)
```

3. Hypothesentests

```{r}
t.test(gleich_entf_fakt_lg~p_fs_C,data=Befragung,var.equal=FALSE,alternative="two.sided")
```

4. Post-hoc-Tests

```{r}
games_howell_test(Befragung, gleich_entf_fakt_lg ~ p_fs_C, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
p_fs_CBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "p_fs_C", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,p_fs_C)

# Labels erstellen
text_labels1 <- group_by(
  p_fs_CBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_fs_C, gleich_entf_fakt_lg),
  p_fs_C
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  p_fs_CBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(p_fs_CBoxplot,mapping = aes(
  x = as.numeric(p_fs_C),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=p_fs_C),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=p_fs_C),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Führerscheinbesitz LKW", labels = c("Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Führerscheinbesitz LKW", labels = c("Nein", "Ja")) +
  labs(x = "Führerscheinbesitz LKW",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(p_fs_CBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

## Unabhängige Variable: Fahrzeugverfügbarkeit Fahrrad

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
p_fzg_rad0 <- subset(Befragung, p_fzg_rad==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_fzg_rad1 <- subset(Befragung, p_fzg_rad==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(p_fzg_rad0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_fzg_rad1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$p_fzg_rad)
```

3. Hypothesentests

```{r}
anova_p_fzg_rad <- aov(gleich_entf_fakt_lg~p_fzg_rad,data=Befragung)
summary(anova_p_fzg_rad)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$p_fzg_rad,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_p_fzg_rad),main=NULL)
plot(anova_p_fzg_rad, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
p_fzg_radBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "p_fzg_rad", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,p_fzg_rad)

# Labels erstellen
text_labels1 <- group_by(
  p_fzg_radBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_fzg_rad, gleich_entf_fakt_lg),
  p_fzg_rad
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  p_fzg_radBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(p_fzg_radBoxplot,mapping = aes(
  x = as.numeric(p_fzg_rad),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=p_fzg_rad),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=p_fzg_rad),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Fahrzeugverfügbarkeit Fahrrad", labels = c("Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Fahrzeugverfügbarkeit Fahrrad", labels = c("Nein", "Ja")) +
  labs(x = "Fahrzeugverfügbarkeit Fahrrad",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(p_fzg_radBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(p_fzg_radBoxplot$gleich_entf_fakt_lg) # gesamt

p_fzg_radBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_fzg_rad, gleich_entf_fakt_lg) %>% group_by(p_fzg_rad) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(p_fzg_radBoxplot$gleich_entf_fakt) # gesamt

p_fzg_radBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_fzg_rad, gleich_entf_fakt_lg) %>% group_by(p_fzg_rad) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Fahrzeugverfügbarkeit E-Bike

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
p_fzg_ebike0 <- subset(Befragung, p_fzg_ebike==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_fzg_ebike1 <- subset(Befragung, p_fzg_ebike==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(p_fzg_ebike0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_fzg_ebike1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$p_fzg_ebike)
```

3. Hypothesentests

```{r}
anova_p_fzg_ebike <- aov(gleich_entf_fakt_lg~p_fzg_ebike,data=Befragung)
summary(anova_p_fzg_ebike)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$p_fzg_ebike,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_p_fzg_ebike),main=NULL)
plot(anova_p_fzg_ebike, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
p_fzg_ebikeBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "p_fzg_ebike", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,p_fzg_ebike)

# Labels erstellen
text_labels1 <- group_by(
  p_fzg_ebikeBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_fzg_ebike, gleich_entf_fakt_lg),
  p_fzg_ebike
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  p_fzg_ebikeBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(p_fzg_ebikeBoxplot,mapping = aes(
  x = as.numeric(p_fzg_ebike),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=p_fzg_ebike),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=p_fzg_ebike),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Fahrzeugverfügbarkeit E-Bike", labels = c("Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Fahrzeugverfügbarkeit E-Bike", labels = c("Nein", "Ja")) +
  labs(x = "Fahrzeugverfügbarkeit E-Bike",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(p_fzg_ebikeBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(p_fzg_ebikeBoxplot$gleich_entf_fakt_lg) # gesamt

p_fzg_ebikeBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_fzg_ebike, gleich_entf_fakt_lg) %>% group_by(p_fzg_ebike) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(p_fzg_ebikeBoxplot$gleich_entf_fakt) # gesamt

p_fzg_ebikeBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_fzg_ebike, gleich_entf_fakt_lg) %>% group_by(p_fzg_ebike) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Fahrzeugverfügbarkeit Moped/Motorrad

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
p_fzg_mrad0 <- subset(Befragung, p_fzg_mrad==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_fzg_mrad1 <- subset(Befragung, p_fzg_mrad==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(p_fzg_mrad0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_fzg_mrad1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$p_fzg_mrad)
```

3. Hypothesentests

```{r}
anova_p_fzg_mrad <- aov(gleich_entf_fakt_lg~p_fzg_mrad,data=Befragung)
summary(anova_p_fzg_mrad)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$p_fzg_mrad,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_p_fzg_mrad),main=NULL)
plot(anova_p_fzg_mrad, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
p_fzg_mradBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "p_fzg_mrad", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,p_fzg_mrad)

# Labels erstellen
text_labels1 <- group_by(
  p_fzg_mradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_fzg_mrad, gleich_entf_fakt_lg),
  p_fzg_mrad
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  p_fzg_mradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(p_fzg_mradBoxplot,mapping = aes(
  x = as.numeric(p_fzg_mrad),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=p_fzg_mrad),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=p_fzg_mrad),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Fahrzeugverfügbarkeit Moped/Motorrad", labels = c("Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Fahrzeugverfügbarkeit Moped/Motorrad", labels = c("Nein", "Ja")) +
  labs(x = "Fahrzeugverfügbarkeit Moped/Motorrad",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(p_fzg_mradBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(p_fzg_mradBoxplot$gleich_entf_fakt_lg) # gesamt

p_fzg_mradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_fzg_mrad, gleich_entf_fakt_lg) %>% group_by(p_fzg_mrad) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(p_fzg_mradBoxplot$gleich_entf_fakt) # gesamt

p_fzg_mradBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_fzg_mrad, gleich_entf_fakt_lg) %>% group_by(p_fzg_mrad) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Fahrzeugverfügbarkeit PKW

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
p_fzg_pkw0 <- subset(Befragung, p_fzg_pkw==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_fzg_pkw1 <- subset(Befragung, p_fzg_pkw==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_fzg_pkw2 <- subset(Befragung, p_fzg_pkw==2,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,3))
hist(p_fzg_pkw0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_fzg_pkw1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_fzg_pkw2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$p_fzg_pkw)
```

3. Hypothesentests

```{r}
anova_p_fzg_pkw <- aov(gleich_entf_fakt_lg~p_fzg_pkw,data=Befragung)
summary(anova_p_fzg_pkw)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$p_fzg_pkw,p.adjust.method = "bonferroni") # bei Anova

par(mfrow=c(1,2))
hist(rstandard(anova_p_fzg_pkw),main=NULL)
plot(anova_p_fzg_pkw, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
p_fzg_pkwBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "p_fzg_pkw", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,p_fzg_pkw)

# Labels erstellen
text_labels1 <- group_by(
  p_fzg_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_fzg_pkw, gleich_entf_fakt_lg),
  p_fzg_pkw
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  p_fzg_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(p_fzg_pkwBoxplot,mapping = aes(
  x = as.numeric(p_fzg_pkw),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=p_fzg_pkw),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=p_fzg_pkw),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:3, name = "Fahrzeugverfügbarkeit PKW", labels = c("Nie", "Gelegentlich", "Immer")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:3, name = "Fahrzeugverfügbarkeit PKW", labels = c("Nie", "Gelegentlich", "Immer")) +
  labs(x = "Fahrzeugverfügbarkeit PKW",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(p_fzg_pkwBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(p_fzg_pkwBoxplot$gleich_entf_fakt_lg) # gesamt

p_fzg_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_fzg_pkw, gleich_entf_fakt_lg) %>% group_by(p_fzg_pkw) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(p_fzg_pkwBoxplot$gleich_entf_fakt) # gesamt

p_fzg_pkwBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_fzg_pkw, gleich_entf_fakt_lg) %>% group_by(p_fzg_pkw) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: ÖV-Zeitkarten (Wochen-/Monats-/Jahreskarte/Top-Jugendticket/Jugendticket, etc.)

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
p_zeitkarte0 <- subset(Befragung, p_zeitkarte==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_zeitkarte1 <- subset(Befragung, p_zeitkarte==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(p_zeitkarte0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_zeitkarte1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$p_zeitkarte)
```

3. Hypothesentests

```{r}
anova_p_zeitkarte <- aov(gleich_entf_fakt_lg~p_zeitkarte,data=Befragung)
summary(anova_p_zeitkarte)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$p_zeitkarte,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_p_zeitkarte),main=NULL)
plot(anova_p_zeitkarte, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
p_zeitkarteBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "p_zeitkarte", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,p_zeitkarte)

# Labels erstellen
text_labels1 <- group_by(
  p_zeitkarteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_zeitkarte, gleich_entf_fakt_lg),
  p_zeitkarte
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  p_zeitkarteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(p_zeitkarteBoxplot,mapping = aes(
  x = as.numeric(p_zeitkarte),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=p_zeitkarte),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=p_zeitkarte),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "ÖV-Zeitkartenbesitz", labels = c("Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "ÖV-Zeitkartenbesitz", labels = c("Nein", "Ja")) +
  labs(x = "ÖV-Zeitkartenbesitz",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(p_zeitkarteBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(p_zeitkarteBoxplot$gleich_entf_fakt_lg) # gesamt

p_zeitkarteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_zeitkarte, gleich_entf_fakt_lg) %>% group_by(p_zeitkarte) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(p_zeitkarteBoxplot$gleich_entf_fakt) # gesamt

p_zeitkarteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_zeitkarte, gleich_entf_fakt_lg) %>% group_by(p_zeitkarte) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: ÖV-Ermäßigungskarte

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
p_ermkarte0 <- subset(Befragung, p_ermkarte==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_ermkarte1 <- subset(Befragung, p_ermkarte==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(p_ermkarte0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_ermkarte1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$p_ermkarte)
```

3. Hypothesentests

```{r}
anova_p_ermkarte <- aov(gleich_entf_fakt_lg~p_ermkarte,data=Befragung)
summary(anova_p_ermkarte)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$p_ermkarte,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_p_ermkarte),main=NULL)
plot(anova_p_ermkarte, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
p_ermkarteBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "p_ermkarte", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,p_ermkarte)

# Labels erstellen
text_labels1 <- group_by(
  p_ermkarteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_ermkarte, gleich_entf_fakt_lg),
  p_ermkarte
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  p_ermkarteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(p_ermkarteBoxplot,mapping = aes(
  x = as.numeric(p_ermkarte),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=p_ermkarte),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=p_ermkarte),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "ÖV-Ermäßigungskartenbesitz", labels = c("Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "ÖV-Ermäßigungskartenbesitz", labels = c("Nein", "Ja")) +
  labs(x = "ÖV-Ermäßigungskartenbesitz",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(p_ermkarteBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(p_ermkarteBoxplot$gleich_entf_fakt_lg) # gesamt

p_ermkarteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_ermkarte, gleich_entf_fakt_lg) %>% group_by(p_ermkarte) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(p_ermkarteBoxplot$gleich_entf_fakt) # gesamt

p_ermkarteBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_ermkarte, gleich_entf_fakt_lg) %>% group_by(p_ermkarte) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Verwendung von Navigationssystemen für ÖV und Zu- und Abgangswege

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
p_navi0 <- subset(Befragung, p_navi==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_navi1 <- subset(Befragung, p_navi==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_navi2 <- subset(Befragung, p_navi==2,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
p_navi3 <- subset(Befragung, p_navi==3,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(2,2))
hist(p_navi0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_navi1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_navi2$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(p_navi3$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$p_navi)
```

3. Hypothesentests

```{r}
anova_p_navi <- aov(gleich_entf_fakt_lg~p_navi,data=Befragung)
summary(anova_p_navi)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$p_navi,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_p_navi),main=NULL)
plot(anova_p_navi, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
p_naviBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "p_navi", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,p_navi)

# Labels erstellen
text_labels1 <- group_by(
  p_naviBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_navi, gleich_entf_fakt_lg),
  p_navi
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  p_naviBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(p_naviBoxplot,mapping = aes(
  x = as.numeric(p_navi),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=p_navi),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=p_navi),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:4, name = "Verwendung von Navigationssystemen", labels = c("Nein", "Ja, vorm Weg", "Ja, am Weg", "Ja, vorm Weg und\nnotfalls auch am Weg")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:4, name = "Verwendung von Navigationssystemen", labels = c("Nein", "Ja, vorm Weg", "Ja, am Weg", "Ja, vorm Weg und\nnotfalls auch am Weg")) +
  labs(x = "Verwendung von Navigationssystemen",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(p_naviBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c(" \n ")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c(" \n ")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(4,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(p_naviBoxplot$gleich_entf_fakt_lg) # gesamt

p_naviBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_navi, gleich_entf_fakt_lg) %>% group_by(p_navi) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(p_naviBoxplot$gleich_entf_fakt) # gesamt

p_naviBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, p_navi, gleich_entf_fakt_lg) %>% group_by(p_navi) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Citybus an nächster Haltestelle?

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
test_citybus0 <- subset(Befragung, test_citybus==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
test_citybus1 <- subset(Befragung, test_citybus==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(test_citybus0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(test_citybus1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$test_citybus)
```

3. Hypothesentests

```{r}
anova_test_citybus <- aov(gleich_entf_fakt_lg~test_citybus,data=Befragung)
summary(anova_test_citybus)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$test_citybus,p.adjust.method = "bonferroni")

par(mfrow=c(1,2))
hist(rstandard(anova_test_citybus),main=NULL)
plot(anova_test_citybus, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
test_citybusBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "test_citybus", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,test_citybus)

# Labels erstellen
text_labels1 <- group_by(
  test_citybusBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_citybus, gleich_entf_fakt_lg),
  test_citybus
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  test_citybusBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(test_citybusBoxplot,mapping = aes(
  x = as.numeric(test_citybus),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=test_citybus),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=test_citybus),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Citybushaltestelle", labels = c("Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Citybushaltestelle", labels = c("Nein", "Ja")) +
  labs(x = "Citybushaltestelle",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(test_citybusBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(test_citybusBoxplot$gleich_entf_fakt_lg) # gesamt

test_citybusBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_citybus, gleich_entf_fakt_lg) %>% group_by(test_citybus) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(test_citybusBoxplot$gleich_entf_fakt) # gesamt

test_citybusBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_citybus, gleich_entf_fakt_lg) %>% group_by(test_citybus) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Regionalbus an nächster Haltestelle?

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
test_regbus0 <- subset(Befragung, test_regbus==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
test_regbus1 <- subset(Befragung, test_regbus==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(test_regbus0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(test_regbus1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$test_regbus)
```

3. Hypothesentests

```{r}
anova_test_regbus <- aov(gleich_entf_fakt_lg~test_regbus,data=Befragung)
summary(anova_test_regbus)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(Befragung$gleich_entf_fakt_lg, Befragung$test_regbus,p.adjust.method = "bonferroni") # bei Anova

par(mfrow=c(1,2))
hist(rstandard(anova_test_regbus),main=NULL)
plot(anova_test_regbus, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
test_regbusBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "test_regbus", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,test_regbus)

# Labels erstellen
text_labels1 <- group_by(
  test_regbusBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_regbus, gleich_entf_fakt_lg),
  test_regbus
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  test_regbusBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(test_regbusBoxplot,mapping = aes(
  x = as.numeric(test_regbus),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=test_regbus),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=test_regbus),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Regionalbushaltestelle", labels = c("Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Regionalbushaltestelle", labels = c("Nein", "Ja")) +
  labs(x = "Regionalbushaltestelle",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(test_regbusBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(test_regbusBoxplot$gleich_entf_fakt_lg) # gesamt

test_regbusBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_regbus, gleich_entf_fakt_lg) %>% group_by(test_regbus) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(test_regbusBoxplot$gleich_entf_fakt) # gesamt

test_regbusBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_regbus, gleich_entf_fakt_lg) %>% group_by(test_regbus) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Bus (City-/Regionalbus) an nächster Haltestelle?

Die Variable "test_bus" wird eingeführt, da bei ÖU 2013/2014 auch nicht nach City- und Regionalbus unterschieden wurde. Danach werden die Variablen "test_regbus" und "test_citybus" zur Variable "test_bus" kombiniert. 

```{r, results='hide'}
test_busBoxplot <- mutate(Befragung, test_bus = ifelse(Befragung$test_citybus == 0 & Befragung$test_regbus == 0, 0, 1))
```

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
test_bus0 <- subset(test_busBoxplot, test_bus==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
test_bus1 <- subset(test_busBoxplot, test_bus==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(test_bus0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(test_bus1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(test_busBoxplot$gleich_entf_fakt_lg, test_busBoxplot$test_bus)
```

3. Hypothesentests

```{r}
anova_test_bus <- aov(gleich_entf_fakt_lg~test_bus,data=test_busBoxplot)
summary(anova_test_bus)
```

4. Post-hoc-Tests

```{r}
pairwise.t.test(test_busBoxplot$gleich_entf_fakt_lg, test_busBoxplot$test_bus,p.adjust.method = "bonferroni") # bei Anova

par(mfrow=c(1,2))
hist(rstandard(anova_test_bus),main=NULL)
plot(anova_test_bus, 2)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
test_busBoxplot <- subset(test_busBoxplot, select=c("gleich_entf_kat", "test_bus", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,test_bus)

# Labels erstellen
text_labels1 <- group_by(
  test_busBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_bus, gleich_entf_fakt_lg),
  test_bus
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  test_busBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(test_busBoxplot,mapping = aes(
  x = as.numeric(test_bus),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=test_bus),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=test_bus),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 0:1, name = "Bushaltestelle", labels = c("Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 0:1, name = "Bushaltestelle", labels = c("Nein", "Ja")) +
  labs(x = "Bushaltestelle",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(test_busBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(test_busBoxplot$gleich_entf_fakt_lg) # gesamt

test_busBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_bus, gleich_entf_fakt_lg) %>% group_by(test_bus) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(test_busBoxplot$gleich_entf_fakt) # gesamt

test_busBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_bus, gleich_entf_fakt_lg) %>% group_by(test_bus) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Badner Bahn (WLB) an nächster Haltestelle?

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
test_wlb0 <- subset(Befragung, test_wlb==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
test_wlb1 <- subset(Befragung, test_wlb==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(test_wlb0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(test_wlb1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$test_wlb)
```

3. Hypothesentests

```{r}
t.test(gleich_entf_fakt_lg~test_wlb,data=Befragung,var.equal=FALSE,alternative="two.sided")
```

4. Post-hoc-Tests

```{r}
games_howell_test(Befragung, gleich_entf_fakt_lg ~ test_wlb, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
test_wlbBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "test_wlb", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,test_wlb)

# Labels erstellen
text_labels1 <- group_by(
  test_wlbBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_wlb, gleich_entf_fakt_lg),
  test_wlb
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  test_wlbBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(test_wlbBoxplot,mapping = aes(
  x = as.numeric(test_wlb),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=test_wlb),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=test_wlb),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "WLB-Haltestelle", labels = c("Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "WLB-Haltestelle", labels = c("Nein", "Ja")) +
  labs(x = "WLB-Haltestelle",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(test_wlbBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(test_wlbBoxplot$gleich_entf_fakt_lg) # gesamt

test_wlbBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_wlb, gleich_entf_fakt_lg) %>% group_by(test_wlb) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(test_wlbBoxplot$gleich_entf_fakt) # gesamt

test_wlbBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_wlb, gleich_entf_fakt_lg) %>% group_by(test_wlb) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

## Unabhängige Variable: Bahn (ÖBB) an nächster Haltestelle?

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
test_zug0 <- subset(Befragung, test_zug==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
test_zug1 <- subset(Befragung, test_zug==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(test_zug0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(test_zug1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$test_zug)
```

3. Hypothesentests

```{r}
t.test(gleich_entf_fakt_lg~test_zug,data=Befragung,var.equal=FALSE,alternative="two.sided")
```

4. Post-hoc-Tests

```{r}
games_howell_test(Befragung, gleich_entf_fakt_lg ~ test_zug, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
test_zugBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "test_zug", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,test_zug)

# Labels erstellen
text_labels1 <- group_by(
  test_zugBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_zug, gleich_entf_fakt_lg),
  test_zug
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  test_zugBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(test_zugBoxplot,mapping = aes(
  x = as.numeric(test_zug),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=test_zug),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=test_zug),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 1:2, name = "Bahnhaltestelle", labels = c("Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1:2, name = "Bahnhaltestelle", labels = c("Nein", "Ja")) +
  labs(x = "Bahnhaltestelle",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(test_zugBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(test_zugBoxplot$gleich_entf_fakt_lg) # gesamt

test_zugBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_zug, gleich_entf_fakt_lg) %>% group_by(test_zug) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(test_zugBoxplot$gleich_entf_fakt) # gesamt

test_zugBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_zug, gleich_entf_fakt_lg) %>% group_by(test_zug) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```

# Idente nächste Haltestelle?

Zunächst wird eine neue Variable eingeführt, bei der getestet wird, ob der angegebene Haltestellenname der nächstgelegenen Haltestelle mit der ermittelten Haltestelle übereinstimmt. 
- 0 ... Nein, die Haltestellennamen stimmen nicht überein
- 1 ... Ja, die Haltestellennamen sind ident

```{r}
Befragung <- mutate(Befragung, test_hst_nxste_gleich = ifelse(Befragung$test_nxste_name == Befragung$nxste_name, 1, 0))
```

## Unabhängige Variable: Idente nächste Haltestelle?

### Hypothesentest

1. Bilden von Subsets und Histogrammen für jede Gruppe, um auf Normalverteilung zu prüfen

```{r}
test_hst_nxste_gleich0 <- subset(Befragung, test_hst_nxste_gleich==0,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)
test_hst_nxste_gleich1 <- subset(Befragung, test_hst_nxste_gleich==1,select = c(ID,gleich_entf_fakt_lg)) %>% drop_na(gleich_entf_fakt_lg)

par(mfrow=c(1,2))
hist(test_hst_nxste_gleich0$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
hist(test_hst_nxste_gleich1$gleich_entf_fakt_lg,xlim=range(breaks = seq(-2, 2, by = 0.2)),main = NULL)
```

2. Testen der Varianzhomogenität

```{r}
leveneTest(Befragung$gleich_entf_fakt_lg, Befragung$test_hst_nxste_gleich)
```

3. Hypothesentests

```{r}
t.test(gleich_entf_fakt_lg~test_hst_nxste_gleich,data=Befragung,var.equal=FALSE,alternative="two.sided")
```

4. Post-hoc-Tests

```{r}
games_howell_test(Befragung, gleich_entf_fakt_lg ~ test_hst_nxste_gleich, conf.level = 0.95, detailed = FALSE)
```

### Graphische Darstellung

```{r}
# Subset erzeugen
test_hst_nxste_gleichBoxplot <- subset(Befragung, select=c("gleich_entf_kat", "test_hst_nxste_gleich", "gleich_entf_fakt","gleich_entf_fakt_lg","test_nxste_zeit","nxste_zeit")) %>% drop_na(gleich_entf_kat,gleich_entf_fakt,test_hst_nxste_gleich)

# Labels erstellen
text_labels1 <- group_by(
  test_hst_nxste_gleichBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_hst_nxste_gleich, gleich_entf_fakt_lg),
  test_hst_nxste_gleich
) %>% summarise(
  textlabel_top = paste("n = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

text_labels2 <- group_by(
  test_hst_nxste_gleichBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, gleich_entf_fakt_lg)
) %>% summarise(
  textlabel_top = paste("N = ", format(n(), big.mark = " ",justify = "left")),
  textlabel_mid = paste("µ[lg]"," == ", sprintf('%.2f',mean(gleich_entf_fakt_lg),justify = "left")),
  textlabel_bot = paste("µ = ", sprintf('%.2f',mean(gleich_entf_fakt),justify = "left")),
  y_top = 220,
  y_mid = 165,
  y_bot = 130
)

# plotten
plot1 <-  ggplot(test_hst_nxste_gleichBoxplot,mapping = aes(
  x = as.numeric(test_hst_nxste_gleich),
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels1,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_hline(yintercept = 1e+00,linetype="dotted")+
  geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6)+
  stat_boxplot(aes(group=test_hst_nxste_gleich),geom ='errorbar',width=0.25)+
  geom_boxplot(aes(group=test_hst_nxste_gleich),outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4"), labels = c("sehr schlecht", "schlecht", "mäßig", "gut", "sehr gut"),guide = guide_legend(shape = c(rep(16, 7), NA, NA))) +
  scale_x_continuous(breaks = 0:1, name = "Idente nächste Haltestelle", labels = c("Nein", "Ja")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 0:1, name = "Idente nächste Haltestelle", labels = c("Nein", "Ja")) +
  labs(x = "Idente nächste Haltestelle",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") + 
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
  
plot2 <-  ggplot(test_hst_nxste_gleichBoxplot,mapping = aes(
  x = 1,
  y = gleich_entf_fakt
)) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_top,color=NULL,
        y=y_top),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_mid,
        color=NULL,
        y=y_mid),show.legend = FALSE,size = 2.4, parse = TRUE
  ) +
  geom_text(
    data = text_labels2,
    aes(label = textlabel_bot,
        color=NULL,
        y=y_bot),show.legend = FALSE,size = 2.4, parse = FALSE
  ) +
 geom_hline(yintercept = 1e+00,linetype="dotted")+
      geom_jitter(position=position_jitter(0.25),aes(color = factor(gleich_entf_kat)), alpha=0.6,show.legend = FALSE)+
  stat_boxplot(geom ='errorbar',width=0.25)+
  geom_boxplot(outlier.color = "transparent",fill="transparent") +
  scale_color_manual(values = c("red4", "red3", "orange", "green3", "green4")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(trans='log10', limits = c(0.006,220), breaks =  y_scale_beschriftung, labels = as.character(y_scale_beschriftung))+
  scale_fill_manual(breaks = 1, name = "Gesamt", labels = c("")) +
  labs(x = " ",
       y = "Zu- bzw. Abgangszeit angegeben/ermittelt",
       color = "Übereinstimmung:") +
  theme_bw()

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

#### Berechnen des Medians

```{r}
# für gleich_entf_fakt_lg
median(test_hst_nxste_gleichBoxplot$gleich_entf_fakt_lg) # gesamt

test_hst_nxste_gleichBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_hst_nxste_gleich, gleich_entf_fakt_lg) %>% group_by(test_hst_nxste_gleich) %>% summarise_at(vars(gleich_entf_fakt_lg),list(name = median)) # nach Gruppe

# für gleich_entf_fakt
median(test_hst_nxste_gleichBoxplot$gleich_entf_fakt) # gesamt

test_hst_nxste_gleichBoxplot %>% drop_na(gleich_entf_kat, gleich_entf_fakt, test_hst_nxste_gleich, gleich_entf_fakt_lg) %>% group_by(test_hst_nxste_gleich) %>% summarise_at(vars(gleich_entf_fakt),list(name = median)) # nach Gruppe
```


## Idente nächste Haltestelle angegeben je nach Verkehrsmittelverfügbarkeit an ermittelter nächstgelegener Haltestelle

Zunächst werden Subsets für die einzelnen Haltestellenkategorien gebildet. Im Anschluss wird eine Häufigkeitstabelle pro Kategorie erzeugt. Alle Häufigkeitstabellen werden danach zu einer Tabelle zusammengefasst. 

```{r}
# Citybus
citybus_ident <- filter(Befragung, test_citybus == 1)
citybus_ident <- data.table(table(citybus_ident$test_hst_nxste_gleich, exclude = NULL))
colnames(citybus_ident) <- c("ident","Anzahl")
citybus_ident$Kategorie <- "Citybus"

# Regionalbus
regbus_ident <- filter(Befragung, test_regbus == 1)
regbus_ident <- data.table(table(regbus_ident$test_hst_nxste_gleich, exclude = NULL))
colnames(regbus_ident) <- c("ident","Anzahl")
regbus_ident$Kategorie <- "Regionalbus"

# WLB
wlb_ident <- filter(Befragung, test_wlb == 1)
wlb_ident <- data.table(table(wlb_ident$test_hst_nxste_gleich, exclude = NULL))
colnames(wlb_ident) <- c("ident","Anzahl")
wlb_ident$Kategorie <- "WLB"

# Zug (ÖBB)
zug_ident <- filter(Befragung, test_zug == 1)
zug_ident <- data.table(table(zug_ident$test_hst_nxste_gleich, exclude = NULL))
colnames(zug_ident) <- c("ident","Anzahl")
zug_ident$Kategorie <- "Zug (ÖBB)"

# Zusammenfügen zu einer Tabelle
idente_hst_VM <- bind_rows(citybus_ident, regbus_ident)
idente_hst_VM <- bind_rows(idente_hst_VM, wlb_ident)
idente_hst_VM <- bind_rows(idente_hst_VM, zug_ident)

# Spalte mit prozentuellem Anteil pro Gruppe erstellen
idente_hst_VM <- idente_hst_VM %>% group_by(Kategorie) %>% mutate(Anteil=prop.table(Anzahl))

# Plotten
plot1 <- ggplot(data = idente_hst_VM, aes(x = Kategorie, y = Anteil, fill = factor(ident), group = Kategorie))+
  geom_bar(stat = "identity")+
  scale_fill_manual(name = "Idente nächste Haltestelle angegeben wie ermittelt?", values = c("#f25f4a","#5ab576"), na.value = "#D9D9D9", labels = c("Nein", "Ja","Unzureichende Information"))+
  geom_text(aes(label = paste0(round(Anteil*100, digits = 2), "%")), position = position_stack(vjust = 0.5))+
  scale_y_continuous(labels = scales::percent)+
  labs(fill = "", x = "Verkehrsmittel an ermittelter nächster Haltestelle", y = "Anteil")+
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))

# Nicht nach Verkehrsmittel unterschieden
idente_hst <- data.table(table(Befragung$test_hst_nxste_gleich,exclude = NULL))
colnames(idente_hst) <- c("ident","Anzahl")
idente_hst <- idente_hst %>% mutate(Anteil=prop.table(Anzahl))

plot2 <- ggplot(data = idente_hst, aes(x = 1, y = Anteil, fill = factor(ident), group = ident))+
  geom_bar(stat = "identity")+
  scale_fill_manual(name = "", values = c("#f25f4a","#5ab576"), na.value = "#D9D9D9", labels = c("Nein", "Ja","Unzureichende Information"))+
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  geom_text(aes(label = paste0(round(Anteil*100, digits = 2), "%")), position = position_stack(vjust = 0.5))+
  scale_y_continuous(labels = scales::percent)+
  labs(x = "", y = "Anteil")+
  theme_bw()+
  theme(legend.position = "none")

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(3.25,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

# "Klassische" Auswertung

# Bevölkerungsverteilungen

Es wird die Bevölkerungsstatistik vom 1.1.2020 nach Politischen Bezirken, Alter und Geschlecht der Statistik Austria herangezogen (www.statistik.at/web_de/statistiken/menschen_und_gesellschaft/bevoelkerung/bevoelkerungsstruktur/bevoelkerung_nach_alter_geschlecht/index.html) und es werden 5-Jahresklassen gebildet.

```{r}
Bev_BN_5Jahre <- read.csv('bevoelkerung_am_1.1.2020_nach_politischen_bezirken_alter_und_geschlecht.csv', header = TRUE, sep = ";")
str(Bev_BN_5Jahre)
Bev_BN_5Jahre$alter <- factor(Bev_BN_5Jahre$alter,levels = c("0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85+"), ordered = TRUE)
```

## Bevölkerungspyramide Bezirk Baden (Alter in 5-Jahresschritten)

```{r}
ggplot(data = Bev_BN_5Jahre, mapping = aes(x = alter, y = ifelse(geschlecht == "m", yes = -anzahl, no = anzahl), fill = geschlecht))+
  geom_bar(stat = "identity")+
  coord_flip()+
  scale_fill_manual(name = "Geschlecht", values = c("#a23232", "#588ebb"), labels = c("Weiblich", "Männlich"))+
  scale_y_continuous(labels = abs)+
  labs(x = "Alter", y = "Altersverteilung Bezirk Baden [Anzahl an Personen]")+
  theme_bw()+
  theme(legend.position = c(0.9,0.9),legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
```

## Alterspyramide Befragung

Zunächst werden die entsprechenden Alterskategorien gebildet.

```{r, results='hide'}
Befragung <- mutate(Befragung, p_alter_kat_5Jahre = cut(p_alter, breaks = c(0,4,9,14,19,24,29,34,39,44,49,54,59,64,69,74,79,84,150), labels = c("0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85+")), ordered = TRUE)
```

Nun wird die Alterspyramide erstellt.

```{r}
ggplot(data = Befragung, mapping = aes(x = as.factor(p_alter_kat_5Jahre), fill = p_geschlecht))+
  geom_bar(data = subset(Befragung, p_geschlecht == 1), fill = "#a23232", labels = "Weiblich")+
  geom_bar(data = subset(Befragung, p_geschlecht == 2), aes(y=..count..*(-1)), fill = "#588ebb", labels = "Männlich")+
  coord_flip()+
  scale_color_manual(breaks = c("Weiblich", "Männlich"), name = "")+
  scale_y_continuous(labels = abs, breaks = seq(-20,20,5))+
  labs(x = "Alter", y = "Altersverteilung Befragung [Anzahl an Personen]")+
  theme_bw()
```

## Subsets für Geschlechter

```{r}
# Subsets für Geschlechter
männlich <- filter(Befragung, p_geschlecht == 1) # männlich
weiblich <- filter(Befragung, p_geschlecht == 2) # weiblich
```

## Aufteilung auf die Befragungsstandorte nach Zu- oder Abgangsweg

```{r}
stand_zuab <- data.table(table(Befragung$stand, Befragung$zuab,exclude = NULL))
colnames(stand_zuab) <- c("Befragungsstandort","Kategorie","Anzahl")
stand_zuab <- mutate(stand_zuab, Befragungsstandort = ifelse(stand_zuab$Befragungsstandort == 1, "Bahnhof", ifelse(stand_zuab$Befragungsstandort == 2, "Josefsplatz WLB", "Josefsplatz Bus")))
stand_zuab$Befragungsstandort = factor(stand_zuab$Befragungsstandort, levels = c("Josefsplatz Bus", "Josefsplatz WLB", "Bahnhof"))

plot1 <- ggplot(data = stand_zuab, aes(x = Befragungsstandort, y = Anzahl, fill = factor(Kategorie)))+
  geom_bar(stat = "identity")+
  scale_fill_manual(values = c("#9ecae1", "#3182bd"), labels = c("Zugangsweg", "Abgangsweg","Unzureichende\nInformation"))+ 
  geom_text(aes(label = paste0(round(Anzahl/sum(Anzahl)*100, digits = 2), "%")), position = position_stack(vjust = 0.5))+
  labs(fill = "")+
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))


stand_zuab <- data.table(table(Befragung$zuab,exclude = NULL))
colnames(stand_zuab) <- c("Kategorie","Anzahl")

plot2 <- ggplot(data = stand_zuab, aes(x = 1, y = Anzahl, fill = factor(Kategorie)))+
  geom_bar(stat = "identity")+
  scale_fill_manual(values = c("#9ecae1", "#3182bd"), labels = c("Zugangsweg", "Abgangsweg","Unzureichende\nInformation"))+ 
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  geom_text(aes(label = paste0(round(Anzahl/sum(Anzahl)*100, digits = 2), "%")), position = position_stack(vjust = 0.5))+
  labs(x = "", y = "Anzahl")+
  theme_bw()+
  theme(legend.position = "none")

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2.75,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

## Wegzwecke (Ausgangszweck, Zielzweck, Gesamt (wie bei ÖU 2013/2014))

```{r}
zweck_ausg_ <- data.table(table(Befragung$zweck_ausg,exclude = NULL))
zweck_ausg_$Kategorie <- "Ausgangszweck"

zweck_ziel_ <- data.table(table(Befragung$zweck_ziel, exclude = NULL))
zweck_ziel_$Kategorie <- "Zielzweck"

zwecke <- bind_rows(zweck_ausg_, zweck_ziel_)
colnames(zwecke) <- c("Zweck","Anzahl","Kategorie")

# Spalte mit prozentuellem Anteil pro Gruppe erstellen
zwecke <- zwecke %>% group_by(Kategorie) %>% mutate(Anteil=prop.table(Anzahl))

# Plotten
plot1 <- ggplot(data = zwecke, aes(x = Kategorie, y = Anteil, fill = factor(Zweck), group = Kategorie))+
  geom_bar(stat = "identity", position = position_fill(reverse = TRUE))+
  scale_fill_manual(name = "", values = c("#953735","#E6B9B8","#E46C0A","#FCD5B5","#31859C","#B7DEE8","#77933C","#D7E4BD","#D9D9D9","grey"), na.value = "black", breaks = c(1,2,3,4,5,6,7,8,9,10,NA), labels = c("Arbeit", "Dienstweg", "Schule/Ausbildung", "Bring- und Holwege", "Einkaufen", "Erledigung", "Freizeit", "Besuch", "von zu/nach Hause","Anderer Zweck","NA"))+
  geom_text(aes(label = paste0(round(Anteil*100, digits = 2), "%")), position = position_stack(vjust = 0.5, reverse = TRUE))+
  scale_y_continuous(labels = scales::percent)+
  labs(fill = "", x = "", y = "Anteil")+
  theme_bw()+
  guides(fill=guide_legend(nrow = 2))+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))

# Gesamt (Angabe des Zielzweckes, bei Wohnen wird Ausgangszweck angegeben)
zwecke_gesamt <- select(Befragung, c("zweck_ausg", "zweck_ziel"))
zwecke_gesamt <- zwecke_gesamt %>% mutate(zweck_ges = case_when(zweck_ziel == 9 ~ zweck_ausg,
                                                                zweck_ziel != 9 ~ zweck_ziel))
zwecke_gesamt <- data.table(table(zwecke_gesamt$zweck_ges, exclude = FALSE))
zwecke_gesamt <- zwecke_gesamt %>% mutate(Anteil=prop.table(N))

plot2 <- ggplot(data = zwecke_gesamt, aes(x = 1, y = Anteil, fill = factor(V1), group = V1))+
  geom_bar(stat = "identity", position = position_fill(reverse = TRUE))+
  scale_fill_manual(name = "", values = c("#953735","#E6B9B8","#E46C0A","#FCD5B5","#31859C","#B7DEE8","#77933C","#D7E4BD","#D9D9D9","grey"), na.value = "black", breaks = c(1,2,3,4,5,6,7,8,9,10,NA), labels = c("Arbeit", "Dienstweg", "Schule/Ausbildung", "Bring- und Holwege", "Einkaufen", "Erledigung", "Freizeit", "Besuch", "von zu/nach Hause","Anderer Zweck","NA"))+
  geom_text(aes(label = paste0(round(Anteil*100, digits = 2), "%")), position = position_stack(vjust = 0.5, reverse = TRUE))+
  scale_x_continuous(breaks = 1, name = "Wegzweck", labels = c("")) +
  scale_y_continuous(labels = scales::percent)+
  labs(x = "", y = "Anteil")+
  theme_bw()+
  theme(legend.position = "none")
 
Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.3))
```

## Nutzung des ÖV-Angebots am Befragungsstandort, an der vermeintlich nächsten Haltestelle (inkl. Befragungsstandort) und an der nicht gewählten vermeintlich nächsten Haltestelle (exkl. Befragungsstandort) - jeweils nach Befragungsstandort

```{r}
# Bahnhof
hst_nutz_bhf <- filter(Befragung, stand == 1)
hst_nutz_bhf <- data.table(table(hst_nutz_bhf$hst_nutz,exclude = NULL))
hst_nutz_bhf$Kategorie <- "Bahnhof"

# WLB
hst_nutz_wlb <- filter(Befragung, stand == 2)
hst_nutz_wlb <- data.table(table(hst_nutz_wlb$hst_nutz,exclude = NULL))
hst_nutz_wlb$Kategorie <- "WLB"

# Bus
hst_nutz_bus <- filter(Befragung, stand == 3)
hst_nutz_bus <- data.table(table(hst_nutz_bus$hst_nutz,exclude = NULL))
hst_nutz_bus$Kategorie <- "Bus"

# Zusammenfügen zu einer Tabelle
hst_nutz_stand <- bind_rows(hst_nutz_bhf, hst_nutz_wlb)
hst_nutz_stand <- bind_rows(hst_nutz_stand, hst_nutz_bus)

# Spalte mit prozentuellem Anteil pro Gruppe erstellen
hst_nutz_stand <- hst_nutz_stand %>% group_by(Kategorie) %>% mutate(Anteil=prop.table(N))

# Reihenfolge festlegen
hst_nutz_stand$Kategorie = factor(hst_nutz_stand$Kategorie, levels = c("Bus", "WLB", "Bahnhof"))

# Plotten
plot1 <- ggplot(hst_nutz_stand, aes(x = Kategorie, y = Anteil, fill = factor(V1), group = Kategorie))+
  geom_bar(stat = "identity")+
  scale_fill_brewer(name = "Nutzung ÖV-Angebot in den letzten 7 Tagen", na.value = "#D9D9D9", breaks = c(0,1,2,3,NA), labels = c("Gar nicht", "1 Mal", "2-3 Mal", "4+ Tage", "NA"))+
  geom_text(aes(label = paste0(round(Anteil*100, digits = 2), "%")), position = position_stack(vjust = 0.5))+
  scale_y_continuous(labels = scales::percent)+
  labs(x = "\nAm Befragungsstandort", y = "Anteil")+
  theme_bw()+ 
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))

# Nutzung des ÖV-Angebots an der vermeintlich nächsten Haltestelle

# Bahnhof
nxste_nutz_bhf <- filter(Befragung, stand == 1)
nxste_nutz_bhf <- data.table(table(nxste_nutz_bhf$nxste_nutz,exclude = NULL))
nxste_nutz_bhf$Kategorie <- "Bahnhof"

# WLB
nxste_nutz_wlb <- filter(Befragung, stand == 2)
nxste_nutz_wlb <- data.table(table(nxste_nutz_wlb$nxste_nutz,exclude = NULL))
nxste_nutz_wlb$Kategorie <- "WLB"

# Bus
nxste_nutz_bus <- filter(Befragung, stand == 3)
nxste_nutz_bus <- data.table(table(nxste_nutz_bus$nxste_nutz,exclude = NULL))
nxste_nutz_bus$Kategorie <- "Bus"

# Zusammenfügen zu einer Tabelle
nxste_nutz_stand <- bind_rows(nxste_nutz_bhf, nxste_nutz_wlb)
nxste_nutz_stand <- bind_rows(nxste_nutz_stand, nxste_nutz_bus)

# Spalte mit prozentuellem Anteil pro Gruppe erstellen
nxste_nutz_stand <- nxste_nutz_stand %>% group_by(Kategorie) %>% mutate(Anteil=prop.table(N))

# Reihenfolge festlegen
nxste_nutz_stand$Kategorie = factor(nxste_nutz_stand$Kategorie, levels = c("Bus", "WLB", "Bahnhof"))

# Plotten
plot2 <- ggplot(nxste_nutz_stand, aes(x = Kategorie, y = Anteil, fill = factor(V1), group = Kategorie))+
  geom_bar(stat = "identity")+
  scale_fill_brewer(name = "Nutzung ÖV-Angebot in den letzten 7 Tagen", na.value = "#D9D9D9", breaks = c(0,1,2,3,NA), labels = c("Gar nicht", "1 Mal", "2-3 Mal", "4+ Tage", "NA"))+
  geom_text(aes(label = paste0(round(Anteil*100, digits = 2), "%")), position = position_stack(vjust = 0.5))+
  scale_y_continuous(labels = scales::percent)+
  labs(x = "An nächster Hst\n(inkl. Befragungsstandort)", y = "Anteil")+
  theme_bw()+ 
  theme(legend.position = "none")

# Nutzung des ÖV-Angebots an der vermeintlich nächsten Haltestelle (falls laut eigenen Angaben nicht die nächste Haltestelle gewählt wurde)

nxste_nutz_stand <- filter(Befragung, hst_nxste == 0)

# Bahnhof
nxste_nutz_bhf <- filter(nxste_nutz_stand, stand == 1)
nxste_nutz_bhf <- data.table(table(nxste_nutz_bhf$nxste_nutz,exclude = NULL))
nxste_nutz_bhf$Kategorie <- "Bahnhof"

# WLB
nxste_nutz_wlb <- filter(nxste_nutz_stand, stand == 2)
nxste_nutz_wlb <- data.table(table(nxste_nutz_wlb$nxste_nutz,exclude = NULL))
nxste_nutz_wlb$Kategorie <- "WLB"

# Bus
nxste_nutz_bus <- filter(nxste_nutz_stand, stand == 3)
nxste_nutz_bus <- data.table(table(nxste_nutz_bus$nxste_nutz,exclude = NULL))
nxste_nutz_bus$Kategorie <- "Bus"

# Zusammenfügen zu einer Tabelle
nxste_nutz_stand <- bind_rows(nxste_nutz_bhf, nxste_nutz_wlb)
nxste_nutz_stand <- bind_rows(nxste_nutz_stand, nxste_nutz_bus)

# Spalte mit prozentuellem Anteil pro Gruppe erstellen
nxste_nutz_stand <- nxste_nutz_stand %>% group_by(Kategorie) %>% mutate(Anteil=prop.table(N))

# Reihenfolge festlegen
nxste_nutz_stand$Kategorie = factor(nxste_nutz_stand$Kategorie, levels = c("Bus", "WLB", "Bahnhof"))

# Plotten
plot3 <- ggplot(nxste_nutz_stand, aes(x = Kategorie, y = Anteil, fill = factor(V1), group = Kategorie))+
  geom_bar(stat = "identity")+
  scale_fill_brewer(name = "Nutzung ÖV-Angebot in den letzten 7 Tagen", na.value = "#D9D9D9", breaks = c(0,1,2,3,NA), labels = c("Gar nicht", "1 Mal", "2-3 Mal", "4+ Tage", "NA"))+
  geom_text(data = subset(nxste_nutz_stand, Anteil != 0), aes(label = paste0(round(Anteil*100, digits = 2), "%")), position = position_stack(vjust = 0.5))+
  scale_y_continuous(labels = scales::percent)+
  labs(x = "An nächster Hst \n(exkl. Befragungsstandort)", y = "Anteil")+
  theme_bw()+ 
  theme(legend.position = "none")

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, plot3, Legende,nrow=2 ,widths=c(1.25,1.25,1.25), layout_matrix = rbind(c(1,2,3), c(4,4,4)),heights = c(2.5, 0.5))
```

## Verfügbare Verkehrsmittel an nächster Haltestelle laut Befragung vs. laut Ermittlung

```{r}
# Nächstes Verkehrsmittel laut Befragung
# Citybus
citybus <- data.table(table(Befragung$nxste_vm_citybus,exclude = NULL))
citybus$Kategorie <- "Citybus"

# Regionalbus
regbus <- data.table(table(Befragung$nxste_vm_regbus,exclude = NULL))
regbus$Kategorie <- "Regionalbus"

# WLB
wlb <- data.table(table(Befragung$nxste_vm_wlb,exclude = NULL))
wlb$Kategorie <- "WLB"

# Zug (ÖBB)
zug <- data.table(table(Befragung$nxste_vm_zug,exclude = NULL))
zug$Kategorie <- "Zug"

# Zusammenfügen zu einer Tabelle
nxstes_vm <- bind_rows(citybus, regbus)
nxstes_vm <- bind_rows(nxstes_vm, wlb)
nxstes_vm <- bind_rows(nxstes_vm, zug)

# Spalte mit prozentuellem Anteil pro Gruppe erstellen (wegen Mehrfachantwortungen)
nxstes_vm <- nxstes_vm %>% group_by(Kategorie) %>% mutate(Anteil=prop.table(N))

# Plotten
plot1 <- ggplot(nxstes_vm, aes(x = Kategorie, y = N, fill = factor(V1)))+
  geom_bar(stat = "identity")+
  scale_fill_manual(name = "Verfügbar", values = c("#f25f4a","#5ab576","#D9D9D9"), na.value = "black", breaks = c(0,1,2,NA), labels = c("Nein", "Ja", "Weiß nicht", "NA"))+
  geom_text(aes(label = scales::percent(Anteil, accuracy = 0.01L)), position=position_stack(vjust = 0.5))+
  labs(x = "Nächstes Verkehrsmittel (laut Befragung)", y = "Anzahl")+
  theme_bw()+ 
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))

# Nächstes Verkehrsmittel laut Ermittlung
# Citybus
citybus <- data.table(table(Befragung$test_citybus,exclude = NULL))
citybus$Kategorie <- "Citybus"

# Regionalbus
regbus <- data.table(table(Befragung$test_regbus,exclude = NULL))
regbus$Kategorie <- "Regionalbus"

# WLB
wlb <- data.table(table(Befragung$test_wlb,exclude = NULL))
wlb$Kategorie <- "WLB"

# Zug (ÖBB)
zug <- data.table(table(Befragung$test_zug,exclude = NULL))
zug$Kategorie <- "Zug"

# Zusammenfügen zu einer Tabelle
nxstes_vm <- bind_rows(citybus, regbus)
nxstes_vm <- bind_rows(nxstes_vm, wlb)
nxstes_vm <- bind_rows(nxstes_vm, zug)

# Spalte mit prozentuellem Anteil pro Gruppe erstellen
nxstes_vm <- nxstes_vm %>% group_by(Kategorie) %>% mutate(Anteil=prop.table(N))

# Plotten
plot2 <- ggplot(nxstes_vm, aes(x = Kategorie, y = N, fill = factor(V1)))+
  geom_bar(stat = "identity")+
  scale_fill_manual(name = "Verfügbar", values = c("#f25f4a","#5ab576","#D9D9D9"), na.value = "black", breaks = c(0,1,2,NA), labels = c("Nein", "Ja", "Weiß nicht", "NA"))+
  geom_text(aes(label = scales::percent(Anteil, accuracy = 0.01L)), position=position_stack(vjust = 0.5))+
  labs(x = "Nächstes Verkehrsmittel (laut Ermittlung)", y = "Anzahl")+
  theme_bw()+
  theme(legend.position = "none")

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,2), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.5))
```

## Verfügbare Verkehrsmittel an Haltestelle laut Befragung vs. laut Ermittlung (Einfach-Mehrfachhaltestellen)

```{r}
# Am Befragungsstandort
Befragung <- Befragung %>% mutate(vm_stand = case_when(stand == 2 | stand == 3 ~ "Bus & WLB",
                                                       stand == 1 ~ "Bus, WLB & Bahn"))

vm_stand <- data.table(table(Befragung$vm_stand))
vm_stand$Kategorie <- "Befragungsstandort"


# An nächster Haltestelle (inklusive Befragungsstandort)
Befragung <- Befragung %>% mutate(vm_nxste_inkl_stand = case_when(nxste_vm_citybus == 2 | nxste_vm_regbus == 2 | nxste_vm_wlb == 2 | nxste_vm_zug == 2 ~ "unbekannt",
                                                                  (nxste_vm_citybus == 1 | nxste_vm_regbus == 1) & nxste_vm_wlb == 0 & nxste_vm_zug == 0 ~ "nur Bus",
                                                                  (nxste_vm_citybus == 1 | nxste_vm_regbus == 1) & nxste_vm_wlb == 1 & nxste_vm_zug == 0 ~ "Bus & WLB",
                                                                  (nxste_vm_citybus == 1 | nxste_vm_regbus == 1) & nxste_vm_wlb == 1 & nxste_vm_zug == 1 ~ "Bus, WLB & Bahn"))

vm_nxste_inkl_stand <- data.table(table(Befragung$vm_nxste_inkl_stand))
vm_nxste_inkl_stand$Kategorie <- "Nächste Hst (inkl.\nBefragungsstandort)"


# An nächster Haltestelle (exklusive Befragungsstandort)
Befragung <- Befragung %>% mutate(vm_nxste_exkl_stand = case_when(hst_nxste == 0 & (nxste_vm_citybus == 2 | nxste_vm_regbus == 2 | nxste_vm_wlb == 2 | nxste_vm_zug == 2) ~ "unbekannt",
                                                                  hst_nxste == 0 & (nxste_vm_citybus == 1 | nxste_vm_regbus == 1) & nxste_vm_wlb == 0 & nxste_vm_zug == 0 ~ "nur Bus",
                                                                  hst_nxste == 0 & (nxste_vm_citybus == 1 | nxste_vm_regbus == 1) & nxste_vm_wlb == 1 & nxste_vm_zug == 0 ~ "Bus & WLB",
                                                                  hst_nxste == 0 & (nxste_vm_citybus == 1 | nxste_vm_regbus == 1) & nxste_vm_wlb == 1 & nxste_vm_zug == 1 ~ "Bus, WLB & Bahn"))

vm_nxste_exkl_stand <- data.table(table(Befragung$vm_nxste_exkl_stand))
vm_nxste_exkl_stand$Kategorie <- "Nächste Hst (exkl.\nBefragungsstandort)"


# An ermittelter Haltestelle
Befragung <- Befragung %>% mutate(vm_nxste_test = case_when((test_citybus == 1 | test_regbus == 1) & test_wlb == 0 & test_zug == 0 ~ "nur Bus",
                                                                  (test_citybus == 1 | test_regbus == 1) & test_wlb == 1 & test_zug == 0 ~ "Bus & WLB",
                                                                  (test_citybus == 1 | test_regbus == 1) & test_wlb == 1 & test_zug == 1 ~ "Bus, WLB & Bahn"))

vm_nxste_test <- data.table(table(Befragung$vm_nxste_test))
vm_nxste_test$Kategorie <- "Nächste Hst\n(ermittelt)"

# Zusammenfügen zu einer Tabelle
vm_nxste_hst <- bind_rows(vm_stand, vm_nxste_inkl_stand)
vm_nxste_hst <- bind_rows(vm_nxste_hst, vm_nxste_exkl_stand)
vm_nxste_hst <- bind_rows(vm_nxste_hst, vm_nxste_test)

# Spalte mit prozentuellem Anteil pro Gruppe erstellen
vm_nxste_hst <- vm_nxste_hst %>% group_by(Kategorie) %>% mutate(Anteil=prop.table(N))

# Plotten
ggplot(data = vm_nxste_hst, aes(x = Kategorie, y = Anteil, fill = factor(V1, levels = c("unbekannt", "nur Bus", "Bus & WLB", "Bus, WLB & Bahn"))))+
  geom_bar(stat = "identity")+
  scale_fill_brewer(name = "ÖV-Angebot")+
  geom_text(aes(label = paste0(round(Anteil*100, digits = 2), "%")), position = position_stack(vjust = 0.5))+
  labs(x = "Bezugspunkt", y = "Anteil")+
  scale_y_continuous(labels = scales::percent)+
  theme_bw()+
  theme(legend.position = "right",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
```

## Attraktivität des Zu-/Abgangsweges nach Befragungsstandort

Attraktivität des Zugangsweges zum bzw. des Abgangweges vom Befragunggstandort. 

```{r}
# Bahnhof
bhf_zu <- filter(Befragung, stand == 1 & zuab == 1)
bhf_zu <- data.table(table(bhf_zu$weg_attrak),exclude = NULL)
colnames(bhf_zu) <- c("Attraktivität","Anzahl")
bhf_zu$zuab <- "Zugangsweg"

bhf_ab <- filter(Befragung, stand == 1 & zuab == 2)
bhf_ab <- data.table(table(bhf_ab$weg_attrak),exclude = NULL)
colnames(bhf_ab) <- c("Attraktivität","Anzahl")
bhf_ab$zuab <- "Abgangsweg"

bhf <- bind_rows(bhf_zu, bhf_ab)
bhf$Kategorie <- "Bhf"

# Josefsplatz WLB
wlb_zu <- filter(Befragung, stand == 2 & zuab == 1)
wlb_zu <- data.table(table(wlb_zu$weg_attrak),exclude = NULL)
colnames(wlb_zu) <- c("Attraktivität","Anzahl")
wlb_zu$zuab <- "Zugangsweg"

wlb_ab <- filter(Befragung, stand == 2 & zuab == 2)
wlb_ab <- data.table(table(wlb_ab$weg_attrak),exclude = NULL)
colnames(wlb_ab) <- c("Attraktivität","Anzahl")
wlb_ab$zuab <- "Abgangsweg"

wlb <- bind_rows(wlb_zu, wlb_ab)
wlb$Kategorie <- " WLB"

# Josefsplatz Bus
bus_zu <- filter(Befragung, stand == 3 & zuab == 1)
bus_zu <- data.table(table(bus_zu$weg_attrak),exclude = NULL)
colnames(bus_zu) <- c("Attraktivität","Anzahl")
bus_zu$zuab <- "Zugangsweg"

bus_ab <- filter(Befragung, stand == 3 & zuab == 2)
bus_ab <- data.table(table(bus_ab$weg_attrak),exclude = NULL)
colnames(bus_ab) <- c("Attraktivität","Anzahl")
bus_ab$zuab <- "Abgangsweg"

bus <- bind_rows(bus_zu, bus_ab)
bus$Kategorie <- " Bus"

# Zusammenfügen zu einer Tabelle
Attraktivität <- bind_rows(bus, wlb)
Attraktivität <- bind_rows(Attraktivität, bhf)

# Spalte mit prozentuellem Anteil pro Gruppe erstellen
Attraktivität <- Attraktivität %>% group_by(Kategorie,zuab) %>% mutate(Anteil=prop.table(Anzahl))

# Plotten
plot1 <- ggplot(subset(Attraktivität, zuab == "Zugangsweg" & Anteil != 0), aes(x = Kategorie, y = Anteil, fill = factor(Attraktivität), group = Kategorie))+
  geom_bar(stat = "identity")+
  scale_fill_manual(name = "", values = c("#f25f4a","#f5c0bd","#ffeda0","#a1d99b","#5ab576"), labels = c("Sehr unattraktiv", "Eher unattraktiv", "Neutral", "Eher attraktiv", "Sehr attraktiv")) +
  geom_text(aes(label = paste0(round(Anteil*100, digits = 2), "%")), position = position_stack(vjust = 0.5))+
  labs(fill = "", x = "Zugangsweg zu der/dem", y = "Anteil")+
  scale_y_continuous(labels = scales::percent)+
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))

plot2 <- ggplot(subset(Attraktivität, zuab == "Abgangsweg" & Anteil != 0), aes(x = Kategorie, y = Anteil, fill = factor(Attraktivität), group = Kategorie))+
  geom_bar(stat = "identity", position = "fill")+
  scale_fill_manual(name = "", values = c("#f25f4a","#f5c0bd","#ffeda0","#a1d99b","#5ab576"), labels = c("Sehr unattraktiv", "Eher unattraktiv", "Neutral", "Eher attraktiv", "Sehr attraktiv"))+
  geom_text(aes(label = paste0(round(Anteil*100, digits = 2), "%")), position = position_stack(vjust = 0.5))+
  labs(fill = "", x = "Abgangsweg von der/dem", y = "Anteil")+
  scale_y_continuous(labels = scales::percent)+
  theme_bw()+
  theme(legend.position = "none")

# Nicht nach Befragungsstandort und Zu-/Abgangsweg unterschieden
Attraktivität <- data.table(table(Befragung$weg_attrak))
colnames(Attraktivität) <- c("Attraktivität","Anzahl")
Attraktivität <- Attraktivität %>% mutate(Anteil=prop.table(Anzahl))

plot3 <- ggplot(data = Attraktivität, aes(x = 1, y = Anteil, fill = factor(Attraktivität)))+
  geom_bar(stat = "identity")+
  scale_fill_manual(name = "", values = c("#f25f4a","#f5c0bd","#ffeda0","#a1d99b","#5ab576"), labels = c("Sehr unattraktiv", "Eher unattraktiv", "Neutral", "Eher attraktiv", "Sehr attraktiv")) +
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(labels = scales::percent)+
  geom_text(aes(label = paste0(round(Anteil*100, digits = 2), "%")), position = position_stack(vjust = 0.5))+
  labs(x = "", y = "Anteil")+
  theme_bw()+
  theme(legend.position = "none")

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, plot3, Legende, ncol=3, nrow=2, widths=c(2,2,1), layout_matrix = rbind(c(1,2,3), c(4,4,4)), heights = c(2.5, 0.2))
```

## Gründe für die Nichtnutzung der nächsten Haltestelle

Mehrfachnennungen waren möglich.

```{r}
nxste_nicht <- subset(Befragung, hst_nxste == 0)

nxste_nicht1 <- data.frame(table(nxste_nicht$nxste_nicht1))
colnames(nxste_nicht1) <- c("Grund","Anzahl1")

nxste_nicht2 <- data.frame(table(nxste_nicht$nxste_nicht2))
colnames(nxste_nicht2) <- c("Grund","Anzahl2")

nxste_nicht3 <- data.frame(table(nxste_nicht$nxste_nicht3))
colnames(nxste_nicht3) <- c("Grund","Anzahl3")

nxste_nicht <- full_join(nxste_nicht1, nxste_nicht2, by = "Grund")
nxste_nicht <- full_join(nxste_nicht, nxste_nicht3, by = "Grund")

nxste_nicht <- nxste_nicht %>% rowwise() %>% mutate(Anzahl = sum(Anzahl1,Anzahl2,Anzahl3, na.rm=TRUE)) %>% arrange(Grund)
nxste_nicht$Grund <- as.factor(nxste_nicht$Grund)

# Plotten
ggplot(nxste_nicht, aes(x = reorder(Grund, -Anzahl), y = Anzahl))+
  geom_bar(stat = "identity", fill = "#9ecae1")+
  scale_x_discrete(breaks = 1:7, name = "Gründe für Nichtnutzung des nächsten Haltestelle (Mehrfachnennungen möglich)", labels = c("Bewegung", "Teureres/\nZusätzliches Ticket", "Präferenz", "ÖV-Angebot", "Kein Weg", "Uninformiert","Sonstiges")) +
  scale_fill_manual(breaks = 1:7, name = "Gründe für Nichtnutzung des nächsten Haltestelle (Mehrfachnennungen möglich)", labels = c("Bewegung", "Teureres/\nZusätzliches Ticket", "Präferenz", "ÖV-Angebot", "Kein Weg", "Uninformiert","Sonstiges")) +
  geom_text(aes(label = paste0(Anzahl)), position = position_dodge(.9),vjust=-1)+
  labs(x = "Zugangsweg", y = "Anzahl")+
  ylim(0,30.5)+
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
```

## Gründe für (Un-)Attraktivität des Zu-/Abgangsweges

Mehrfachnennungen waren möglich.

```{r}
weg_attrak_warum1 <- data.frame(table(Befragung$weg_attrak_warum1))
colnames(weg_attrak_warum1) <- c("Grund","Anzahl1")

weg_attrak_warum2 <- data.frame(table(Befragung$weg_attrak_warum2))
colnames(weg_attrak_warum2) <- c("Grund","Anzahl2")

weg_attrak_warum3 <- data.frame(table(Befragung$weg_attrak_warum3))
colnames(weg_attrak_warum3) <- c("Grund","Anzahl3")

weg_attrak_warum4 <- data.frame(table(Befragung$weg_attrak_warum4))
colnames(weg_attrak_warum4) <- c("Grund","Anzahl4")

weg_attrak_warum <- full_join(weg_attrak_warum1, weg_attrak_warum2, by = "Grund")
weg_attrak_warum <- full_join(weg_attrak_warum, weg_attrak_warum3, by = "Grund")
weg_attrak_warum <- full_join(weg_attrak_warum, weg_attrak_warum4, by = "Grund")

weg_attrak_warum <- weg_attrak_warum %>% rowwise() %>% mutate(Anzahl = sum(Anzahl1,Anzahl2,Anzahl3,Anzahl4, na.rm=TRUE)) %>% arrange(Grund)

weg_attrak_warum <- weg_attrak_warum %>% mutate(Empfinden = case_when(Grund == 1 ~ "Negativ",
                                                                      Grund == 2 ~ "Negativ",
                                                                      Grund == 3 ~ "Negativ",
                                                                      Grund == 4 ~ "Negativ",
                                                                      Grund == 5 ~ "Neutral",
                                                                      Grund == 6 ~ "Neutral",
                                                                      Grund == 7 ~ "Neutral",
                                                                      Grund == 8 ~ "Neutral",
                                                                      Grund == 9 ~ "Postitv",
                                                                      Grund == 10 ~ "Postitv",
                                                                      Grund == 11 ~ "Postitv",
                                                                      Grund == 12 ~ "Postitv",
                                                                      Grund == 13 ~ "Sonstiges"))

weg_attrak_warum <- weg_attrak_warum %>% mutate(Kategorie = case_when(Grund == 1 ~ "Atmosphäre Badens",
                                                                      Grund == 2 ~ "Wohlbefinden",
                                                                      Grund == 3 ~ "Infrastruktur",
                                                                      Grund == 4 ~ "Begrünung",
                                                                      Grund == 5 ~ "Atmosphäre Badens",
                                                                      Grund == 6 ~ "Wohlbefinden",
                                                                      Grund == 7 ~ "Infrastruktur",
                                                                      Grund == 8 ~ "Begrünung",
                                                                      Grund == 9 ~ "Atmosphäre Badens",
                                                                      Grund == 10 ~ "Wohlbefinden",
                                                                      Grund == 11 ~ "Infrastruktur",
                                                                      Grund == 12 ~ "Begrünung",
                                                                      Grund == 13 ~ "Sonstiges"))
weg_attrak_warum$Kategorie <- factor(weg_attrak_warum$Kategorie,levels = c("Atmosphäre Badens", "Begrünung", "Infrastruktur", "Wohlbefinden","Sonstiges"))

# Summe pro Kategorie berechnen
weg_attrak_warum <- weg_attrak_warum %>% group_by(Kategorie) %>% mutate(count_name_occur = sum(Anzahl))

# Plotten
ggplot(data = weg_attrak_warum, aes(x = reorder(Kategorie, -count_name_occur), y = Anzahl, fill = factor(Empfinden)))+
  geom_bar(stat = "identity")+
  scale_fill_manual(name = "Wahrnehmung des Weges ", values = c("#f25f4a","#ffeda0","#5ab576","#D9D9D9")) +
  geom_text(point.padding = NA , aes(label = Anzahl), position = position_stack(vjust=0.5))+
  labs(x = "Kategorie (Mehrfachnennungen möglich)", y = "Anzahl")+
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
```

## Warum nicht den kürzesten Weg gewählt?

Mehrfachnennungen waren möglich.

```{r}
weg_kurz_nein <- filter(Befragung, weg_kurz == 0)

weg_kurz_nein1 <- data.frame(table(weg_kurz_nein$weg_kurz_nein1))
colnames(weg_kurz_nein1) <- c("Grund","Anzahl1")

weg_kurz_nein2 <- data.frame(table(weg_kurz_nein$weg_kurz_nein2))
colnames(weg_kurz_nein2) <- c("Grund","Anzahl2")

weg_kurz_nein <- full_join(weg_kurz_nein1, weg_kurz_nein2, by = "Grund")

weg_kurz_nein <- weg_kurz_nein %>% rowwise() %>% mutate(Anzahl = sum(Anzahl1,Anzahl2, na.rm=TRUE)) %>% arrange(Grund)
weg_kurz_nein$Grund <- as.factor(weg_kurz_nein$Grund)


# Plotten
ggplot(weg_kurz_nein, aes(x = reorder(Grund, -Anzahl), y = Anzahl))+
  geom_bar(stat = "identity", fill = "#9ecae1")+
  scale_x_discrete(breaks = 1:8, name = "Gründe für laut eigenen Angaben nicht gegangenen kürzesten Weg", labels = c("Einkaufen\nam Weg", "Attraktivere\nRoute", "Straßenverkehr\numgehen", "Bewegung", "Noch Zeit", "Private Erle-\ndigung am Weg", "Soziale\nInteraktion","Sonstiges")) +
  geom_text(aes(label = paste0(Anzahl)), position = position_dodge(.9),vjust=-1)+
  labs(x = "", y = "Anzahl")+
  ylim(0,7.2)+
  theme_bw()
```

## Führerscheinbesitz

Mehrfachnennungen möglich

```{r}
# A-Führerschein
männlich_A <- data.frame(table(männlich$p_fs_A, exclude = FALSE))
colnames(männlich_A) <- c("Führerschein","Anzahl")
männlich_A$Geschlecht <- "Männlich"

weiblich_A <- data.frame(table(weiblich$p_fs_A, exclude = FALSE))
colnames(weiblich_A) <- c("Führerschein","Anzahl")
weiblich_A$Geschlecht <- "Weiblich"

fs_A <- bind_rows(männlich_A, weiblich_A)
fs_A$Typ <- "A"


# B-Führerschein
männlich_B <- data.frame(table(männlich$p_fs_B, exclude = FALSE))
colnames(männlich_B) <- c("Führerschein","Anzahl")
männlich_B$Geschlecht <- "Männlich"

weiblich_B <- data.frame(table(weiblich$p_fs_B, exclude = FALSE))
colnames(weiblich_B) <- c("Führerschein","Anzahl")
weiblich_B$Geschlecht <- "Weiblich"

fs_B <- bind_rows(männlich_B, weiblich_B)
fs_B$Typ <- "B"


# C-Führerschein
männlich_C <- data.frame(table(männlich$p_fs_C, exclude = FALSE))
colnames(männlich_C) <- c("Führerschein","Anzahl")
männlich_C$Geschlecht <- "Männlich"

weiblich_C <- data.frame(table(weiblich$p_fs_C, exclude = FALSE))
colnames(weiblich_C) <- c("Führerschein","Anzahl")
weiblich_C$Geschlecht <- "Weiblich"

fs_C <- bind_rows(männlich_C, weiblich_C)
fs_C$Typ <- "C"

# Zusammenfügen der Tabellen
fs <- bind_rows(fs_A, fs_B)
fs <- bind_rows(fs, fs_C)

# Spalte mit prozentuellem Anteil pro Gruppe erstellen - Persoenen ohne Führerschein werden in die Berechnung miteinbezogen
fs <- fs %>% group_by(Typ) %>% mutate(Anteil=prop.table(Anzahl))

# Nur Personen mit Führerschein in den Diagrammen anzeigen
fs <- subset(fs, Führerschein==1)


ggplot(data = fs, aes(x = Typ, y = Anzahl, fill = factor(Geschlecht)))+
  geom_bar(stat = "identity")+
  scale_fill_manual(name = "Geschlecht", values = c("#588ebb","#a23232"), labels = c("Männlich", "Weiblich")) +
  geom_text(data=subset(fs,Anzahl != 0),aes(label = scales::percent(Anteil, accuracy = 0.01L)), position=position_stack(vjust = 0.5))+
  labs(fill = "Geschlecht", x = "Führerscheinbesitz (Typ)", y = "Anzahl")+
  theme_bw()+
  theme(legend.position = c(0.9,0.9),legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
```

## Verkehrsmittelverfügbarkeit

Mehrfachnennungen möglich

```{r}
# Fahrrad
männlich_rad <- data.frame(table(männlich$p_fzg_rad, exclude = FALSE))
colnames(männlich_rad) <- c("Verfügbar","Anzahl")
männlich_rad$Geschlecht <- "Männlich"

weiblich_rad <- data.frame(table(weiblich$p_fzg_rad, exclude = FALSE))
colnames(weiblich_rad) <- c("Verfügbar","Anzahl")
weiblich_rad$Geschlecht <- "Weiblich"

fzg_rad <- bind_rows(männlich_rad, weiblich_rad)
fzg_rad$Verkehrsmittel <- "Fahrrad"


# E-Bike
männlich_ebike <- data.frame(table(männlich$p_fzg_ebike, exclude = FALSE))
colnames(männlich_ebike) <- c("Verfügbar","Anzahl")
männlich_ebike$Geschlecht <- "Männlich"

weiblich_ebike <- data.frame(table(weiblich$p_fzg_ebike, exclude = FALSE))
colnames(weiblich_ebike) <- c("Verfügbar","Anzahl")
weiblich_ebike$Geschlecht <- "Weiblich"

fzg_ebike <- bind_rows(männlich_ebike, weiblich_ebike)
fzg_ebike$Verkehrsmittel <- "E-Bike"


# Moped/Motorrad
männlich_mrad <- data.frame(table(männlich$p_fzg_mrad, exclude = FALSE))
colnames(männlich_mrad) <- c("Verfügbar","Anzahl")
männlich_mrad$Geschlecht <- "Männlich"

weiblich_mrad <- data.frame(table(weiblich$p_fzg_mrad, exclude = FALSE))
colnames(weiblich_mrad) <- c("Verfügbar","Anzahl")
weiblich_mrad$Geschlecht <- "Weiblich"

fzg_mrad <- bind_rows(männlich_mrad, weiblich_mrad)
fzg_mrad$Verkehrsmittel <- "Moped/Motorrad"


# Zusammenfügen
fzg <- bind_rows(fzg_rad, fzg_ebike)
fzg <- bind_rows(fzg, fzg_mrad)

# Prozentuelles Label erstellen - Unter Berücksichtigung der Personen ohne Verfügbarkeit des jeweiligen Verkehrsmittels
fzg <- fzg %>% group_by(Verkehrsmittel) %>% mutate(Anteil=prop.table(Anzahl))

# Nur Personen mit Verkehrsmittelverfügbarkeit werden geplottet
fzg <- subset(fzg, Verfügbar==1)


# Plotten
plot1 <- ggplot(data = fzg, aes(x = reorder(Verkehrsmittel, -Anzahl), y = Anzahl, fill = factor(Geschlecht)))+
  geom_bar(stat = "identity")+
  scale_fill_manual(name = "Geschlecht", values = c("#588ebb","#a23232"), labels = c("Männlich", "Weiblich")) +
  geom_text(data=subset(fzg,Anzahl != 0),aes(label = scales::percent(Anteil, accuracy = 0.01L)), position=position_stack(vjust = 0.5))+
  labs(fill = "", x = "Verfügbare Verkehrsmittel", y = "Anzahl")+
  ylim(0,200)+
  theme_bw()+
  theme(legend.position = c(0.9,12),legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))

# PKW (3 Kategorien, falls Führerschein für PKW vorhanden)
männlich_pkw <- subset(männlich, p_fs_B == 1)
männlich_pkw <- data.frame(table(männlich_pkw$p_fzg_pkw, exclude = FALSE))
colnames(männlich_pkw) <- c("Verfügbar","Anzahl")
männlich_pkw$Geschlecht <- "Männlich"

weiblich_pkw <- subset(weiblich, p_fs_B == 1)
weiblich_pkw <- data.frame(table(weiblich_pkw$p_fzg_pkw, exclude = FALSE))
colnames(weiblich_pkw) <- c("Verfügbar","Anzahl")
weiblich_pkw$Geschlecht <- "Weiblich"

fzg_pkw <- bind_rows(männlich_pkw, weiblich_pkw)
fzg_pkw$Verkehrsmittel <- "PKW"

# Plotten
plot2 <- ggplot(data = fzg_pkw, aes(x = Verfügbar, y = Anzahl, fill = factor(Geschlecht)))+
  geom_bar(stat = "identity")+
  scale_fill_manual(name = "", values = c("#588ebb","#a23232"), labels = c("Männlich", "Weiblich")) +
  scale_x_discrete(name = "PKW-Verfügbarkeit", labels = c("Nie", "Gelegentlich", "Immer","NA")) +
  geom_text(aes(label = paste0(round(Anzahl/sum(Anzahl)*100, digits = 2), "%")), position = position_stack(vjust = 0.5))+
  labs(x = "PKW-Verfügbarkeit", y = "Anzahl")+
  ylim(0,200)+
  theme_bw()+
  theme(legend.position = "none")

Legende <- get_legend(plot1) # gemeinsame Legende für beide Diagramme erstellen
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,2), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(2.5, 0.2))
```

## Beschäftigung

Es wird die Erwerbsstatistik der Stadt Baden hinzugefügt (https://www.statistik.at/blickgem/ae1/g30604.pdf):

```{r}
ErwerbsstatistikBN <- read.csv('Erwerbsstatistik_BezirkBN_2018.csv', header = TRUE, sep = ";")
```

Nun wird eine Häufigkeitstabelle erzeugt und geplottet.

```{r}
männlich_beruf <- data.frame(table(männlich$p_beruf, exclude = FALSE))
colnames(männlich_beruf) <- c("Beruf","Anzahl")
männlich_beruf$Geschlecht <- "Männlich"

weiblich_beruf <- data.frame(table(weiblich$p_beruf, exclude = FALSE))
colnames(weiblich_beruf) <- c("Beruf","Anzahl")
weiblich_beruf$Geschlecht <- "Weiblich"

beruf <- bind_rows(männlich_beruf, weiblich_beruf)

# Plotten
plot1 <- ggplot(data = beruf, aes(x = Beruf, y = Anzahl, fill = factor(Geschlecht)))+
  geom_bar(stat = "identity")+
  scale_fill_manual(name = "", values = c("#588ebb","#a23232"), labels = c("Männlich", "Weiblich")) +
  scale_x_discrete(name = "Beschäftigung (Befragung)", breaks = c(1:4,NA), labels = c("In Ausbildung", "\nErwerbstätig", "In Pension","\nSonstiges", "NA")) +
  geom_text(aes(label = paste0(round(Anzahl/sum(Anzahl)*100, digits = 2), "%")), position = position_stack(vjust = 0.5))+
  labs(fill = "", x = "Beschäftigung (Befragung)", y = "Anzahl")+
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))

plot2 <- ggplot(data = ErwerbsstatistikBN, aes(x = Beruf_kat, y = Anzahl, fill = factor(Geschlecht)))+
  geom_bar(stat = "identity")+
  scale_fill_manual(name = "", values = c("#588ebb","#a23232"), labels = c("Männlich", "Weiblich")) +
  scale_x_continuous(name = "Erwerbsstatistik Stadt Baden 2018", breaks = 1:4, labels = c("In Ausbildung", "\nErwerbstätig", "In Pension","\nSonstiges")) +
  geom_text(aes(label = paste0(round(Anzahl/sum(Anzahl)*100, digits = 2), "%")), position = position_stack(vjust = 0.5))+
  labs(x = "Erwerbsstatistik Stadt Baden 2018", y = "Anzahl")+
  theme_bw()+
  theme(legend.position = "none")

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,2), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(3, 0.3))
```

## Höchste abgeschlossene Ausbildung

Es wird die Ausbildungsstatistik des Bezirks Baden hinzugefügt (https://www.noe.gv.at/noe/Zahlen-Fakten/Schulabschluss_2018.xlsx - Gemeindegliederung nach https://www.noe.gv.at/noe/Baden/Gemeinden_im_Bezirk_Baden.html).

```{r}
BildungBN <- read.csv('NOe_Schulabschluss_2018.csv', header = TRUE, sep = ";")
```

Nun wird eine Häufigkeitstabelle erzeugt und geplottet.

```{r}
männlich_bildung <- data.frame(table(männlich$p_bildung, exclude = FALSE))
colnames(männlich_bildung) <- c("Bildung","Anzahl")
männlich_bildung$Geschlecht <- "Männlich"

weiblich_bildung <- data.frame(table(weiblich$p_bildung, exclude = FALSE))
colnames(weiblich_bildung) <- c("Bildung","Anzahl")
weiblich_bildung$Geschlecht <- "Weiblich"

bildung <- bind_rows(männlich_bildung, weiblich_bildung)

# Plotten
plot1 <- ggplot(data = bildung, aes(x = Bildung, y = Anzahl, fill = factor(Geschlecht)))+
  geom_bar(stat = "identity")+
  scale_fill_manual(name = "", values = c("#588ebb","#a23232"), labels = c("Männlich", "Weiblich")) +
  scale_x_discrete(name = "Höchste abgeschl. Ausbildung (Befragung)", breaks = c(1:5,NA), labels = c("noch kein\nSchulabschluss", "Pflichtschule", "Lehre/\nFachschule", "Matura", "Hochschule", "NA")) +
  geom_text(aes(label = paste0(round(Anzahl/sum(Anzahl)*100, digits = 2), "%")), position = position_stack(vjust = 0.5), size = 3)+
  labs(fill = "", x = "Höchste abgeschl. Ausbildung (Befragung)", y = "Anzahl")+
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"),axis.text.x = element_text(angle=45, hjust = 1))

plot2 <- ggplot(data = BildungBN, aes(x = Ausbildung_kat, y = Anzahl))+
  geom_bar(stat = "identity", fill = "#9ecae1")+
  scale_x_continuous(name = "Ausbildungsstatistik 2018 (ab 15 Jahren)", breaks = c(1:8), labels = c("Pflichtschule", "Lehre", "BMS", "AHS", "BHS","Kolleg","Hochschulver-   \nwandte Lehranst.","Uni/FH")) +
  geom_text(aes(label = paste0(round(Anzahl/sum(Anzahl)*100, digits = 2), "%")), position = position_stack(vjust = 0.5), size = 2.5)+
  labs(x = "Ausbildungsstatistik 2018 (ab 15 Jahren)", y = "Anzahl")+
  theme_bw()+
  theme(legend.position = "none",axis.text.x = element_text(angle=45, hjust = 1))

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(2,2), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(3, 0.3))
```

## Verwendung von Navigationssystemen auf Fußwegen

Mehrfachnennungen möglich

```{r}
# Subsets bilden
navi_vor <- subset(Befragung, p_navi == 1)
navi_am <- subset(Befragung, p_navi == 2)
navi_beides <- subset(Befragung, p_navi == 3)

navi_nein <- data.frame(table(Befragung$p_navi))
navi_nein <- slice(navi_nein, 1:1) # nur die erste Zeile auswählen
navi_nein$Verwendung <- "0"

navi_vor1 <- data.frame(table(navi_vor$p_navi_name1))
navi_vor2 <- data.frame(table(navi_vor$p_navi_name2))
navi_vor3 <- data.frame(table(navi_vor$p_navi_name3))
navi_vor <- full_join(navi_vor1,navi_vor2, by = "Var1")
navi_vor <- full_join(navi_vor,navi_vor3, by = "Var1")
navi_vor$Verwendung <- "1"

navi_am1 <- data.frame(table(navi_am$p_navi_name1))
navi_am2 <- data.frame(table(navi_am$p_navi_name2))
navi_am3 <- data.frame(table(navi_am$p_navi_name3))
navi_am <- full_join(navi_am1,navi_am2, by = "Var1")
navi_am <- full_join(navi_am,navi_am3, by = "Var1")
navi_am$Verwendung <- "2"

navi_beides1 <- data.frame(table(navi_beides$p_navi_name1))
navi_beides2 <- data.frame(table(navi_beides$p_navi_name2))
navi_beides3 <- data.frame(table(navi_beides$p_navi_name3))
navi_beides <- full_join(navi_beides1,navi_beides2, by = "Var1")
navi_beides <- full_join(navi_beides,navi_beides3, by = "Var1")
navi_beides$Verwendung <- "3"

navi <- bind_rows(navi_nein,navi_vor)
navi <- bind_rows(navi,navi_am)
navi <- bind_rows(navi,navi_beides)

navi <- navi %>% rowwise() %>% mutate(Anzahl = sum(Freq,Freq.x,Freq.y, na.rm=TRUE))
navi <- navi %>% mutate(Var1 = case_when(Var1 == 0 ~ " Keines",
                                         Var1 == 1 ~ "Google Maps",
                                         Var1 == 2 ~ "OpenStreetMap",
                                         Var1 == 3 ~ "VOR AnachB",
                                         Var1 == 4 ~ "Scotty",
                                         Var1 == 5 ~ "Apple Karten",
                                         Var1 == 6 ~ "Quando",
                                         Var1 == 7 ~ "Wiener Linien",
                                         Var1 == 8 ~ "Bike Citizens",
                                         Var1 == 9 ~ "WLB.at",
                                         Var1 == 10 ~ "Adrian",
                                         Var1 == 11 ~ "Google Earth"))
navi <- select(navi, c("Var1","Verwendung","Anzahl"))

# Plotten
plot1 <- ggplot(data = navi, aes(x = reorder(Var1, -Anzahl), y = Anzahl, fill = factor(Verwendung)))+
  geom_bar(stat = "identity")+
  scale_fill_brewer(name = "Verwendung von Navis", breaks = c(0:3,NA), labels = c("Nein", "Vorm Weg", "Am Weg", "Vorher und notfalls am Weg","NA")) +
  geom_text(data=subset(navi,Anzahl != 0),point.padding = NA,aes(label = paste0(Anzahl)), position = position_stack(vjust = 0.5))+
  labs(fill = "", x = "Navigationssystem (Mehrfachnennungen möglich)", y = "Anzahl")+
  theme_bw()+
  theme(legend.position = "none",axis.text.x = element_text(angle=45, hjust = 1))


navi <- data.frame(table(Befragung$p_navi, exclude = FALSE))

plot2 <- ggplot(data = navi, aes(x = 1, y = Freq, fill = factor(Var1)))+
  geom_bar(stat = "identity")+
  scale_fill_brewer(name = "Verwendung von Navis", breaks = c(0:3,NA), na.value = "#D9D9D9", labels = c("Nein", "Vorm Weg", "Am Weg", "Vorher und notfalls am Weg","NA")) +
  scale_x_continuous(breaks = 1, name = "Gesamt\n\n\n", labels = c("")) +
  geom_text(aes(label = paste0(round(Freq/sum(Freq)*100, digits = 2), "%")), position = position_stack(vjust = 0.5))+
  labs(x = "", y = "Anzahl")+
  theme_bw()+
  theme(legend.position = "bottom",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))

Legende <- get_legend(plot2)
plot2 <- plot2 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende,nrow=2 ,widths=c(5,1), layout_matrix = rbind(c(1,2), c(3,3)),heights = c(3, 0.3))
```

## Befragungen pro Stunde Standort Bahnhof Baden

```{r}
standort <- subset(Befragung, stand == 1)
standort <- data.frame(table(standort$stunde))
colnames(standort) <- c("Stunde","Anzahl")

# Plotten
ggplot(standort, aes(x = Stunde, y = Anzahl))+
  geom_bar(stat = "identity", fill = "#9ecae1")+
  geom_text(aes(label = paste0(Anzahl)), position = position_dodge(.9),vjust=-1)+
  labs(x = "Stunde", y = "Anzahl Befragte (Bahnhof Baden)")+
  ylim(0,15.5)+
  theme_bw()
```

## Befragungen pro Stunde Standort Bahnhof vs. Infos vom VOR

```{r}
bhf_tagesganglinie <- read.csv('Bahnhof_Tagesganglinie.csv', header = TRUE, dec = ",", sep = ";")

# Plotten
ggplot(bhf_tagesganglinie, aes(x = stunde, y = freq, fill = factor(datenquelle)))+
  geom_bar(stat = "identity", position = position_dodge2(width = 0.75, reverse = TRUE))+
  # geom_text(aes(label = paste0(freq)), position = position_dodge(0.5),vjust=-1, size = 2)+
  scale_fill_manual(values = c("#3182bd","#9ecae1"), name = "Datenquelle")+
  labs(x = "Stunde", y = "Frequenz am Bahnhof Baden [%]")+
  scale_x_continuous(breaks=seq(6,20,1))+
  ylim(0,20)+
  theme_bw()+
  theme(legend.position = c(0.9,0.9),legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
```

## Befragungen pro Stunde Standort Josefsplatz WLB

```{r}
standort <- subset(Befragung, stand == 2)
standort <- data.frame(table(standort$stunde))
colnames(standort) <- c("Stunde","Anzahl")

# Plotten
ggplot(standort, aes(x = Stunde, y = Anzahl))+
  geom_bar(stat = "identity", fill = "#9ecae1")+
  geom_text(aes(label = paste0(Anzahl)), position = position_dodge(.9),vjust=-1)+
  labs(x = "Stunde", y = "Anzahl Befragte (Josefsplatz WLB)")+
  ylim(0,10)+
  theme_bw()
```

## Befragungen pro Stunde Standort Josefsplatz Bus

```{r}
standort <- subset(Befragung, stand == 3)
standort <- data.frame(table(standort$stunde))
colnames(standort) <- c("Stunde","Anzahl")

# Plotten
ggplot(standort, aes(x = Stunde, y = Anzahl))+
  geom_bar(stat = "identity", fill = "#9ecae1")+
  geom_text(aes(label = paste0(Anzahl)), position = position_dodge(.9),vjust=-1)+
  labs(x = "Stunde", y = "Anzahl Befragte (Josefsplatz Bus)")+
  ylim(0,12.5)+
  theme_bw()
```

## Kürzester Weg (angegeben vs. ermittelt - als Diagramm)

```{r}
# Laut Befragung
weg_kurz_tab <- data.table(table(Befragung$weg_kurz))
weg_kurz_tab <- weg_kurz_tab %>% mutate(V1 = case_when(V1 == 0 ~ "nicht gewählt",
                                                           V1 == 1 ~ "gewählt"))
weg_kurz_tab$Kategorie <- "Befragung"

# Laut Ermittlung
Befragung <- Befragung %>% mutate(kurz_weg_tats = case_when(weg_kurz == 0 & test_kurz_weg == 0 ~ "wissentlich nicht gewählt",
                                                            weg_kurz == 1 & test_kurz_weg == 0 ~ "unwissentlich nicht gewählt",
                                                            weg_kurz == 0 & test_kurz_weg == 1 ~ "unwissentlich gewählt",
                                                            weg_kurz == 1 & test_kurz_weg == 1 ~ "wissentlich gewählt"))

kurz_weg_tats_tab <- data.table(table(Befragung$kurz_weg_tats))
kurz_weg_tats_tab$Kategorie <- "Ermittlung"

# Tabellen verbinden
kurz_weg_tab_vergleich <- bind_rows(weg_kurz_tab, kurz_weg_tats_tab)
kurz_weg_tab_vergleich <- kurz_weg_tab_vergleich %>% group_by(Kategorie) %>% mutate(Anteil=prop.table(N))

# Plotten
ggplot(data = kurz_weg_tab_vergleich, aes(x = Kategorie, y = Anteil, fill = factor(V1, levels = c("gewählt","nicht gewählt", "wissentlich gewählt", "unwissentlich gewählt", "wissentlich nicht gewählt", "unwissentlich nicht gewählt"))))+
  geom_bar(stat = "identity")+
  scale_fill_manual(name = "Kürzesten Weg", values = c("#5ab576","#f25f4a","#eff3ff","#bdd7e7","#6baed6","#2171b5"))+
  geom_text(aes(label = paste0(round(Anteil*100, digits = 2), "%")), position = position_stack(vjust = 0.5))+
  labs(x = "Wahl des kürzesten Weges laut", y = "Anteil")+
  scale_y_continuous(labels = scales::percent)+
  theme_bw()+
  theme(legend.position = "right",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))
```

## Nächste Haltestelle (angegeben vs. ermittelt - als Diagramm)

```{r}
# Laut Ermittlung
Befragung <- Befragung %>% mutate(hst_nxste_gew_tats = case_when(hst_nxste == 0 & test_hst_nxste == 0 ~ "wissentlich nicht gewählt",
                                                                 hst_nxste == 1 & test_hst_nxste == 0 ~ "unwissentlich nicht gewählt",
                                                                 hst_nxste == 0 & test_hst_nxste == 1 ~ "unwissentlich gewählt",
                                                                 hst_nxste == 1 & test_hst_nxste == 1 ~ "wissentlich gewählt"))


hst_nxste_tats_bhf <- subset(Befragung, stand == 1)
hst_nxste_tats_bhf <- data.table(table(hst_nxste_tats_bhf$hst_nxste_gew_tats))
hst_nxste_tats_bhf$Kategorie <- "Bhf"

hst_nxste_tats_wlb <- subset(Befragung, stand == 2)
hst_nxste_tats_wlb <- data.table(table(hst_nxste_tats_wlb$hst_nxste_gew_tats))
hst_nxste_tats_wlb$Kategorie <- " WLB"

hst_nxste_tats_bus <- subset(Befragung, stand == 3)
hst_nxste_tats_bus <- data.table(table(hst_nxste_tats_bus$hst_nxste_gew_tats))
hst_nxste_tats_bus$Kategorie <- " Bus"

# Tabellen verbinden
hst_nxste_tats_ges <- bind_rows(hst_nxste_tats_bhf, hst_nxste_tats_wlb)
hst_nxste_tats_ges <- bind_rows(hst_nxste_tats_ges, hst_nxste_tats_bus)
hst_nxste_tats_ges <- hst_nxste_tats_ges %>% group_by(Kategorie) %>% mutate(Anteil=prop.table(N))

# Plotten
plot1 <- ggplot(data = hst_nxste_tats_ges, aes(x = Kategorie, y = Anteil, fill = factor(V1, levels = c("wissentlich gewählt", "unwissentlich gewählt", "wissentlich nicht gewählt", "unwissentlich nicht gewählt"))))+
  geom_bar(stat = "identity")+
  scale_fill_brewer(name = "Nächste Haltestelle")+
  geom_text(aes(label = paste0(round(Anteil*100, digits = 2), "%")), position = position_stack(vjust = 0.5))+
  labs(x = "Befragungsstandort", y = "Anteil")+
  scale_y_continuous(labels = scales::percent)+
  theme_bw()+
  theme(legend.position = "right",legend.background = element_rect(color = "black",fill = "transparent"),legend.key.size = unit(0.3,"cm"))

# Nicht nach Befragungsstandort unterschieden
hst_nxste_tats_ges <- data.table(table(Befragung$hst_nxste_gew_tats))
hst_nxste_tats_ges <- hst_nxste_tats_ges %>% mutate(Anteil=prop.table(N))

plot2 <- ggplot(data = hst_nxste_tats_ges, aes(x = 1, y = Anteil, fill = factor(V1,levels = c("wissentlich gewählt", "unwissentlich gewählt", "wissentlich nicht gewählt", "unwissentlich nicht gewählt"))))+
  geom_bar(stat = "identity")+
  scale_fill_brewer(name = "Nächste Haltestelle")+
  geom_text(aes(label = paste0(round(Anteil*100, digits = 2), "%")), position = position_stack(vjust = 0.5))+
  scale_x_continuous(breaks = 1, name = "Gesamt", labels = c("")) +
  scale_y_continuous(labels = scales::percent)+
  geom_text(aes(label = paste0(round(Anteil*100, digits = 2), "%")), position = position_stack(vjust = 0.5))+
  labs(x = "", y = "Anteil")+
  theme_bw()+
  theme(legend.position = "none")

Legende <- get_legend(plot1)
plot1 <- plot1 + theme(legend.position="none")
grid.arrange(plot1, plot2, Legende, ncol=3, nrow=1, widths=c(1.5,0.7,1), layout_matrix = rbind(c(1,2,3)), heights = 2.5)
```

# Tabellen

## Kürzester Weg (angegeben vs. ermittelt)

```{r}
weg_kurz_Befragung_zu <- subset(Befragung, zuab == 1)
weg_kurz_Befragung_ab <- subset(Befragung, zuab == 2)
weg_kurz_Ermittlung_zu <- subset(Befragung, zuab == 1)
weg_kurz_Ermittlung_ab <- subset(Befragung, zuab == 2)

weg_kurz_Befragung_zu <- data.frame(table(weg_kurz_Befragung_zu$weg_kurz))
weg_kurz_Befragung_ab <- data.frame(table(weg_kurz_Befragung_ab$weg_kurz))
weg_kurz_Befragung_gesamt <- data.frame(table(Befragung$weg_kurz))

weg_kurz_Ermittlung_zu <- data.frame(table(weg_kurz_Ermittlung_zu$test_kurz_weg))
weg_kurz_Ermittlung_ab <- data.frame(table(weg_kurz_Ermittlung_ab$test_kurz_weg))
weg_kurz_Ermittlung_gesamt <- data.frame(table(Befragung$test_kurz_weg))

weg_kurz_Tabelle <- full_join(weg_kurz_Befragung_zu, weg_kurz_Befragung_ab, by = "Var1")
weg_kurz_Tabelle <- full_join(weg_kurz_Tabelle, weg_kurz_Befragung_gesamt, by = "Var1")
weg_kurz_Tabelle <- full_join(weg_kurz_Tabelle, weg_kurz_Ermittlung_zu, by = "Var1")
weg_kurz_Tabelle <- full_join(weg_kurz_Tabelle, weg_kurz_Ermittlung_ab, by = "Var1")
weg_kurz_Tabelle <- full_join(weg_kurz_Tabelle, weg_kurz_Ermittlung_gesamt, by = "Var1")

weg_kurz_Tabelle <- weg_kurz_Tabelle %>% mutate(Var1 = case_when(Var1 == 0 ~ "Nein",
                                                                 Var1 == 1 ~ "Ja"))
colnames(weg_kurz_Tabelle) <- c("Kürzester Weg","Zugang","Abgang","Gesamt","Zugang","Abgang","Gesamt")

# Tabelle erzeugen
kbl(weg_kurz_Tabelle) %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE) %>%
  add_header_above(c(" ", "Befragung" = 3, "Ermittlung" = 3))
```

## Nächste Haltestelle (angegeben vs. ermittelt)

```{r}
# Häufigkeitstabellen erzeugen
nxste_hst_Ermittlung_citybus <- data.frame(table(Befragung$test_citybus))
nxste_hst_Ermittlung_regbus <- data.frame(table(Befragung$test_regbus))
nxste_hst_Ermittlung_wlb <- data.frame(table(Befragung$test_wlb))
nxste_hst_Ermittlung_zug <- data.frame(table(Befragung$test_zug))

nxste_hst_Befragung_citybus <- data.frame(table(Befragung$nxste_vm_citybus))
nxste_hst_Befragung_regbus <- data.frame(table(Befragung$nxste_vm_regbus))
nxste_hst_Befragung_wlb <- data.frame(table(Befragung$nxste_vm_wlb))
nxste_hst_Befragung_zug <- data.frame(table(Befragung$nxste_vm_zug))

nxste_hst_gesamt <- data.frame(table(Befragung$test_hst_nxste_gleich))

# Häufigkeitstabellen zusammenführen
nxste_hst_Tabelle <- full_join(nxste_hst_Befragung_citybus, nxste_hst_Befragung_regbus, by = "Var1")
nxste_hst_Tabelle <- full_join(nxste_hst_Tabelle, nxste_hst_Befragung_wlb, by = "Var1")
nxste_hst_Tabelle <- full_join(nxste_hst_Tabelle, nxste_hst_Befragung_zug, by = "Var1")
nxste_hst_Tabelle <- full_join(nxste_hst_Tabelle, nxste_hst_Ermittlung_citybus, by = "Var1")
nxste_hst_Tabelle <- full_join(nxste_hst_Tabelle, nxste_hst_Ermittlung_regbus, by = "Var1")
nxste_hst_Tabelle <- full_join(nxste_hst_Tabelle, nxste_hst_Ermittlung_wlb, by = "Var1")
nxste_hst_Tabelle <- full_join(nxste_hst_Tabelle, nxste_hst_Ermittlung_zug, by = "Var1")
nxste_hst_Tabelle <- full_join(nxste_hst_Tabelle, nxste_hst_gesamt, by = "Var1")

# Variablen umbenennen
nxste_hst_Tabelle <- nxste_hst_Tabelle %>% mutate(Var1 = case_when(Var1 == 0 ~ "Nein",
                                                                   Var1 == 1 ~ "Ja",
                                                                   Var1 == 2 ~ "Weiß nicht"))
colnames(nxste_hst_Tabelle) <- c("Nächstes Verkehrsmittel","Citybus","Regionalbus","WLB","Zug","Citybus","Regionalbus","WLB","Zug","Idente nächste Haltestelle")

# Tabelle erzeugen
kbl(nxste_hst_Tabelle) %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  column_spec(c(2:9),width = "9cm") %>%
  add_header_above(c(" ", "Befragung" = 4, "Ermittlung" = 4, "Gesamt" = 1))
```

## Aufteilung der Befragungen auf die Buslinien im Vergleich mit dem Ergebnis der Fahrplananalyse

Es wird das Ergebnis der Bus-Fahrplananalyse hinzugefügt.

```{r}
Bhf_Zaehlungen <- read.csv('2020-09-11_ZaehlungenZug.csv', header = TRUE, sep = ";")
```

Zunächst werden Subsets gebildet, anschließend Häufigkeitstabellen erstellt und zum Schluss die Tabelle layoutiert. 

```{r}
# Subsets pro Fahrtrichtung bilden
Bhf_zu <- subset(Befragung, stand == 1 & zuab == 1)
Bhf_ab <- subset(Befragung, stand == 1 & zuab == 2)
Bhf_gesamt <- subset(Befragung, stand == 1)

# Häufigkeitstabellen erzeugen
Bhf_zu <- data.frame(table(Bhf_zu$bhf_ausgang))
Bhf_zu$Var1 <- as.character(Bhf_zu$Var1)
Bhf_zu <- mutate(Bhf_zu, Zugang = paste0(round(Freq/sum(Freq)*100, digits = 2),'%'))
Bhf_zu <- rbind(Bhf_zu,c("Summe",sum(Bhf_zu$Freq),"100.00%"))

Bhf_ab <- data.frame(table(Bhf_ab$bhf_ausgang))
Bhf_ab$Var1 <- as.character(Bhf_ab$Var1)
Bhf_ab <- mutate(Bhf_ab, Abgang = paste0(round(Freq/sum(Freq)*100, digits = 2),'%'))
Bhf_ab <- rbind(Bhf_ab,c("Summe",sum(Bhf_ab$Freq),"100.00%"))


Bhf_gesamt <- data.frame(table(Bhf_gesamt$bhf_ausgang))
Bhf_gesamt$Var1 <- as.character(Bhf_gesamt$Var1)
Bhf_gesamt <- mutate(Bhf_gesamt, Gesamt = paste0(round(Freq/sum(Freq)*100, digits = 2),'%'))
Bhf_gesamt <- rbind(Bhf_gesamt,c("Summe",sum(Bhf_gesamt$Freq),"100.00%"))

# Häufigkeitstabellen zusammenführen
Bhf_Tabelle <- full_join(Bhf_zu, Bhf_ab, by = "Var1")
Bhf_Tabelle <- full_join(Bhf_Tabelle, Bhf_gesamt, by = "Var1")
Bhf_Tabelle <- full_join(Bhf_Tabelle,Bhf_Zaehlungen,by = "Var1")

# gewünschte Sortierung der Variablen
Bhf_Tabelle <- Bhf_Tabelle %>% arrange(Var1) %>% mutate(Var1 = case_when(Var1 == 1 ~ "1: Haupteingang",
                                                       Var1 == 2 ~ "2: Felber",
                                                       Var1 == 3 ~ "3: Rampe",
                                                       Var1 == 4 ~ "4: Hinterausgang",
                                                       Var1 == "Summe" ~ "Summe"))
col_order <- c("Var1","Freq.x","Freq.y","Freq","Zugang","Abgang","Gesamt","hinein","hinaus","Summe")
Bhf_Tabelle <- Bhf_Tabelle[, col_order]
colnames(Bhf_Tabelle) <- c("Ausgang","Zugang","Abgang","Gesamt","Zugang","Abgang","Gesamt","Zugang","Abgang","Gesamt")

# Tabelle erzeugen
kbl(Bhf_Tabelle) %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" ","Absolute Zahlen" = 3, "Prozentuelle Verteilung" = 3, "Prozentuelle Verteilung" = 3)) %>%
  add_header_above(c(" ","Befragung" = 6, "Zählung" = 3)) %>%
  add_header_above(c(" ", "Standort Baden bei Wien Bahnhof (ÖBB)" = 9))
```

## Aufteilung der Befragungen auf die Ausgänge bei der WLB-Haltestelle Josefsplatz im Vergleich zum Ergebnis der selber durchgeführten Zählung

Es wird das Ergebnis der Bus-Fahrplananalyse hinzugefügt.

```{r}
WLB_Zaehlungen <- read.csv('2020-09-11_ZaehlungenWLB.csv', header = TRUE, sep = ";")
```

Zunächst werden Subsets gebildet, anschließend Häufigkeitstabellen erstellt und zum Schluss die Tabelle layoutiert. 

Bei der Zählung wurden Ausgang 22 und 23 zusammengefasst, da das Verbinden von Zellen nur mit zusätzlichem Aufwand in R durchgeführt werden kann, wird die Tabelle später manuell nachbearbeitet. 

```{r}
# Subsets pro Fahrtrichtung bilden
WLB_Steig1 <- subset(Befragung, wlb_ausgang == 11 | wlb_ausgang == 12 | wlb_ausgang == 13)
WLB_Steig2 <- subset(Befragung, wlb_ausgang == 21 | wlb_ausgang == 22 | wlb_ausgang == 23 | wlb_ausgang == 24)

# Häufigkeitstabellen erzeugen
WLB_Steig1 <- data.frame(table(WLB_Steig1$wlb_ausgang))
colnames(WLB_Steig1) <- c("Ausgang","Anzahl")
WLB_Steig1 <- mutate(WLB_Steig1, Prozentuell = paste0(round(Anzahl/sum(Anzahl)*100, digits = 2),'%'))
WLB_Steig1 <- rbind(WLB_Steig1,c("Summe",sum(WLB_Steig1$Anzahl),"100.00%"))
WLB_Steig1$Ausgang <- as.character(WLB_Steig1$Ausgang)
WLB_Steig1$Ausgang[is.na(WLB_Steig1$Ausgang)] <- "Summe 1"

WLB_Steig2 <- data.frame(table(WLB_Steig2$wlb_ausgang))
colnames(WLB_Steig2) <- c("Ausgang","Anzahl")
WLB_Steig2 <- mutate(WLB_Steig2, Prozentuell = paste0(round(Anzahl/sum(Anzahl)*100, digits = 2),'%'))
WLB_Steig2 <- rbind(WLB_Steig2,c("Summe",sum(WLB_Steig2$Anzahl),"100.00%"))
WLB_Steig2$Ausgang <- as.character(WLB_Steig2$Ausgang)
WLB_Steig2$Ausgang[is.na(WLB_Steig2$Ausgang)] <- "Summe 2"

# Häufigkeitstabellen zusammenführen
WLB_Tabelle <- rbind(WLB_Steig1, WLB_Steig2)
WLB_Tabelle <- full_join(WLB_Tabelle, WLB_Zaehlungen,by = "Ausgang")
WLB_Tabelle <- select(WLB_Tabelle,-"Standort")
colnames(WLB_Tabelle) <- c("Ausgang","Anzahl","Prozentuell","Prozentuell")
WLB_Tabelle <- t(WLB_Tabelle)
colnames(WLB_Tabelle) <- WLB_Tabelle[1,]
WLB_Tabelle <- WLB_Tabelle[-1, ] 

# Tabelle erzeugen
kbl(WLB_Tabelle) %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" ","Bahnsteig 1" = 4, "Bahnsteig 2" = 5)) %>%
  add_header_above(c(" ", "Standort Baden bei Wien Josefsplatz (WLB) - Zugang/Abgang über" = 9)) %>%
  pack_rows("Befragung", 1, 2) %>%
  pack_rows("Zählung", 3,3)
```


## Aufteilung der Befragungen auf die Buslinien im Vergleich mit dem Ergebnis der Fahrplananalyse

Es wird das Ergebnis der Bus-Fahrplananalyse hinzugefügt.

```{r}
Bus_Fahrplan <- read.csv('2020-09-11_FahrplananalyseBus.csv', header = TRUE, sep = ";")
```

Zunächst werden Subsets gebildet, anschließend Häufigkeitstabellen erstellt und zum Schluss die Tabelle layoutiert. 

```{r}
# Subsets pro Fahrtrichtung bilden
Busse_zumBhf <- subset(Befragung, bus_richtung == 1)
Busse_vomBhf <- subset(Befragung, bus_richtung == 2)
Busse_gesamt <- subset(Befragung, stand == 3)

# Häufigkeitstabellen erzeugen
Busse_zumBhf <- data.frame(table(Busse_zumBhf$bus_nr))
Busse_vomBhf <- data.frame(table(Busse_vomBhf$bus_nr))
Busse_gesamt <- data.frame(table(Busse_gesamt$bus_nr))

# Prozentuell (Gesamt)
Busse_gesamt <- mutate(Busse_gesamt, Prozentuell = paste0(round(Freq/sum(Freq)*100, digits = 2),'%'))

# Häufigkeitstabellen zusammenführen
Busse_Tabelle <- full_join(Busse_zumBhf, Busse_vomBhf, by = "Var1")
Busse_Tabelle <- full_join(Busse_Tabelle, Busse_gesamt, by = "Var1")
Busse_Tabelle <- full_join(Busse_Tabelle, Bus_Fahrplan, by = "Var1")

colnames(Busse_Tabelle) <- c("Busnummer","Zum Bahnhof","Vom Bahnhof","Gesamt","Prozentuell","Zum Bahnhof","Vom Bahnhof","Gesamt","Prozentuell")
Busse_Tabelle <- t(Busse_Tabelle)
colnames(Busse_Tabelle) <- Busse_Tabelle[1,] # Busnummern zur Überschrift machen
Busse_Tabelle <- Busse_Tabelle[-1, ] 
Busse_Tabelle[is.na(Busse_Tabelle)] <- 0

# gewünschte Sortierung der Buslinien
col_order <- c("A","B","C","301","302","303","304","306","308","310","315","320")
Busse_Tabelle <- Busse_Tabelle[, col_order]

# Tabelle erzeugen
kbl(Busse_Tabelle) %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  add_header_above(c(" ", "Standort Baden bei Wien Josefsplatz (Bus) - Buslinie" = 12)) %>%
  pack_rows("Befragung: Anzahl an Befragungen pro Buslinie und Richtung (6-21 Uhr)", 1, 4) %>%
  pack_rows("Fahrplananalyse: Anzahl an haltenden Bussen pro Buslinie und Richtung (6-21 Uhr)", 5, 8)
```

